import{w as h,y as p,r as m}from"./chunk-EPOLDU6W-zmgMqoXq.js";import{u as b,b as c}from"./index-CrUTr-li.js";import{i as w,t as v}from"./index-_rQV4Sop.js";import{c as T}from"./queryPersister-BaLqnXcD.js";import{u as C}from"./useTranslation-BV_BGx8x.js";import"./env-BlYEkaK0.js";(function(){try{var e=typeof window<"u"?window:typeof global<"u"?global:typeof globalThis<"u"?globalThis:typeof self<"u"?self:{};e.SENTRY_RELEASE={id:"ada4c7999b6ed5c9c18808775724ee3dffa94ca2"}}catch{}})();try{(function(){var e=typeof window<"u"?window:typeof global<"u"?global:typeof globalThis<"u"?globalThis:typeof self<"u"?self:{},s=new e.Error().stack;s&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[s]="b24b860d-9f9a-40e8-ae60-e281d87d9928",e._sentryDebugIdIdentifier="sentry-dbid-b24b860d-9f9a-40e8-ae60-e281d87d9928")})()}catch{}const Q=h(function(){const s=p(),a=b(),{i18n:u}=C(),o=m.useRef(!0);return m.useEffect(()=>(o.current=!0,(async()=>{const y=window.location.hash.substring(1),l=new URLSearchParams(y),d=l.get("accessToken"),f=l.get("refreshToken"),i=u.resolvedLanguage||"ko";if(d&&f){if(navigator.userAgent.includes("otl-app")){window.location.href=`org.sparcs.otl://login?accessToken=${d}&refreshToken=${f}`;return}await T(),a.removeQueries({queryKey:["/users/info"]}),a.removeQueries({queryKey:["/timetables"]}),await a.prefetchQuery({queryKey:["/users/info",null,i],queryFn:async()=>{const{data:r}=await c.get("/api/v2/users/info",{headers:{"Cache-Control":"no-cache"}});return r}});const t=a.getQueryData(["/users/info",null,i]);t&&(w({id:t.id,email:t.mail,name:t.name,studentNumber:t.studentNumber,degree:t.degree}),v("Sign In",{user_id:t.id,login_method:"sso",success:!0}));try{const{data:r}=await c.get("/api/v2/semesters",{headers:{"Cache-Control":"no-cache"}});if(r?.semesters?.length>0){const n=r.semesters[r.semesters.length-1];n&&await a.prefetchQuery({queryKey:["/timetables/my-timetable",{year:n.year,semester:n.semester},i],queryFn:async()=>{const{data:g}=await c.get("/api/v2/timetables/my-timetable",{params:{year:n.year,semester:n.semester},headers:{"Cache-Control":"no-cache"}});return g}})}}catch(r){console.error("Failed to prefetch timetable:",r)}o.current&&s("/",{replace:!0})}else o.current&&s("/",{replace:!0})})(),()=>{o.current=!1}),[s,a,u.resolvedLanguage]),null});export{Q as default};
//# sourceMappingURL=login.success-BaU3bx17.js.map
