import{w as y,y as d,r as f}from"./chunk-JZWAC4HX-D402S-HY.js";import{u as p,b as c}from"./index-ChVAHUgF.js";import{c as w,b,t as v}from"./queryPersister-BatLGggj.js";import{u as C}from"./useTranslation-DeTfqpDd.js";import"./env-CKBdHP1Q.js";import"./preload-helper-L1CUoDBB.js";const E=y(function(){const n=d(),t=p(),{i18n:i}=C(),a=f.useRef(!0);return f.useEffect(()=>(a.current=!0,(async()=>{const g=window.location.hash.substring(1),u=new URLSearchParams(g),l=u.get("accessToken"),m=u.get("refreshToken"),o=i.resolvedLanguage||"ko";if(l&&m){if(navigator.userAgent.includes("otl-app")){window.location.href=`org.sparcs.otl://login?accessToken=${l}&refreshToken=${m}`;return}await w(),t.removeQueries({queryKey:["/users/info"]}),t.removeQueries({queryKey:["/timetables"]}),await t.prefetchQuery({queryKey:["/users/info",null,o],queryFn:async()=>{const{data:s}=await c.get("/api/v2/users/info",{headers:{"Cache-Control":"no-cache"}});return s}});const e=t.getQueryData(["/users/info",null,o]);e&&(b({id:e.id,email:e.mail,name:e.name,studentNumber:e.studentNumber,degree:e.degree}),v("Sign In",{user_id:e.id,login_method:"sso",success:!0}));try{const{data:s}=await c.get("/api/v2/semesters",{headers:{"Cache-Control":"no-cache"}});if(s?.semesters?.length>0){const r=s.semesters[s.semesters.length-1];r&&await t.prefetchQuery({queryKey:["/timetables/my-timetable",{year:r.year,semester:r.semester},o],queryFn:async()=>{const{data:h}=await c.get("/api/v2/timetables/my-timetable",{params:{year:r.year,semester:r.semester},headers:{"Cache-Control":"no-cache"}});return h}})}}catch(s){console.error("Failed to prefetch timetable:",s)}a.current&&n("/",{replace:!0})}else a.current&&n("/",{replace:!0})})(),()=>{a.current=!1}),[n,t,i.resolvedLanguage]),null});export{E as default};
//# sourceMappingURL=login.success-CMRqR7F5.js.map
