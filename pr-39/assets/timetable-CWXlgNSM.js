import{a as c,R as le,L as ii,w as oi}from"./chunk-UIGDSWPH-NakEPbl8.js";import{n as w,F as L,j as y,a as d,b as Ot,u as Ue}from"./FlexWrapper-C0dsngQo.js";import{C as hr,S as ai}from"./proxy-1qUiWquY.js";import{e as Fe,u as we,l as re,F as et,q as hn,t as Ne,k as ce,B as Un,C as tn,E as Ge,j,W as Se,H as si}from"./useIsDevice-DAKqZiCM.js";import{M as li}from"./Modal-CR0sOaLy.js";import{j as $e}from"./jsx-runtime-u17CrQMm.js";import{T as z}from"./Typography-DTsae4U-.js";import{S as ht}from"./StyledDivider-DtOGNsrE.js";import{c as ci,r as di,a as ui,b as hi,d as fn}from"./renderTargetArea-C-O_MEua.js";import{A as pn,S as fi,c as pi,C as Ht}from"./checkEmpty-BtGFro45.js";import{R as gi,F as gn,p as mi}from"./ReviewBlock-Cag-fH_V.js";import{u as fr,b as pr,C as vi,S as yi,I as nt}from"./Credits-BSxV66hY.js";import{u as mn}from"./useUserStore-Cs3WP2WQ.js";import{L as nn}from"./LoadingCircle-B5aajmnT.js";import{a as ut}from"./index-CSYM8SEM.js";import"./infiniteQueryBehavior-Bs-ItZYI.js";const bi=Fe($e.jsx("path",{d:"M19 4h-1V2h-2v2H8V2H6v2H5c-1.11 0-1.99.9-1.99 2L3 20c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2m0 16H5V10h14zM9 14H7v-2h2zm4 0h-2v-2h2zm4 0h-2v-2h2zm-8 4H7v-2h2zm4 0h-2v-2h2zm4 0h-2v-2h2z"})),wi=Fe($e.jsx("path",{d:"M19.35 10.04C18.67 6.59 15.64 4 12 4c-1.48 0-2.85.43-4.01 1.17l1.46 1.46C10.21 6.23 11.08 6 12 6c3.04 0 5.5 2.46 5.5 5.5v.5H19c1.66 0 3 1.34 3 3 0 1.13-.64 2.11-1.56 2.62l1.45 1.45C23.16 18.16 24 16.68 24 15c0-2.64-2.05-4.78-4.65-4.96M3 5.27l2.75 2.74C2.56 8.15 0 10.77 0 14c0 3.31 2.69 6 6 6h11.73l2 2L21 20.73 4.27 4zM7.73 10l8 8H6c-2.21 0-4-1.79-4-4s1.79-4 4-4z"})),vn=Fe($e.jsx("path",{d:"M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2m0 16H8V7h11z"})),gr=Fe($e.jsx("path",{d:"M16.5 3c-1.74 0-3.41.81-4.5 2.09C10.91 3.81 9.24 3 7.5 3 4.42 3 2 5.42 2 8.5c0 3.78 3.4 6.86 8.55 11.54L12 21.35l1.45-1.32C18.6 15.36 22 12.28 22 8.5 22 5.42 19.58 3 16.5 3m-4.4 15.55-.1.1-.1-.1C7.14 14.24 4 11.39 4 8.5 4 6.5 5.5 5 7.5 5c1.54 0 3.04.99 3.57 2.36h1.87C13.46 5.99 14.96 5 16.5 5c2 0 3.5 1.5 3.5 3.5 0 2.89-3.14 5.74-7.9 10.05"})),xi=Fe($e.jsx("path",{d:"M21 19V5c0-1.1-.9-2-2-2H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2M8.5 13.5l2.5 3.01L14.5 12l4.5 6H5z"})),Ei=Fe($e.jsx("path",{d:"M15.41 7.41 14 6l-6 6 6 6 1.41-1.41L10.83 12z"})),Si=Fe($e.jsx("path",{d:"M10 6 8.59 7.41 13.17 12l-4.58 4.59L10 18l6-6z"}));function Ti(){const[e,t]=c.useState(()=>typeof navigator<"u"?navigator.onLine:!0);return c.useEffect(()=>{const n=()=>t(!0),r=()=>t(!1);return window.addEventListener("online",n),window.addEventListener("offline",r),()=>{window.removeEventListener("online",n),window.removeEventListener("offline",r)}},[]),e}const Ci=w(L)`
    background-color: ${({theme:e})=>e.colors.Background.Section.default};
    border-radius: 8px;
    padding: 8px 12px;
`,Di=()=>{const e=Ti(),{t}=we();return e?null:y(Ci,{direction:"row",align:"center",gap:8,children:[d(re,{size:16,color:"inherit",children:d(wi,{})}),d(z,{type:"Normal",color:"Text.placeholder",children:t("common.offline.banner")})]})},Ri=(e,t,n,r,i,o)=>{const a=[0];let s=0;for(let l=0;l<e;l++)t.includes(l+o)?(s+=n+i,a.push(s)):(s+=r+i,a.push(s));return a},Fn=(e,t,n,r,i,o,a)=>{const s=Ri(t,n,r,i,o,a);for(let l=0;l<t+1;l++){const h=s[l];if(h!==void 0&&h>e)return l-1}return t},Ai=w.div`
    display: flex;
    flex-direction: row;
    gap: 5px;
    align-items: center;
    height: fit-content;
`,Ii=w.div`
    padding-top: 15px;
    display: flex;
    flex-grow: 1;
    flex-direction: column;
    height: 100%;
    justify-content: space-evenly;
    gap: ${({cellHeight:e})=>`${e*2-11}px`};
    font-size: 8px;
    line-height: 11px;
`,Ni=w.div`
    width: ${e=>`${e.width}px`};
    align-items: center;
    font-size: 12px;
    line-height: 15px;
    padding-bottom: 5px;
    text-align: center;
`,Mi=({cellWidth:e=120,fullHeight:t=800.5,lectureSummary:n,setTimeFilter:r,hover:i,setHover:o,selected:a,setSelected:s,removeFunction:l})=>{const{t:h}=we(),u=5,f=5,m=8,g=c.useRef(null),A=[h("common.days.monday"),h("common.days.tuesday"),h("common.days.wednesday"),h("common.days.thursday"),h("common.days.friday")];ci(n);const p=32,x=24,[E,T]=c.useState(0);c.useEffect(()=>{const M=()=>{T(t/32)};return window.addEventListener("resize",M),M(),()=>window.removeEventListener("resize",M)},[t]);const[b,N]=c.useState(!1),[S,D]=c.useState(null),[R,v]=c.useState(null),[C,k]=c.useState(null),[O,q]=c.useState(new Map(Array.from({length:f},(M,P)=>[P,Array(p).fill(null)]))),G=M=>{if(g.current&&i==null&&a==null){const P=g.current.getBoundingClientRect(),U=M.clientX-P.left,V=M.clientY-P.top,H=Math.floor(V/E),te=Fn(U,f,[],0,e,u,0);H>=0&&H<p&&te>=0&&te<f&&(N(!0),D(H),v(H),k(te),s(null))}},Q=M=>{if(b&&g.current){const P=g.current.getBoundingClientRect(),U=M.clientY-P.top,V=Math.floor(U/E);V>=0&&V<p&&C>=0&&C<f&&V!==R&&v(V)}},Z=()=>{if(q(new Map(Array.from({length:f},(M,P)=>[P,Array(p).fill(null)]))),S!=null&&R!=null&&C!=null){const M=Math.min(S,R),P=Math.max(S,R),U={day:C,begin:M*30+480,end:(P+1)*30+480};r(U)}D(null),v(null),N(!1)},ee=M=>{if(g.current&&i==null&&a==null){const P=M.touches[0];if(!P)return;const U=g.current.getBoundingClientRect(),V=P.clientX-U.left,H=P.clientY-U.top,te=Math.floor(H/E),I=Fn(V,f,[],0,e,u,0);te>=0&&te<p&&I>=0&&I<f&&(N(!0),D(te),v(te),k(I),s(null))}},K=M=>{if(b&&g.current){const P=M.touches[0];if(!P)return;const U=g.current.getBoundingClientRect(),V=P.clientY-U.top,H=Math.floor(V/E);H>=0&&H<p&&C>=0&&C<f&&H!==R&&v(H)}},oe=()=>{Z()};c.useEffect(()=>(b&&window.addEventListener("mouseup",Z),()=>{window.removeEventListener("mouseup",Z)}),[b,Z]);const Y=(M,P,U)=>{const V=new Map(Array.from({length:f},(H,te)=>[te,Array(p).fill(null)]));for(let H=M;H<P+1;H++)V.get(U)[H]=!0;return V};return c.useLayoutEffect(()=>{if(g.current&&b){const M=Math.min(S,R),P=Math.max(S,R),U=Y(M,P,C);q(U)}},[R,S]),y(Ai,{children:[d(Ii,{cellHeight:E,children:Array.from({length:x-m+1},(M,P)=>P+m).map(M=>d(z,{color:"Text.default",children:M%12||12},M))}),y(L,{direction:"column",gap:0,children:[d(L,{direction:"row",gap:5,children:A.map((M,P)=>M!=="none"&&d(Ni,{width:M===""?10:e,children:d(z,{color:"Text.default",children:M})},P))}),y("div",{ref:g,style:{display:"inline-block",position:"relative",userSelect:"none",touchAction:"none"},onClick:()=>{s(null)},onMouseDown:G,onMouseMove:Q,onMouseUp:M=>{M.stopPropagation(),Z()},onTouchStart:ee,onTouchMove:K,onTouchEnd:oe,children:[di(p,f,e,E,u,[],10,0),ui(!0,O,"rgba(229, 76, 101, 0.5)",E,e,2,u,[],0,0),hi(n,e,E,u,a,s,i,o,b,l)]})]})]})},Li=le.memo(Mi);function mr(e){return e.map(t=>t.name).join(", ")}function Oi(e){return e.slice().sort((n,r)=>{const i=n.day,o=r.day;return i!==o?i-o:n.begin-r.begin}).map(n=>n.str).join(" / ")}function ki(e){const t={};return e.forEach(n=>{const r=n.buildingCode,i=n.roomName;r in t?t[r]&&!t[r].includes(i)&&(t[r]=t[r].concat(`, ${i}`)):t[r]=i}),Object.entries(t).map(([n,r])=>`(${n}) ${r}`).join(" / ")}const zi=w(L)`
    width: 100%;
`,Bi=w(L)`
    width: 300px;
    padding: 10px;
`,Pi=w(L)`
    flex: 1 0 0;
`,Xe=w(z)`
    white-space: nowrap;
`,Ui=({selectedLecture:e})=>{const{t}=we();return y(Ot,{children:[y(zi,{direction:"column",gap:8,children:[y(L,{direction:"row",gap:6,children:[d(Xe,{type:"NormalBold",color:"Text.default",children:t("common.search.type")}),d(z,{type:"Normal",color:"Text.default",children:e?.type})]}),y(L,{direction:"row",gap:6,children:[d(Xe,{type:"NormalBold",color:"Text.default",children:t("common.search.department")}),d(z,{type:"Normal",color:"Text.default",children:e?.department.name})]}),y(L,{direction:"row",gap:6,children:[d(Xe,{type:"NormalBold",color:"Text.default",children:t("common.professor")}),d(z,{type:"Normal",color:"Text.default",children:mr(e?.professors||[])})]}),y(L,{direction:"row",gap:6,children:[d(Xe,{type:"NormalBold",color:"Text.default",children:t("common.room")}),d(z,{type:"Normal",color:"Text.default",children:ki(e?.classes||[])})]}),y(L,{direction:"row",gap:6,children:[d(Xe,{type:"NormalBold",color:"Text.default",children:t("common.limit")}),d(z,{type:"Normal",color:"Text.default",children:e?.limitPeople})]}),y(L,{direction:"row",gap:6,children:[d(Xe,{type:"NormalBold",color:"Text.default",children:t("common.exam")}),d(z,{type:"Normal",color:"Text.default",children:Oi(e?.examTimes||[])})]})]}),d(Bi,{direction:"row",gap:0,justify:"space-around",align:"center",children:[[e?.classDuration,t("common.numClasses")],[e?.expDuration,t("common.numLabs")],e?.creditAU?[e?.creditAU,"AU"]:[e?.credit,t("common.credit")]].map(([n,r],i)=>y(Pi,{direction:"column",gap:0,align:"center",children:[d(z,{type:"Bigger",color:"Text.default",children:n}),d(z,{type:"Smaller",color:"Text.default",children:r})]},i))})]})},Fi=w(L)`
    width: 300px;
    padding: 10px;
`,$i=w(L)`
    flex: 1 0 0;
`,ji=w.div`
    width: 100%;
    min-height: 1px;
    background-color: ${({theme:e})=>e.colors.Line.divider};
`,Hi=({selectedCourseId:e,selectedProfessorId:t})=>{const{t:n}=we(),[r,i]=c.useState(!1),{query:o,setParams:a,data:s}=fr("GET","/reviews",{gcTime:0,infinites:["reviews"],limit:20}),{ref:l,inView:h}=pr({threshold:0});return c.useEffect(()=>{i(!1);const u=setTimeout(()=>{a({mode:"default",courseId:e??void 0,professorId:t??void 0}),i(!0)},1e3);return()=>clearTimeout(u)},[e,t]),c.useEffect(()=>{h&&o.hasNextPage&&!o.isFetchingNextPage&&o.fetchNextPage()},[h,o]),!s||!r?d(nn,{}):y(Ot,{children:[d(L,{direction:"row",gap:0,justify:"center",align:"center",style:{width:"100%"},children:d(Fi,{direction:"row",gap:0,justify:"space-between",align:"center",children:[[et(s?.averageGrade,s?.reviews.length),n("common.grade")],[et(s?.averageLoad,s?.reviews.length),n("common.load")],[et(s?.averageSpeech,s?.reviews.length),n("common.speech")]].map(([u,f],m)=>y($i,{direction:"column",gap:0,align:"center",children:[d(z,{type:"Bigger",color:"Text.default",children:u}),d(z,{type:"Smaller",color:"Text.default",children:f})]},m))})}),d(ji,{}),s?.reviews.map(u=>d(gi,{review:u,linkToDictionary:!0},u.id)),o.hasNextPage&&d(nn,{ref:l})]})},Wi=w(L)`
    width: 100%;
    height: 100%;
    overflow-x: hidden;
    overflow-y: auto;

    scrollbar-width: none;
    &::-webkit-scrollbar {
        display: none;
    }
`,$n=w(L)`
    width: 100%;
`,qi=w(L)`
    width: 100%;
    position: sticky;
    top: 0;
    background-color: ${({theme:e})=>e.colors.Background.Section.default};
    z-index: 10;
    padding-bottom: 10px;
`,Yi=w(L)`
    position: absolute;
    bottom: 0;
    width: 100%;
    padding: 12px 0;
    background-color: ${({theme:e})=>e.colors.Background.Section.default};
`,Vi=w(ii)`
    text-decoration: none;
`,Gi=w.a`
    text-decoration: none;
`,jn=({selectedLecture:e,onMobileModalClose:t,year:n,semester:r,currentTimetableId:i,timetableLectures:o})=>{const a=hn(),s=Ue(),{t:l}=we(),{user:h,status:u}=mn(),f=Ne("tablet"),{requestFunction:m}=ce("PATCH",`/timetables/${i}`,{onSuccess:()=>{a.invalidateQueries({queryKey:[`/timetables/${i}`]})}}),[g,A]=c.useState([]),{query:p,setParams:x}=ce("GET",`/users/${h?.id}/wishlist`,{enabled:u==="success"&&n!=-1});c.useEffect(()=>{x({year:n,semester:r})},[n,r,i]),c.useEffect(()=>{p.data&&A(p.data.courses.flatMap(D=>D.lectures).map(D=>D.id))},[p.data]);const{requestFunction:E}=ce("PATCH",`/users/${h?.id}/wishlist`,{onSuccess:()=>{a.invalidateQueries({queryKey:[`/users/${h?.id}/wishlist`]})}}),T=c.useRef(null),b=D=>{const R={syy:String(n),smtDivCd:String(r),subjtCd:D.code,syllabusOpenYn:"1"};return`https://erp.kaist.ac.kr/com/lgin/SsoCtr/initExtPageWork.do?link=estblSubjt&params=${btoa(JSON.stringify(R))}`},N=async D=>{if(o){if(i){if(o.some(R=>fn(R.classes,D.classes))){alert(l("timetable.addLectureConflict"));return}}else{console.warn("No timetable selected");return}m({action:"add",lectureId:D.id})}},S=async(D,R)=>{u!=="idle"&&E({lectureId:R,mode:D?"delete":"add"})};return d(Wi,{direction:"column",gap:12,align:"center",justify:e?"start":"center",children:e?y(Ot,{children:[y(qi,{direction:"column",gap:2,align:"center",justify:"center",children:[y(L,{direction:"row",align:"center",gap:8,justify:f?"space-between":"center",style:{width:"100%"},children:[f&&d("div",{style:{width:20}}),d(z,{type:"Bigger",color:"Text.default",children:e.name}),f&&d(re,{size:20,onClick:t,color:s.colors.Text.default,children:d(hr,{})})]}),d(z,{type:"Big",color:"Text.default",children:e.code})]}),y(L,{direction:"row",gap:8,justify:"flex-end",style:{width:"100%"},children:[d(Vi,{to:`/dictionary?courseId=${e.courseId}`,children:d(z,{type:"Normal",color:"Highlight.default",style:{cursor:"pointer"},children:l("header.dictionary")})}),d(Gi,{href:b(e),target:"_blank",children:d(z,{type:"Normal",color:"Highlight.default",style:{cursor:"pointer"},children:l("header.syllabus")})})]}),d($n,{direction:"column",gap:10,align:"center",children:d(Ui,{selectedLecture:e})}),d($n,{ref:T,direction:"column",gap:10,children:d(Hi,{selectedCourseId:e.courseId,selectedProfessorId:e.professors[0]?.id??-1})}),f&&y(Yi,{direction:"row",gap:12,justify:"flex-end",children:[!g.includes(e.id)&&y(Un,{onClick:()=>{S(g.includes(e.id),e.id),t&&t()},children:[d(re,{size:15,children:d(gn,{})}),d(z,{type:"NormalBold",children:"찜목록에 추가"})]}),!o?.some(D=>D.id===e.id)&&y(Un,{type:"selected",onClick:()=>{N(e),t&&t()},children:[d(re,{size:15,children:d(pn,{})}),d(z,{type:"NormalBold",children:"시간표에 추가"})]})]})]}):d(vi,{})})},Xi=w.div`
    width: 100%;
    display: flex;
    flex-direction: column;
    border-radius: 8px;
    background-color: ${({theme:e})=>e.colors.Background.Block.default};
    transition: all 0.2s ease;
    transform: ${({isSelected:e})=>e?"translateY(-2px)":"none"};
    box-shadow: ${({isSelected:e})=>e?"0 4px 8px rgba(0, 0, 0, 0.15)":"none"};
    overflow: hidden;
    flex-shrink: 0;
`,Ki=w.div`
    width: 100%;
    display: flex;
    align-items: center;
    padding: 8px 12px;
    flex-direction: row;
    justify-content: space-between;
`,Qi=w.div`
    width: 100%;
    display: flex;
    align-items: center;
    padding: 8px 12px 8px 18px;
    flex-direction: row;
    justify-content: space-between;
    background-color: ${({isHighlighted:e,theme:t})=>e?t.colors.Background.Block.dark:t.colors.Background.Block.default};
    cursor: pointer;
`,Hn=w.div`
    width: 95%;
    height: 1px;
    background-color: ${({theme:e})=>e.colors.Line.dark};
    align-self: center;
`,Ji=({course:e,selectedLecture:t,hoveredLecture:n,isInWish:r,isWishlist:i,currentTimetableId:o,timetableLectures:a,isAddTimetablePending:s,setHoveredLecture:l,setSelectedLecture:h,handleLikeClick:u,handleAddToTimetable:f,t:m})=>{const g=e.lectures[0]?.courseId??-1,A=t!=null&&t.courseId!==g?.3:1;return y(Xi,{isSelected:t?.courseId===g,style:{opacity:A},children:[y(Ki,{children:[y(L,{direction:"row",gap:6,style:{opacity:e.completed?.3:1},children:[d(z,{type:"NormalBold",color:"Text.default",children:e.name}),d(z,{type:"Normal",color:"Text.default",children:e.code})]}),e.completed?d(z,{type:"Normal",color:"Text.default",children:m("common.completedCourse")}):d(z,{type:"Normal",color:"Highlight.default",children:e.type})]}),d(Hn,{}),e.lectures.map((p,x)=>{const E=r.includes(p.id);return y(le.Fragment,{children:[y(Qi,{onMouseEnter:()=>{l([p])},onMouseLeave:()=>{l(null)},onClick:()=>{if(p.id===t?.id){h(null);return}h(p)},isHighlighted:t?.id===p.id||n?.some(T=>T.id===p.id)===!0,children:[y(L,{direction:"row",gap:6,style:{opacity:e.completed?.3:1},children:[d(z,{type:"NormalBold",color:"Text.default",children:p.classNo}),d(z,{type:"Normal",color:"Text.default",children:mr(p.professors)})]}),y(L,{direction:"row",gap:6,onClick:T=>T.stopPropagation(),children:[E||i?d(re,{size:15,color:"#E54C65",onClick:()=>u(E,p.id),children:d(gn,{})}):d(re,{size:15,onClick:()=>u(E,p.id),children:d(gr,{})}),d("span",{style:{opacity:o==null||a.some(T=>fn(T.classes,p.classes))?.3:1,cursor:s?"wait":"pointer"},children:d(re,{size:15,onClick:()=>f(p),children:d(pn,{})})})]})]}),x!==e.lectures.length-1&&d(Hn,{})]},p.id)})]})},Zi=c.memo(Ji,(e,t)=>{if(e.course.id!==t.course.id||e.isInWish!==t.isInWish||e.isWishlist!==t.isWishlist||e.currentTimetableId!==t.currentTimetableId||e.timetableLectures!==t.timetableLectures||e.isAddTimetablePending!==t.isAddTimetablePending||e.selectedLecture!==t.selectedLecture)return!1;const n=e.hoveredLecture,r=t.hoveredLecture;if(n===r)return!0;const i=e.course.lectures.map(s=>s.id),o=n?.some(s=>i.includes(s.id))??!1,a=r?.some(s=>i.includes(s.id))??!1;return!o&&!a}),_i=w(L)`
    width: 100%;
    height: 100%;
    overflow: hidden;
`,eo=w(L)`
    border-radius: 6px;
    border: 1px solid ${({theme:e})=>e.colors.Line.divider};
    max-height: 100%;
`,to=w(z)`
    width: 100%;
    flex-grow: 1;
    display: flex;
    align-items: center;
    justify-content: center;
`,no=w(L)`
    height: 36px;
`,ro=w(L)`
    height: fit-content;
    overflow-y: auto;

    scrollbar-width: none;
    &::-webkit-scrollbar {
        display: none;
    }
`,io=w.div`
    display: flex;
    align-items: center;
    padding: 8px 12px;
    flex-direction: row;
    gap: 8px;
    border-radius: 6px;
    background-color: ${({isSelected:e,theme:t})=>e?t.colors.Background.Button.highlightDark:t.colors.Background.Button.highlight};
    cursor: pointer;
    &:hover {
        background-color: ${({theme:e})=>e.colors.Background.Button.highlightDark};
    }
`,Wt=50,oo=({timetableLectures:e,year:t,semester:n,hoveredLecture:r,setHoveredLecture:i,selectedLecture:o,setSelectedLecture:a,timeFilter:s,setTimeFilter:l,currentTimetableId:h})=>{const{t:u}=we(),f=Ue(),{user:m,status:g}=mn(),A=hn(),{ref:p,inView:x}=pr({threshold:0}),[E,T]=c.useState(!1),b=Ne("tablet");Ne("laptop"),Ne("desktop");const N=c.useCallback(I=>{if(!I)return I;const W=new Map;return I.courses.forEach(X=>{const J=W.get(X.id);if(!J){W.set(X.id,{...X,lectures:[...X.lectures]});return}const B=new Set(J.lectures.map(ae=>ae.id)),Me=[...J.lectures];X.lectures.forEach(ae=>{B.has(ae.id)||(B.add(ae.id),Me.push(ae))}),W.set(X.id,{...J,lectures:Me})}),{...I,courses:Array.from(W.values())}},[]),{query:S,setParams:D,data:R}=fr("GET","/lectures",{infinites:["courses"],limit:Wt,enabled:E,gcTime:0,select:N,iterate:I=>{let W=0;return I.courses.forEach(X=>{W+=X.lectures.length}),W<Wt?0:W}}),{mutation:v,requestFunction:C}=ce("PATCH",`/timetables/${h}`,{onSuccess:()=>{A.invalidateQueries({queryKey:[`/timetables/${h}`]})}}),[k,O]=c.useState({courses:[]}),[q,G]=c.useState([]),[Q,Z]=c.useState(0),ee=c.useRef(null),K=c.useRef(null),[oe,Y]=c.useState(!1),{query:M,setParams:P}=ce("GET",`/users/${m?.id}/wishlist`,{enabled:g==="success"&&t!=-1}),{requestFunction:U}=ce("PATCH",`/users/${m?.id}/wishlist`,{onSuccess:()=>{A.invalidateQueries({queryKey:[`/users/${m?.id}/wishlist`]})}}),V=I=>{if(pi(I)){alert(u("common.search.empty"));return}Y(!1);const W={year:t,semester:n,...I,order:["code","popular","studentCount"][Q]??"code",offset:0,limit:Wt,day:I.time?.day??void 0,begin:I.time?.begin??void 0,end:I.time?.end??void 0};D(W),T(!0)};c.useEffect(()=>{Y(!1),D(I=>({...I,order:["code","popular","studentCount"][Q]??"code",offset:0})),T(!0)},[Q]),c.useEffect(()=>{O({courses:[]}),P({year:t,semester:n})},[t,n]),c.useEffect(()=>{x&&S.hasNextPage&&!S.isFetchingNextPage&&S.fetchNextPage()},[x]),c.useEffect(()=>{R!==void 0&&(O(R),Y(!1)),S.hasNextPage||T(!1)},[R]),c.useEffect(()=>{M.data!==void 0&&O(oe?M.data:R??{courses:[]})},[oe]),c.useEffect(()=>{M.data!==void 0&&(G(M.data.courses.flatMap(I=>I.lectures).map(I=>I.id)),oe&&O(M.data))},[M.data]),c.useEffect(()=>{const I=W=>{ee.current&&!ee.current.contains(W.target)&&K.current&&K.current.contains(W.target)&&a(null)};return document.addEventListener("mousedown",I),()=>document.removeEventListener("mousedown",I)},[]);const H=async(I,W)=>{if(g!=="idle"){G(I?X=>X.filter(J=>J!==W):X=>[...X,W]);try{U({lectureId:W,mode:I?"delete":"add"})}catch(X){console.error("Failed to update wishlist:",X),G(I?J=>[...J,W]:J=>J.filter(B=>B!==W))}}},te=async I=>{if(h){if(e.some(W=>fn(W.classes,I.classes))){alert(u("timetable.addLectureConflict"));return}}else{console.warn("No timetable selected");return}C({action:"add",lectureId:I.id})};return y(_i,{direction:"column",justify:"stretch",align:"stretch",gap:8,ref:K,children:[d(eo,{direction:"row",justify:"stretch",gap:0,children:d(fi,{options:["type","department","level","term","time"],timeFilter:s,setTimeFilter:l,onSearch:V})}),y(L,{direction:"row",gap:0,justify:"space-between",align:"center",children:[y(io,{isSelected:oe,onClick:()=>{Y(I=>!I)},style:{paddingBlock:10},children:[d(re,{size:15,color:f.colors.Highlight.default,children:oe?d(gn,{}):d(gr,{})}),d(z,{type:"Normal",color:"Highlight.default",children:u("common.wishlist")})]}),k.courses.length!==0&&d(no,{direction:"row",gap:0,children:d(yi,{options:[u("dictionary.sortOptions.code"),u("dictionary.sortOptions.popularity"),u("dictionary.sortOptions.studentCount")],setSelectedOption:Z,selectedOption:Q})})]}),k.courses.length!==0?y(ro,{direction:"column",gap:12,ref:ee,style:b?{flex:"0 0 auto"}:{},children:[k.courses.map(I=>d(Zi,{course:I,selectedLecture:o,hoveredLecture:r,isInWish:q,isWishlist:oe,currentTimetableId:h,timetableLectures:e,isAddTimetablePending:v.isPending,setHoveredLecture:i,setSelectedLecture:a,handleLikeClick:H,handleAddToTimetable:te,t:u},I.id)),!oe&&S.hasNextPage&&d(nn,{ref:p})]}):d(to,{type:"Bigger",color:"Text.placeholder",children:u("dictionary.noResults")})]})};function ao(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return c.useMemo(()=>r=>{t.forEach(i=>i(r))},t)}const kt=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u";function rt(e){const t=Object.prototype.toString.call(e);return t==="[object Window]"||t==="[object global]"}function yn(e){return"nodeType"in e}function de(e){var t,n;return e?rt(e)?e:yn(e)&&(t=(n=e.ownerDocument)==null?void 0:n.defaultView)!=null?t:window:window}function bn(e){const{Document:t}=de(e);return e instanceof t}function bt(e){return rt(e)?!1:e instanceof de(e).HTMLElement}function vr(e){return e instanceof de(e).SVGElement}function it(e){return e?rt(e)?e.document:yn(e)?bn(e)?e:bt(e)||vr(e)?e.ownerDocument:document:document:document}const Te=kt?c.useLayoutEffect:c.useEffect;function wn(e){const t=c.useRef(e);return Te(()=>{t.current=e}),c.useCallback(function(){for(var n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];return t.current==null?void 0:t.current(...r)},[])}function so(){const e=c.useRef(null),t=c.useCallback((r,i)=>{e.current=setInterval(r,i)},[]),n=c.useCallback(()=>{e.current!==null&&(clearInterval(e.current),e.current=null)},[]);return[t,n]}function mt(e,t){t===void 0&&(t=[e]);const n=c.useRef(e);return Te(()=>{n.current!==e&&(n.current=e)},t),n}function wt(e,t){const n=c.useRef();return c.useMemo(()=>{const r=e(n.current);return n.current=r,r},[...t])}function Rt(e){const t=wn(e),n=c.useRef(null),r=c.useCallback(i=>{i!==n.current&&t?.(i,n.current),n.current=i},[]);return[n,r]}function rn(e){const t=c.useRef();return c.useEffect(()=>{t.current=e},[e]),t.current}let qt={};function xt(e,t){return c.useMemo(()=>{if(t)return t;const n=qt[e]==null?0:qt[e]+1;return qt[e]=n,e+"-"+n},[e,t])}function yr(e){return function(t){for(var n=arguments.length,r=new Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];return r.reduce((o,a)=>{const s=Object.entries(a);for(const[l,h]of s){const u=o[l];u!=null&&(o[l]=u+e*h)}return o},{...t})}}const tt=yr(1),At=yr(-1);function lo(e){return"clientX"in e&&"clientY"in e}function xn(e){if(!e)return!1;const{KeyboardEvent:t}=de(e.target);return t&&e instanceof t}function co(e){if(!e)return!1;const{TouchEvent:t}=de(e.target);return t&&e instanceof t}function on(e){if(co(e)){if(e.touches&&e.touches.length){const{clientX:t,clientY:n}=e.touches[0];return{x:t,y:n}}else if(e.changedTouches&&e.changedTouches.length){const{clientX:t,clientY:n}=e.changedTouches[0];return{x:t,y:n}}}return lo(e)?{x:e.clientX,y:e.clientY}:null}const It=Object.freeze({Translate:{toString(e){if(!e)return;const{x:t,y:n}=e;return"translate3d("+(t?Math.round(t):0)+"px, "+(n?Math.round(n):0)+"px, 0)"}},Scale:{toString(e){if(!e)return;const{scaleX:t,scaleY:n}=e;return"scaleX("+t+") scaleY("+n+")"}},Transform:{toString(e){if(e)return[It.Translate.toString(e),It.Scale.toString(e)].join(" ")}},Transition:{toString(e){let{property:t,duration:n,easing:r}=e;return t+" "+n+"ms "+r}}}),Wn="a,frame,iframe,input:not([type=hidden]):not(:disabled),select:not(:disabled),textarea:not(:disabled),button:not(:disabled),*[tabindex]";function uo(e){return e.matches(Wn)?e:e.querySelector(Wn)}const ho={display:"none"};function fo(e){let{id:t,value:n}=e;return le.createElement("div",{id:t,style:ho},n)}function po(e){let{id:t,announcement:n,ariaLiveType:r="assertive"}=e;const i={position:"fixed",top:0,left:0,width:1,height:1,margin:-1,border:0,padding:0,overflow:"hidden",clip:"rect(0 0 0 0)",clipPath:"inset(100%)",whiteSpace:"nowrap"};return le.createElement("div",{id:t,style:i,role:"status","aria-live":r,"aria-atomic":!0},n)}function go(){const[e,t]=c.useState("");return{announce:c.useCallback(r=>{r!=null&&t(r)},[]),announcement:e}}const br=c.createContext(null);function mo(e){const t=c.useContext(br);c.useEffect(()=>{if(!t)throw new Error("useDndMonitor must be used within a children of <DndContext>");return t(e)},[e,t])}function vo(){const[e]=c.useState(()=>new Set),t=c.useCallback(r=>(e.add(r),()=>e.delete(r)),[e]);return[c.useCallback(r=>{let{type:i,event:o}=r;e.forEach(a=>{var s;return(s=a[i])==null?void 0:s.call(a,o)})},[e]),t]}const yo={draggable:`
    To pick up a draggable item, press the space bar.
    While dragging, use the arrow keys to move the item.
    Press space again to drop the item in its new position, or press escape to cancel.
  `},bo={onDragStart(e){let{active:t}=e;return"Picked up draggable item "+t.id+"."},onDragOver(e){let{active:t,over:n}=e;return n?"Draggable item "+t.id+" was moved over droppable area "+n.id+".":"Draggable item "+t.id+" is no longer over a droppable area."},onDragEnd(e){let{active:t,over:n}=e;return n?"Draggable item "+t.id+" was dropped over droppable area "+n.id:"Draggable item "+t.id+" was dropped."},onDragCancel(e){let{active:t}=e;return"Dragging was cancelled. Draggable item "+t.id+" was dropped."}};function wo(e){let{announcements:t=bo,container:n,hiddenTextDescribedById:r,screenReaderInstructions:i=yo}=e;const{announce:o,announcement:a}=go(),s=xt("DndLiveRegion"),[l,h]=c.useState(!1);if(c.useEffect(()=>{h(!0)},[]),mo(c.useMemo(()=>({onDragStart(f){let{active:m}=f;o(t.onDragStart({active:m}))},onDragMove(f){let{active:m,over:g}=f;t.onDragMove&&o(t.onDragMove({active:m,over:g}))},onDragOver(f){let{active:m,over:g}=f;o(t.onDragOver({active:m,over:g}))},onDragEnd(f){let{active:m,over:g}=f;o(t.onDragEnd({active:m,over:g}))},onDragCancel(f){let{active:m,over:g}=f;o(t.onDragCancel({active:m,over:g}))}}),[o,t])),!l)return null;const u=le.createElement(le.Fragment,null,le.createElement(fo,{id:r,value:i.draggable}),le.createElement(po,{id:s,announcement:a}));return n?ut.createPortal(u,n):u}var _;(function(e){e.DragStart="dragStart",e.DragMove="dragMove",e.DragEnd="dragEnd",e.DragCancel="dragCancel",e.DragOver="dragOver",e.RegisterDroppable="registerDroppable",e.SetDroppableDisabled="setDroppableDisabled",e.UnregisterDroppable="unregisterDroppable"})(_||(_={}));function Nt(){}function qn(e,t){return c.useMemo(()=>({sensor:e,options:t??{}}),[e,t])}function xo(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return c.useMemo(()=>[...t].filter(r=>r!=null),[...t])}const be=Object.freeze({x:0,y:0});function Eo(e,t){return Math.sqrt(Math.pow(e.x-t.x,2)+Math.pow(e.y-t.y,2))}function So(e,t){let{data:{value:n}}=e,{data:{value:r}}=t;return n-r}function To(e,t){let{data:{value:n}}=e,{data:{value:r}}=t;return r-n}function Co(e,t){if(!e||e.length===0)return null;const[n]=e;return n[t]}function Yn(e,t,n){return t===void 0&&(t=e.left),n===void 0&&(n=e.top),{x:t+e.width*.5,y:n+e.height*.5}}const Do=e=>{let{collisionRect:t,droppableRects:n,droppableContainers:r}=e;const i=Yn(t,t.left,t.top),o=[];for(const a of r){const{id:s}=a,l=n.get(s);if(l){const h=Eo(Yn(l),i);o.push({id:s,data:{droppableContainer:a,value:h}})}}return o.sort(So)};function Ro(e,t){const n=Math.max(t.top,e.top),r=Math.max(t.left,e.left),i=Math.min(t.left+t.width,e.left+e.width),o=Math.min(t.top+t.height,e.top+e.height),a=i-r,s=o-n;if(r<i&&n<o){const l=t.width*t.height,h=e.width*e.height,u=a*s,f=u/(l+h-u);return Number(f.toFixed(4))}return 0}const Ao=e=>{let{collisionRect:t,droppableRects:n,droppableContainers:r}=e;const i=[];for(const o of r){const{id:a}=o,s=n.get(a);if(s){const l=Ro(s,t);l>0&&i.push({id:a,data:{droppableContainer:o,value:l}})}}return i.sort(To)};function Io(e,t,n){return{...e,scaleX:t&&n?t.width/n.width:1,scaleY:t&&n?t.height/n.height:1}}function wr(e,t){return e&&t?{x:e.left-t.left,y:e.top-t.top}:be}function No(e){return function(n){for(var r=arguments.length,i=new Array(r>1?r-1:0),o=1;o<r;o++)i[o-1]=arguments[o];return i.reduce((a,s)=>({...a,top:a.top+e*s.y,bottom:a.bottom+e*s.y,left:a.left+e*s.x,right:a.right+e*s.x}),{...n})}}const Mo=No(1);function Lo(e){if(e.startsWith("matrix3d(")){const t=e.slice(9,-1).split(/, /);return{x:+t[12],y:+t[13],scaleX:+t[0],scaleY:+t[5]}}else if(e.startsWith("matrix(")){const t=e.slice(7,-1).split(/, /);return{x:+t[4],y:+t[5],scaleX:+t[0],scaleY:+t[3]}}return null}function Oo(e,t,n){const r=Lo(t);if(!r)return e;const{scaleX:i,scaleY:o,x:a,y:s}=r,l=e.left-a-(1-i)*parseFloat(n),h=e.top-s-(1-o)*parseFloat(n.slice(n.indexOf(" ")+1)),u=i?e.width/i:e.width,f=o?e.height/o:e.height;return{width:u,height:f,top:h,right:l+u,bottom:h+f,left:l}}const ko={ignoreTransform:!1};function ot(e,t){t===void 0&&(t=ko);let n=e.getBoundingClientRect();if(t.ignoreTransform){const{transform:h,transformOrigin:u}=de(e).getComputedStyle(e);h&&(n=Oo(n,h,u))}const{top:r,left:i,width:o,height:a,bottom:s,right:l}=n;return{top:r,left:i,width:o,height:a,bottom:s,right:l}}function Vn(e){return ot(e,{ignoreTransform:!0})}function zo(e){const t=e.innerWidth,n=e.innerHeight;return{top:0,left:0,right:t,bottom:n,width:t,height:n}}function Bo(e,t){return t===void 0&&(t=de(e).getComputedStyle(e)),t.position==="fixed"}function Po(e,t){t===void 0&&(t=de(e).getComputedStyle(e));const n=/(auto|scroll|overlay)/;return["overflow","overflowX","overflowY"].some(i=>{const o=t[i];return typeof o=="string"?n.test(o):!1})}function En(e,t){const n=[];function r(i){if(t!=null&&n.length>=t||!i)return n;if(bn(i)&&i.scrollingElement!=null&&!n.includes(i.scrollingElement))return n.push(i.scrollingElement),n;if(!bt(i)||vr(i)||n.includes(i))return n;const o=de(e).getComputedStyle(i);return i!==e&&Po(i,o)&&n.push(i),Bo(i,o)?n:r(i.parentNode)}return e?r(e):n}function xr(e){const[t]=En(e,1);return t??null}function Yt(e){return!kt||!e?null:rt(e)?e:yn(e)?bn(e)||e===it(e).scrollingElement?window:bt(e)?e:null:null}function Er(e){return rt(e)?e.scrollX:e.scrollLeft}function Sr(e){return rt(e)?e.scrollY:e.scrollTop}function an(e){return{x:Er(e),y:Sr(e)}}var ne;(function(e){e[e.Forward=1]="Forward",e[e.Backward=-1]="Backward"})(ne||(ne={}));function Tr(e){return!kt||!e?!1:e===document.scrollingElement}function Cr(e){const t={x:0,y:0},n=Tr(e)?{height:window.innerHeight,width:window.innerWidth}:{height:e.clientHeight,width:e.clientWidth},r={x:e.scrollWidth-n.width,y:e.scrollHeight-n.height},i=e.scrollTop<=t.y,o=e.scrollLeft<=t.x,a=e.scrollTop>=r.y,s=e.scrollLeft>=r.x;return{isTop:i,isLeft:o,isBottom:a,isRight:s,maxScroll:r,minScroll:t}}const Uo={x:.2,y:.2};function Fo(e,t,n,r,i){let{top:o,left:a,right:s,bottom:l}=n;r===void 0&&(r=10),i===void 0&&(i=Uo);const{isTop:h,isBottom:u,isLeft:f,isRight:m}=Cr(e),g={x:0,y:0},A={x:0,y:0},p={height:t.height*i.y,width:t.width*i.x};return!h&&o<=t.top+p.height?(g.y=ne.Backward,A.y=r*Math.abs((t.top+p.height-o)/p.height)):!u&&l>=t.bottom-p.height&&(g.y=ne.Forward,A.y=r*Math.abs((t.bottom-p.height-l)/p.height)),!m&&s>=t.right-p.width?(g.x=ne.Forward,A.x=r*Math.abs((t.right-p.width-s)/p.width)):!f&&a<=t.left+p.width&&(g.x=ne.Backward,A.x=r*Math.abs((t.left+p.width-a)/p.width)),{direction:g,speed:A}}function $o(e){if(e===document.scrollingElement){const{innerWidth:o,innerHeight:a}=window;return{top:0,left:0,right:o,bottom:a,width:o,height:a}}const{top:t,left:n,right:r,bottom:i}=e.getBoundingClientRect();return{top:t,left:n,right:r,bottom:i,width:e.clientWidth,height:e.clientHeight}}function Dr(e){return e.reduce((t,n)=>tt(t,an(n)),be)}function jo(e){return e.reduce((t,n)=>t+Er(n),0)}function Ho(e){return e.reduce((t,n)=>t+Sr(n),0)}function Wo(e,t){if(t===void 0&&(t=ot),!e)return;const{top:n,left:r,bottom:i,right:o}=t(e);xr(e)&&(i<=0||o<=0||n>=window.innerHeight||r>=window.innerWidth)&&e.scrollIntoView({block:"center",inline:"center"})}const qo=[["x",["left","right"],jo],["y",["top","bottom"],Ho]];class Sn{constructor(t,n){this.rect=void 0,this.width=void 0,this.height=void 0,this.top=void 0,this.bottom=void 0,this.right=void 0,this.left=void 0;const r=En(n),i=Dr(r);this.rect={...t},this.width=t.width,this.height=t.height;for(const[o,a,s]of qo)for(const l of a)Object.defineProperty(this,l,{get:()=>{const h=s(r),u=i[o]-h;return this.rect[l]+u},enumerable:!0});Object.defineProperty(this,"rect",{enumerable:!1})}}class ft{constructor(t){this.target=void 0,this.listeners=[],this.removeAll=()=>{this.listeners.forEach(n=>{var r;return(r=this.target)==null?void 0:r.removeEventListener(...n)})},this.target=t}add(t,n,r){var i;(i=this.target)==null||i.addEventListener(t,n,r),this.listeners.push([t,n,r])}}function Yo(e){const{EventTarget:t}=de(e);return e instanceof t?e:it(e)}function Vt(e,t){const n=Math.abs(e.x),r=Math.abs(e.y);return typeof t=="number"?Math.sqrt(n**2+r**2)>t:"x"in t&&"y"in t?n>t.x&&r>t.y:"x"in t?n>t.x:"y"in t?r>t.y:!1}var ge;(function(e){e.Click="click",e.DragStart="dragstart",e.Keydown="keydown",e.ContextMenu="contextmenu",e.Resize="resize",e.SelectionChange="selectionchange",e.VisibilityChange="visibilitychange"})(ge||(ge={}));function Gn(e){e.preventDefault()}function Vo(e){e.stopPropagation()}var $;(function(e){e.Space="Space",e.Down="ArrowDown",e.Right="ArrowRight",e.Left="ArrowLeft",e.Up="ArrowUp",e.Esc="Escape",e.Enter="Enter",e.Tab="Tab"})($||($={}));const Rr={start:[$.Space,$.Enter],cancel:[$.Esc],end:[$.Space,$.Enter,$.Tab]},Go=(e,t)=>{let{currentCoordinates:n}=t;switch(e.code){case $.Right:return{...n,x:n.x+25};case $.Left:return{...n,x:n.x-25};case $.Down:return{...n,y:n.y+25};case $.Up:return{...n,y:n.y-25}}};class Ar{constructor(t){this.props=void 0,this.autoScrollEnabled=!1,this.referenceCoordinates=void 0,this.listeners=void 0,this.windowListeners=void 0,this.props=t;const{event:{target:n}}=t;this.props=t,this.listeners=new ft(it(n)),this.windowListeners=new ft(de(n)),this.handleKeyDown=this.handleKeyDown.bind(this),this.handleCancel=this.handleCancel.bind(this),this.attach()}attach(){this.handleStart(),this.windowListeners.add(ge.Resize,this.handleCancel),this.windowListeners.add(ge.VisibilityChange,this.handleCancel),setTimeout(()=>this.listeners.add(ge.Keydown,this.handleKeyDown))}handleStart(){const{activeNode:t,onStart:n}=this.props,r=t.node.current;r&&Wo(r),n(be)}handleKeyDown(t){if(xn(t)){const{active:n,context:r,options:i}=this.props,{keyboardCodes:o=Rr,coordinateGetter:a=Go,scrollBehavior:s="smooth"}=i,{code:l}=t;if(o.end.includes(l)){this.handleEnd(t);return}if(o.cancel.includes(l)){this.handleCancel(t);return}const{collisionRect:h}=r.current,u=h?{x:h.left,y:h.top}:be;this.referenceCoordinates||(this.referenceCoordinates=u);const f=a(t,{active:n,context:r.current,currentCoordinates:u});if(f){const m=At(f,u),g={x:0,y:0},{scrollableAncestors:A}=r.current;for(const p of A){const x=t.code,{isTop:E,isRight:T,isLeft:b,isBottom:N,maxScroll:S,minScroll:D}=Cr(p),R=$o(p),v={x:Math.min(x===$.Right?R.right-R.width/2:R.right,Math.max(x===$.Right?R.left:R.left+R.width/2,f.x)),y:Math.min(x===$.Down?R.bottom-R.height/2:R.bottom,Math.max(x===$.Down?R.top:R.top+R.height/2,f.y))},C=x===$.Right&&!T||x===$.Left&&!b,k=x===$.Down&&!N||x===$.Up&&!E;if(C&&v.x!==f.x){const O=p.scrollLeft+m.x,q=x===$.Right&&O<=S.x||x===$.Left&&O>=D.x;if(q&&!m.y){p.scrollTo({left:O,behavior:s});return}q?g.x=p.scrollLeft-O:g.x=x===$.Right?p.scrollLeft-S.x:p.scrollLeft-D.x,g.x&&p.scrollBy({left:-g.x,behavior:s});break}else if(k&&v.y!==f.y){const O=p.scrollTop+m.y,q=x===$.Down&&O<=S.y||x===$.Up&&O>=D.y;if(q&&!m.x){p.scrollTo({top:O,behavior:s});return}q?g.y=p.scrollTop-O:g.y=x===$.Down?p.scrollTop-S.y:p.scrollTop-D.y,g.y&&p.scrollBy({top:-g.y,behavior:s});break}}this.handleMove(t,tt(At(f,this.referenceCoordinates),g))}}}handleMove(t,n){const{onMove:r}=this.props;t.preventDefault(),r(n)}handleEnd(t){const{onEnd:n}=this.props;t.preventDefault(),this.detach(),n()}handleCancel(t){const{onCancel:n}=this.props;t.preventDefault(),this.detach(),n()}detach(){this.listeners.removeAll(),this.windowListeners.removeAll()}}Ar.activators=[{eventName:"onKeyDown",handler:(e,t,n)=>{let{keyboardCodes:r=Rr,onActivation:i}=t,{active:o}=n;const{code:a}=e.nativeEvent;if(r.start.includes(a)){const s=o.activatorNode.current;return s&&e.target!==s?!1:(e.preventDefault(),i?.({event:e.nativeEvent}),!0)}return!1}}];function Xn(e){return!!(e&&"distance"in e)}function Kn(e){return!!(e&&"delay"in e)}class Tn{constructor(t,n,r){var i;r===void 0&&(r=Yo(t.event.target)),this.props=void 0,this.events=void 0,this.autoScrollEnabled=!0,this.document=void 0,this.activated=!1,this.initialCoordinates=void 0,this.timeoutId=null,this.listeners=void 0,this.documentListeners=void 0,this.windowListeners=void 0,this.props=t,this.events=n;const{event:o}=t,{target:a}=o;this.props=t,this.events=n,this.document=it(a),this.documentListeners=new ft(this.document),this.listeners=new ft(r),this.windowListeners=new ft(de(a)),this.initialCoordinates=(i=on(o))!=null?i:be,this.handleStart=this.handleStart.bind(this),this.handleMove=this.handleMove.bind(this),this.handleEnd=this.handleEnd.bind(this),this.handleCancel=this.handleCancel.bind(this),this.handleKeydown=this.handleKeydown.bind(this),this.removeTextSelection=this.removeTextSelection.bind(this),this.attach()}attach(){const{events:t,props:{options:{activationConstraint:n,bypassActivationConstraint:r}}}=this;if(this.listeners.add(t.move.name,this.handleMove,{passive:!1}),this.listeners.add(t.end.name,this.handleEnd),t.cancel&&this.listeners.add(t.cancel.name,this.handleCancel),this.windowListeners.add(ge.Resize,this.handleCancel),this.windowListeners.add(ge.DragStart,Gn),this.windowListeners.add(ge.VisibilityChange,this.handleCancel),this.windowListeners.add(ge.ContextMenu,Gn),this.documentListeners.add(ge.Keydown,this.handleKeydown),n){if(r!=null&&r({event:this.props.event,activeNode:this.props.activeNode,options:this.props.options}))return this.handleStart();if(Kn(n)){this.timeoutId=setTimeout(this.handleStart,n.delay),this.handlePending(n);return}if(Xn(n)){this.handlePending(n);return}}this.handleStart()}detach(){this.listeners.removeAll(),this.windowListeners.removeAll(),setTimeout(this.documentListeners.removeAll,50),this.timeoutId!==null&&(clearTimeout(this.timeoutId),this.timeoutId=null)}handlePending(t,n){const{active:r,onPending:i}=this.props;i(r,t,this.initialCoordinates,n)}handleStart(){const{initialCoordinates:t}=this,{onStart:n}=this.props;t&&(this.activated=!0,this.documentListeners.add(ge.Click,Vo,{capture:!0}),this.removeTextSelection(),this.documentListeners.add(ge.SelectionChange,this.removeTextSelection),n(t))}handleMove(t){var n;const{activated:r,initialCoordinates:i,props:o}=this,{onMove:a,options:{activationConstraint:s}}=o;if(!i)return;const l=(n=on(t))!=null?n:be,h=At(i,l);if(!r&&s){if(Xn(s)){if(s.tolerance!=null&&Vt(h,s.tolerance))return this.handleCancel();if(Vt(h,s.distance))return this.handleStart()}if(Kn(s)&&Vt(h,s.tolerance))return this.handleCancel();this.handlePending(s,h);return}t.cancelable&&t.preventDefault(),a(l)}handleEnd(){const{onAbort:t,onEnd:n}=this.props;this.detach(),this.activated||t(this.props.active),n()}handleCancel(){const{onAbort:t,onCancel:n}=this.props;this.detach(),this.activated||t(this.props.active),n()}handleKeydown(t){t.code===$.Esc&&this.handleCancel()}removeTextSelection(){var t;(t=this.document.getSelection())==null||t.removeAllRanges()}}const Xo={cancel:{name:"pointercancel"},move:{name:"pointermove"},end:{name:"pointerup"}};class Cn extends Tn{constructor(t){const{event:n}=t,r=it(n.target);super(t,Xo,r)}}Cn.activators=[{eventName:"onPointerDown",handler:(e,t)=>{let{nativeEvent:n}=e,{onActivation:r}=t;return!n.isPrimary||n.button!==0?!1:(r?.({event:n}),!0)}}];const Ko={move:{name:"mousemove"},end:{name:"mouseup"}};var sn;(function(e){e[e.RightClick=2]="RightClick"})(sn||(sn={}));class Qo extends Tn{constructor(t){super(t,Ko,it(t.event.target))}}Qo.activators=[{eventName:"onMouseDown",handler:(e,t)=>{let{nativeEvent:n}=e,{onActivation:r}=t;return n.button===sn.RightClick?!1:(r?.({event:n}),!0)}}];const Gt={cancel:{name:"touchcancel"},move:{name:"touchmove"},end:{name:"touchend"}};class Ir extends Tn{constructor(t){super(t,Gt)}static setup(){return window.addEventListener(Gt.move.name,t,{capture:!1,passive:!1}),function(){window.removeEventListener(Gt.move.name,t)};function t(){}}}Ir.activators=[{eventName:"onTouchStart",handler:(e,t)=>{let{nativeEvent:n}=e,{onActivation:r}=t;const{touches:i}=n;return i.length>1?!1:(r?.({event:n}),!0)}}];var pt;(function(e){e[e.Pointer=0]="Pointer",e[e.DraggableRect=1]="DraggableRect"})(pt||(pt={}));var Mt;(function(e){e[e.TreeOrder=0]="TreeOrder",e[e.ReversedTreeOrder=1]="ReversedTreeOrder"})(Mt||(Mt={}));function Jo(e){let{acceleration:t,activator:n=pt.Pointer,canScroll:r,draggingRect:i,enabled:o,interval:a=5,order:s=Mt.TreeOrder,pointerCoordinates:l,scrollableAncestors:h,scrollableAncestorRects:u,delta:f,threshold:m}=e;const g=_o({delta:f,disabled:!o}),[A,p]=so(),x=c.useRef({x:0,y:0}),E=c.useRef({x:0,y:0}),T=c.useMemo(()=>{switch(n){case pt.Pointer:return l?{top:l.y,bottom:l.y,left:l.x,right:l.x}:null;case pt.DraggableRect:return i}},[n,i,l]),b=c.useRef(null),N=c.useCallback(()=>{const D=b.current;if(!D)return;const R=x.current.x*E.current.x,v=x.current.y*E.current.y;D.scrollBy(R,v)},[]),S=c.useMemo(()=>s===Mt.TreeOrder?[...h].reverse():h,[s,h]);c.useEffect(()=>{if(!o||!h.length||!T){p();return}for(const D of S){if(r?.(D)===!1)continue;const R=h.indexOf(D),v=u[R];if(!v)continue;const{direction:C,speed:k}=Fo(D,v,T,t,m);for(const O of["x","y"])g[O][C[O]]||(k[O]=0,C[O]=0);if(k.x>0||k.y>0){p(),b.current=D,A(N,a),x.current=k,E.current=C;return}}x.current={x:0,y:0},E.current={x:0,y:0},p()},[t,N,r,p,o,a,JSON.stringify(T),JSON.stringify(g),A,h,S,u,JSON.stringify(m)])}const Zo={x:{[ne.Backward]:!1,[ne.Forward]:!1},y:{[ne.Backward]:!1,[ne.Forward]:!1}};function _o(e){let{delta:t,disabled:n}=e;const r=rn(t);return wt(i=>{if(n||!r||!i)return Zo;const o={x:Math.sign(t.x-r.x),y:Math.sign(t.y-r.y)};return{x:{[ne.Backward]:i.x[ne.Backward]||o.x===-1,[ne.Forward]:i.x[ne.Forward]||o.x===1},y:{[ne.Backward]:i.y[ne.Backward]||o.y===-1,[ne.Forward]:i.y[ne.Forward]||o.y===1}}},[n,t,r])}function ea(e,t){const n=t!=null?e.get(t):void 0,r=n?n.node.current:null;return wt(i=>{var o;return t==null?null:(o=r??i)!=null?o:null},[r,t])}function ta(e,t){return c.useMemo(()=>e.reduce((n,r)=>{const{sensor:i}=r,o=i.activators.map(a=>({eventName:a.eventName,handler:t(a.handler,r)}));return[...n,...o]},[]),[e,t])}var vt;(function(e){e[e.Always=0]="Always",e[e.BeforeDragging=1]="BeforeDragging",e[e.WhileDragging=2]="WhileDragging"})(vt||(vt={}));var ln;(function(e){e.Optimized="optimized"})(ln||(ln={}));const Qn=new Map;function na(e,t){let{dragging:n,dependencies:r,config:i}=t;const[o,a]=c.useState(null),{frequency:s,measure:l,strategy:h}=i,u=c.useRef(e),f=x(),m=mt(f),g=c.useCallback(function(E){E===void 0&&(E=[]),!m.current&&a(T=>T===null?E:T.concat(E.filter(b=>!T.includes(b))))},[m]),A=c.useRef(null),p=wt(E=>{if(f&&!n)return Qn;if(!E||E===Qn||u.current!==e||o!=null){const T=new Map;for(let b of e){if(!b)continue;if(o&&o.length>0&&!o.includes(b.id)&&b.rect.current){T.set(b.id,b.rect.current);continue}const N=b.node.current,S=N?new Sn(l(N),N):null;b.rect.current=S,S&&T.set(b.id,S)}return T}return E},[e,o,n,f,l]);return c.useEffect(()=>{u.current=e},[e]),c.useEffect(()=>{f||g()},[n,f]),c.useEffect(()=>{o&&o.length>0&&a(null)},[JSON.stringify(o)]),c.useEffect(()=>{f||typeof s!="number"||A.current!==null||(A.current=setTimeout(()=>{g(),A.current=null},s))},[s,f,g,...r]),{droppableRects:p,measureDroppableContainers:g,measuringScheduled:o!=null};function x(){switch(h){case vt.Always:return!1;case vt.BeforeDragging:return n;default:return!n}}}function Nr(e,t){return wt(n=>e?n||(typeof t=="function"?t(e):e):null,[t,e])}function ra(e,t){return Nr(e,t)}function ia(e){let{callback:t,disabled:n}=e;const r=wn(t),i=c.useMemo(()=>{if(n||typeof window>"u"||typeof window.MutationObserver>"u")return;const{MutationObserver:o}=window;return new o(r)},[r,n]);return c.useEffect(()=>()=>i?.disconnect(),[i]),i}function zt(e){let{callback:t,disabled:n}=e;const r=wn(t),i=c.useMemo(()=>{if(n||typeof window>"u"||typeof window.ResizeObserver>"u")return;const{ResizeObserver:o}=window;return new o(r)},[n]);return c.useEffect(()=>()=>i?.disconnect(),[i]),i}function oa(e){return new Sn(ot(e),e)}function Jn(e,t,n){t===void 0&&(t=oa);const[r,i]=c.useState(null);function o(){i(l=>{if(!e)return null;if(e.isConnected===!1){var h;return(h=l??n)!=null?h:null}const u=t(e);return JSON.stringify(l)===JSON.stringify(u)?l:u})}const a=ia({callback(l){if(e)for(const h of l){const{type:u,target:f}=h;if(u==="childList"&&f instanceof HTMLElement&&f.contains(e)){o();break}}}}),s=zt({callback:o});return Te(()=>{o(),e?(s?.observe(e),a?.observe(document.body,{childList:!0,subtree:!0})):(s?.disconnect(),a?.disconnect())},[e]),r}function aa(e){const t=Nr(e);return wr(e,t)}const Zn=[];function sa(e){const t=c.useRef(e),n=wt(r=>e?r&&r!==Zn&&e&&t.current&&e.parentNode===t.current.parentNode?r:En(e):Zn,[e]);return c.useEffect(()=>{t.current=e},[e]),n}function la(e){const[t,n]=c.useState(null),r=c.useRef(e),i=c.useCallback(o=>{const a=Yt(o.target);a&&n(s=>s?(s.set(a,an(a)),new Map(s)):null)},[]);return c.useEffect(()=>{const o=r.current;if(e!==o){a(o);const s=e.map(l=>{const h=Yt(l);return h?(h.addEventListener("scroll",i,{passive:!0}),[h,an(h)]):null}).filter(l=>l!=null);n(s.length?new Map(s):null),r.current=e}return()=>{a(e),a(o)};function a(s){s.forEach(l=>{const h=Yt(l);h?.removeEventListener("scroll",i)})}},[i,e]),c.useMemo(()=>e.length?t?Array.from(t.values()).reduce((o,a)=>tt(o,a),be):Dr(e):be,[e,t])}function _n(e,t){t===void 0&&(t=[]);const n=c.useRef(null);return c.useEffect(()=>{n.current=null},t),c.useEffect(()=>{const r=e!==be;r&&!n.current&&(n.current=e),!r&&n.current&&(n.current=null)},[e]),n.current?At(e,n.current):be}function ca(e){c.useEffect(()=>{if(!kt)return;const t=e.map(n=>{let{sensor:r}=n;return r.setup==null?void 0:r.setup()});return()=>{for(const n of t)n?.()}},e.map(t=>{let{sensor:n}=t;return n}))}function da(e,t){return c.useMemo(()=>e.reduce((n,r)=>{let{eventName:i,handler:o}=r;return n[i]=a=>{o(a,t)},n},{}),[e,t])}function Mr(e){return c.useMemo(()=>e?zo(e):null,[e])}const er=[];function ua(e,t){t===void 0&&(t=ot);const[n]=e,r=Mr(n?de(n):null),[i,o]=c.useState(er);function a(){o(()=>e.length?e.map(l=>Tr(l)?r:new Sn(t(l),l)):er)}const s=zt({callback:a});return Te(()=>{s?.disconnect(),a(),e.forEach(l=>s?.observe(l))},[e]),i}function ha(e){if(!e)return null;if(e.children.length>1)return e;const t=e.children[0];return bt(t)?t:e}function fa(e){let{measure:t}=e;const[n,r]=c.useState(null),i=c.useCallback(h=>{for(const{target:u}of h)if(bt(u)){r(f=>{const m=t(u);return f?{...f,width:m.width,height:m.height}:m});break}},[t]),o=zt({callback:i}),a=c.useCallback(h=>{const u=ha(h);o?.disconnect(),u&&o?.observe(u),r(u?t(u):null)},[t,o]),[s,l]=Rt(a);return c.useMemo(()=>({nodeRef:s,rect:n,setRef:l}),[n,s,l])}const pa=[{sensor:Cn,options:{}},{sensor:Ar,options:{}}],ga={current:{}},Dt={draggable:{measure:Vn},droppable:{measure:Vn,strategy:vt.WhileDragging,frequency:ln.Optimized},dragOverlay:{measure:ot}};class gt extends Map{get(t){var n;return t!=null&&(n=super.get(t))!=null?n:void 0}toArray(){return Array.from(this.values())}getEnabled(){return this.toArray().filter(t=>{let{disabled:n}=t;return!n})}getNodeFor(t){var n,r;return(n=(r=this.get(t))==null?void 0:r.node.current)!=null?n:void 0}}const ma={activatorEvent:null,active:null,activeNode:null,activeNodeRect:null,collisions:null,containerNodeRect:null,draggableNodes:new Map,droppableRects:new Map,droppableContainers:new gt,over:null,dragOverlay:{nodeRef:{current:null},rect:null,setRef:Nt},scrollableAncestors:[],scrollableAncestorRects:[],measuringConfiguration:Dt,measureDroppableContainers:Nt,windowRect:null,measuringScheduled:!1},va={activatorEvent:null,activators:[],active:null,activeNodeRect:null,ariaDescribedById:{draggable:""},dispatch:Nt,draggableNodes:new Map,over:null,measureDroppableContainers:Nt},Bt=c.createContext(va),Lr=c.createContext(ma);function ya(){return{draggable:{active:null,initialCoordinates:{x:0,y:0},nodes:new Map,translate:{x:0,y:0}},droppable:{containers:new gt}}}function ba(e,t){switch(t.type){case _.DragStart:return{...e,draggable:{...e.draggable,initialCoordinates:t.initialCoordinates,active:t.active}};case _.DragMove:return e.draggable.active==null?e:{...e,draggable:{...e.draggable,translate:{x:t.coordinates.x-e.draggable.initialCoordinates.x,y:t.coordinates.y-e.draggable.initialCoordinates.y}}};case _.DragEnd:case _.DragCancel:return{...e,draggable:{...e.draggable,active:null,initialCoordinates:{x:0,y:0},translate:{x:0,y:0}}};case _.RegisterDroppable:{const{element:n}=t,{id:r}=n,i=new gt(e.droppable.containers);return i.set(r,n),{...e,droppable:{...e.droppable,containers:i}}}case _.SetDroppableDisabled:{const{id:n,key:r,disabled:i}=t,o=e.droppable.containers.get(n);if(!o||r!==o.key)return e;const a=new gt(e.droppable.containers);return a.set(n,{...o,disabled:i}),{...e,droppable:{...e.droppable,containers:a}}}case _.UnregisterDroppable:{const{id:n,key:r}=t,i=e.droppable.containers.get(n);if(!i||r!==i.key)return e;const o=new gt(e.droppable.containers);return o.delete(n),{...e,droppable:{...e.droppable,containers:o}}}default:return e}}function wa(e){let{disabled:t}=e;const{active:n,activatorEvent:r,draggableNodes:i}=c.useContext(Bt),o=rn(r),a=rn(n?.id);return c.useEffect(()=>{if(!t&&!r&&o&&a!=null){if(!xn(o)||document.activeElement===o.target)return;const s=i.get(a);if(!s)return;const{activatorNode:l,node:h}=s;if(!l.current&&!h.current)return;requestAnimationFrame(()=>{for(const u of[l.current,h.current]){if(!u)continue;const f=uo(u);if(f){f.focus();break}}})}},[r,t,i,a,o]),null}function xa(e,t){let{transform:n,...r}=t;return e!=null&&e.length?e.reduce((i,o)=>o({transform:i,...r}),n):n}function Ea(e){return c.useMemo(()=>({draggable:{...Dt.draggable,...e?.draggable},droppable:{...Dt.droppable,...e?.droppable},dragOverlay:{...Dt.dragOverlay,...e?.dragOverlay}}),[e?.draggable,e?.droppable,e?.dragOverlay])}function Sa(e){let{activeNode:t,measure:n,initialRect:r,config:i=!0}=e;const o=c.useRef(!1),{x:a,y:s}=typeof i=="boolean"?{x:i,y:i}:i;Te(()=>{if(!a&&!s||!t){o.current=!1;return}if(o.current||!r)return;const h=t?.node.current;if(!h||h.isConnected===!1)return;const u=n(h),f=wr(u,r);if(a||(f.x=0),s||(f.y=0),o.current=!0,Math.abs(f.x)>0||Math.abs(f.y)>0){const m=xr(h);m&&m.scrollBy({top:f.y,left:f.x})}},[t,a,s,r,n])}const Or=c.createContext({...be,scaleX:1,scaleY:1});var Pe;(function(e){e[e.Uninitialized=0]="Uninitialized",e[e.Initializing=1]="Initializing",e[e.Initialized=2]="Initialized"})(Pe||(Pe={}));const Ta=c.memo(function(t){var n,r,i,o;let{id:a,accessibility:s,autoScroll:l=!0,children:h,sensors:u=pa,collisionDetection:f=Ao,measuring:m,modifiers:g,...A}=t;const p=c.useReducer(ba,void 0,ya),[x,E]=p,[T,b]=vo(),[N,S]=c.useState(Pe.Uninitialized),D=N===Pe.Initialized,{draggable:{active:R,nodes:v,translate:C},droppable:{containers:k}}=x,O=R!=null?v.get(R):null,q=c.useRef({initial:null,translated:null}),G=c.useMemo(()=>{var se;return R!=null?{id:R,data:(se=O?.data)!=null?se:ga,rect:q}:null},[R,O]),Q=c.useRef(null),[Z,ee]=c.useState(null),[K,oe]=c.useState(null),Y=mt(A,Object.values(A)),M=xt("DndDescribedBy",a),P=c.useMemo(()=>k.getEnabled(),[k]),U=Ea(m),{droppableRects:V,measureDroppableContainers:H,measuringScheduled:te}=na(P,{dragging:D,dependencies:[C.x,C.y],config:U.droppable}),I=ea(v,R),W=c.useMemo(()=>K?on(K):null,[K]),X=ri(),J=ra(I,U.draggable.measure);Sa({activeNode:R!=null?v.get(R):null,config:X.layoutShiftCompensation,initialRect:J,measure:U.draggable.measure});const B=Jn(I,U.draggable.measure,J),Me=Jn(I?I.parentElement:null),ae=c.useRef({activatorEvent:null,active:null,activeNode:I,collisionRect:null,collisions:null,droppableRects:V,draggableNodes:v,draggingNode:null,draggingNodeRect:null,droppableContainers:k,over:null,scrollableAncestors:[],scrollAdjustedTranslate:null}),je=k.getNodeFor((n=ae.current.over)==null?void 0:n.id),Ce=fa({measure:U.dragOverlay.measure}),He=(r=Ce.nodeRef.current)!=null?r:I,We=D?(i=Ce.rect)!=null?i:B:null,Nn=!!(Ce.nodeRef.current&&Ce.rect),Mn=aa(Nn?null:B),Ft=Mr(He?de(He):null),Le=sa(D?je??I:null),Et=ua(Le),St=xa(g,{transform:{x:C.x-Mn.x,y:C.y-Mn.y,scaleX:1,scaleY:1},activatorEvent:K,active:G,activeNodeRect:B,containerNodeRect:Me,draggingNodeRect:We,over:ae.current.over,overlayNodeRect:Ce.rect,scrollableAncestors:Le,scrollableAncestorRects:Et,windowRect:Ft}),Ln=W?tt(W,C):null,On=la(Le),Qr=_n(On),Jr=_n(On,[B]),qe=tt(St,Qr),Ye=We?Mo(We,St):null,at=G&&Ye?f({active:G,collisionRect:Ye,droppableRects:V,droppableContainers:P,pointerCoordinates:Ln}):null,kn=Co(at,"id"),[Oe,zn]=c.useState(null),Zr=Nn?St:tt(St,Jr),_r=Io(Zr,(o=Oe?.rect)!=null?o:null,B),$t=c.useRef(null),Bn=c.useCallback((se,ue)=>{let{sensor:he,options:ke}=ue;if(Q.current==null)return;const pe=v.get(Q.current);if(!pe)return;const fe=se.nativeEvent,xe=new he({active:Q.current,activeNode:pe,event:fe,options:ke,context:ae,onAbort(ie){if(!v.get(ie))return;const{onDragAbort:Ee}=Y.current,De={id:ie};Ee?.(De),T({type:"onDragAbort",event:De})},onPending(ie,ze,Ee,De){if(!v.get(ie))return;const{onDragPending:lt}=Y.current,Be={id:ie,constraint:ze,initialCoordinates:Ee,offset:De};lt?.(Be),T({type:"onDragPending",event:Be})},onStart(ie){const ze=Q.current;if(ze==null)return;const Ee=v.get(ze);if(!Ee)return;const{onDragStart:De}=Y.current,st={activatorEvent:fe,active:{id:ze,data:Ee.data,rect:q}};ut.unstable_batchedUpdates(()=>{De?.(st),S(Pe.Initializing),E({type:_.DragStart,initialCoordinates:ie,active:ze}),T({type:"onDragStart",event:st}),ee($t.current),oe(fe)})},onMove(ie){E({type:_.DragMove,coordinates:ie})},onEnd:Ve(_.DragEnd),onCancel:Ve(_.DragCancel)});$t.current=xe;function Ve(ie){return async function(){const{active:Ee,collisions:De,over:st,scrollAdjustedTranslate:lt}=ae.current;let Be=null;if(Ee&&lt){const{cancelDrop:ct}=Y.current;Be={activatorEvent:fe,active:Ee,collisions:De,delta:lt,over:st},ie===_.DragEnd&&typeof ct=="function"&&await Promise.resolve(ct(Be))&&(ie=_.DragCancel)}Q.current=null,ut.unstable_batchedUpdates(()=>{E({type:ie}),S(Pe.Uninitialized),zn(null),ee(null),oe(null),$t.current=null;const ct=ie===_.DragEnd?"onDragEnd":"onDragCancel";if(Be){const jt=Y.current[ct];jt?.(Be),T({type:ct,event:Be})}})}}},[v]),ei=c.useCallback((se,ue)=>(he,ke)=>{const pe=he.nativeEvent,fe=v.get(ke);if(Q.current!==null||!fe||pe.dndKit||pe.defaultPrevented)return;const xe={active:fe};se(he,ue.options,xe)===!0&&(pe.dndKit={capturedBy:ue.sensor},Q.current=ke,Bn(he,ue))},[v,Bn]),Pn=ta(u,ei);ca(u),Te(()=>{B&&N===Pe.Initializing&&S(Pe.Initialized)},[B,N]),c.useEffect(()=>{const{onDragMove:se}=Y.current,{active:ue,activatorEvent:he,collisions:ke,over:pe}=ae.current;if(!ue||!he)return;const fe={active:ue,activatorEvent:he,collisions:ke,delta:{x:qe.x,y:qe.y},over:pe};ut.unstable_batchedUpdates(()=>{se?.(fe),T({type:"onDragMove",event:fe})})},[qe.x,qe.y]),c.useEffect(()=>{const{active:se,activatorEvent:ue,collisions:he,droppableContainers:ke,scrollAdjustedTranslate:pe}=ae.current;if(!se||Q.current==null||!ue||!pe)return;const{onDragOver:fe}=Y.current,xe=ke.get(kn),Ve=xe&&xe.rect.current?{id:xe.id,rect:xe.rect.current,data:xe.data,disabled:xe.disabled}:null,ie={active:se,activatorEvent:ue,collisions:he,delta:{x:pe.x,y:pe.y},over:Ve};ut.unstable_batchedUpdates(()=>{zn(Ve),fe?.(ie),T({type:"onDragOver",event:ie})})},[kn]),Te(()=>{ae.current={activatorEvent:K,active:G,activeNode:I,collisionRect:Ye,collisions:at,droppableRects:V,draggableNodes:v,draggingNode:He,draggingNodeRect:We,droppableContainers:k,over:Oe,scrollableAncestors:Le,scrollAdjustedTranslate:qe},q.current={initial:We,translated:Ye}},[G,I,at,Ye,v,He,We,V,k,Oe,Le,qe]),Jo({...X,delta:C,draggingRect:Ye,pointerCoordinates:Ln,scrollableAncestors:Le,scrollableAncestorRects:Et});const ti=c.useMemo(()=>({active:G,activeNode:I,activeNodeRect:B,activatorEvent:K,collisions:at,containerNodeRect:Me,dragOverlay:Ce,draggableNodes:v,droppableContainers:k,droppableRects:V,over:Oe,measureDroppableContainers:H,scrollableAncestors:Le,scrollableAncestorRects:Et,measuringConfiguration:U,measuringScheduled:te,windowRect:Ft}),[G,I,B,K,at,Me,Ce,v,k,V,Oe,H,Le,Et,U,te,Ft]),ni=c.useMemo(()=>({activatorEvent:K,activators:Pn,active:G,activeNodeRect:B,ariaDescribedById:{draggable:M},dispatch:E,draggableNodes:v,over:Oe,measureDroppableContainers:H}),[K,Pn,G,B,E,M,v,Oe,H]);return le.createElement(br.Provider,{value:b},le.createElement(Bt.Provider,{value:ni},le.createElement(Lr.Provider,{value:ti},le.createElement(Or.Provider,{value:_r},h)),le.createElement(wa,{disabled:s?.restoreFocus===!1})),le.createElement(wo,{...s,hiddenTextDescribedById:M}));function ri(){const se=Z?.autoScrollEnabled===!1,ue=typeof l=="object"?l.enabled===!1:l===!1,he=D&&!se&&!ue;return typeof l=="object"?{...l,enabled:he}:{enabled:he}}}),Ca=c.createContext(null),tr="button",Da="Draggable";function Ra(e){let{id:t,data:n,disabled:r=!1,attributes:i}=e;const o=xt(Da),{activators:a,activatorEvent:s,active:l,activeNodeRect:h,ariaDescribedById:u,draggableNodes:f,over:m}=c.useContext(Bt),{role:g=tr,roleDescription:A="draggable",tabIndex:p=0}=i??{},x=l?.id===t,E=c.useContext(x?Or:Ca),[T,b]=Rt(),[N,S]=Rt(),D=da(a,t),R=mt(n);Te(()=>(f.set(t,{id:t,key:o,node:T,activatorNode:N,data:R}),()=>{const C=f.get(t);C&&C.key===o&&f.delete(t)}),[f,t]);const v=c.useMemo(()=>({role:g,tabIndex:p,"aria-disabled":r,"aria-pressed":x&&g===tr?!0:void 0,"aria-roledescription":A,"aria-describedby":u.draggable}),[r,g,p,x,A,u.draggable]);return{active:l,activatorEvent:s,activeNodeRect:h,attributes:v,isDragging:x,listeners:r?void 0:D,node:T,over:m,setNodeRef:b,setActivatorNodeRef:S,transform:E}}function Aa(){return c.useContext(Lr)}const Ia="Droppable",Na={timeout:25};function Ma(e){let{data:t,disabled:n=!1,id:r,resizeObserverConfig:i}=e;const o=xt(Ia),{active:a,dispatch:s,over:l,measureDroppableContainers:h}=c.useContext(Bt),u=c.useRef({disabled:n}),f=c.useRef(!1),m=c.useRef(null),g=c.useRef(null),{disabled:A,updateMeasurementsFor:p,timeout:x}={...Na,...i},E=mt(p??r),T=c.useCallback(()=>{if(!f.current){f.current=!0;return}g.current!=null&&clearTimeout(g.current),g.current=setTimeout(()=>{h(Array.isArray(E.current)?E.current:[E.current]),g.current=null},x)},[x]),b=zt({callback:T,disabled:A||!a}),N=c.useCallback((v,C)=>{b&&(C&&(b.unobserve(C),f.current=!1),v&&b.observe(v))},[b]),[S,D]=Rt(N),R=mt(t);return c.useEffect(()=>{!b||!S.current||(b.disconnect(),f.current=!1,b.observe(S.current))},[S,b]),c.useEffect(()=>(s({type:_.RegisterDroppable,element:{id:r,key:o,disabled:n,node:S,rect:m,data:R}}),()=>s({type:_.UnregisterDroppable,key:o,id:r})),[r]),c.useEffect(()=>{n!==u.current.disabled&&(s({type:_.SetDroppableDisabled,id:r,key:o,disabled:n}),u.current.disabled=n)},[r,o,n,s]),{active:a,rect:m,isOver:l?.id===r,node:S,over:l,setNodeRef:D}}const La=e=>{let{transform:t}=e;return{...t,y:0}};function Oa(e,t,n){const r={...e};return t.top+e.y<=n.top?r.y=n.top-t.top:t.bottom+e.y>=n.top+n.height&&(r.y=n.top+n.height-t.bottom),t.left+e.x<=n.left?r.x=n.left-t.left:t.right+e.x>=n.left+n.width&&(r.x=n.left+n.width-t.right),r}const ka=e=>{let{containerNodeRect:t,draggingNodeRect:n,transform:r}=e;return!n||!t?r:Oa(r,n,t)};function Dn(e,t,n){const r=e.slice();return r.splice(n<0?r.length+n:n,0,r.splice(t,1)[0]),r}function za(e,t){return e.reduce((n,r,i)=>{const o=t.get(r);return o&&(n[i]=o),n},Array(e.length))}function Tt(e){return e!==null&&e>=0}function Ba(e,t){if(e===t)return!0;if(e.length!==t.length)return!1;for(let n=0;n<e.length;n++)if(e[n]!==t[n])return!1;return!0}function Pa(e){return typeof e=="boolean"?{draggable:e,droppable:e}:e}const Ct={scaleX:1,scaleY:1},Ua=e=>{var t;let{rects:n,activeNodeRect:r,activeIndex:i,overIndex:o,index:a}=e;const s=(t=n[i])!=null?t:r;if(!s)return null;const l=Fa(n,a,i);if(a===i){const h=n[o];return h?{x:i<o?h.left+h.width-(s.left+s.width):h.left-s.left,y:0,...Ct}:null}return a>i&&a<=o?{x:-s.width-l,y:0,...Ct}:a<i&&a>=o?{x:s.width+l,y:0,...Ct}:{x:0,y:0,...Ct}};function Fa(e,t,n){const r=e[t],i=e[t-1],o=e[t+1];return!r||!i&&!o?0:n<t?i?r.left-(i.left+i.width):o.left-(r.left+r.width):o?o.left-(r.left+r.width):r.left-(i.left+i.width)}const kr=e=>{let{rects:t,activeIndex:n,overIndex:r,index:i}=e;const o=Dn(t,r,n),a=t[i],s=o[i];return!s||!a?null:{x:s.left-a.left,y:s.top-a.top,scaleX:s.width/a.width,scaleY:s.height/a.height}},zr="Sortable",Br=le.createContext({activeIndex:-1,containerId:zr,disableTransforms:!1,items:[],overIndex:-1,useDragOverlay:!1,sortedRects:[],strategy:kr,disabled:{draggable:!1,droppable:!1}});function $a(e){let{children:t,id:n,items:r,strategy:i=kr,disabled:o=!1}=e;const{active:a,dragOverlay:s,droppableRects:l,over:h,measureDroppableContainers:u}=Aa(),f=xt(zr,n),m=s.rect!==null,g=c.useMemo(()=>r.map(D=>typeof D=="object"&&"id"in D?D.id:D),[r]),A=a!=null,p=a?g.indexOf(a.id):-1,x=h?g.indexOf(h.id):-1,E=c.useRef(g),T=!Ba(g,E.current),b=x!==-1&&p===-1||T,N=Pa(o);Te(()=>{T&&A&&u(g)},[T,g,A,u]),c.useEffect(()=>{E.current=g},[g]);const S=c.useMemo(()=>({activeIndex:p,containerId:f,disabled:N,disableTransforms:b,items:g,overIndex:x,useDragOverlay:m,sortedRects:za(g,l),strategy:i}),[p,f,N.draggable,N.droppable,b,g,x,l,m,i]);return le.createElement(Br.Provider,{value:S},t)}const ja=e=>{let{id:t,items:n,activeIndex:r,overIndex:i}=e;return Dn(n,r,i).indexOf(t)},Ha=e=>{let{containerId:t,isSorting:n,wasDragging:r,index:i,items:o,newIndex:a,previousItems:s,previousContainerId:l,transition:h}=e;return!h||!r||s!==o&&i===a?!1:n?!0:a!==i&&t===l},Wa={duration:200,easing:"ease"},Pr="transform",qa=It.Transition.toString({property:Pr,duration:0,easing:"linear"}),Ya={roleDescription:"sortable"};function Va(e){let{disabled:t,index:n,node:r,rect:i}=e;const[o,a]=c.useState(null),s=c.useRef(n);return Te(()=>{if(!t&&n!==s.current&&r.current){const l=i.current;if(l){const h=ot(r.current,{ignoreTransform:!0}),u={x:l.left-h.left,y:l.top-h.top,scaleX:l.width/h.width,scaleY:l.height/h.height};(u.x||u.y)&&a(u)}}n!==s.current&&(s.current=n)},[t,n,r,i]),c.useEffect(()=>{o&&a(null)},[o]),o}function Ga(e){let{animateLayoutChanges:t=Ha,attributes:n,disabled:r,data:i,getNewIndex:o=ja,id:a,strategy:s,resizeObserverConfig:l,transition:h=Wa}=e;const{items:u,containerId:f,activeIndex:m,disabled:g,disableTransforms:A,sortedRects:p,overIndex:x,useDragOverlay:E,strategy:T}=c.useContext(Br),b=Xa(r,g),N=u.indexOf(a),S=c.useMemo(()=>({sortable:{containerId:f,index:N,items:u},...i}),[f,i,N,u]),D=c.useMemo(()=>u.slice(u.indexOf(a)),[u,a]),{rect:R,node:v,isOver:C,setNodeRef:k}=Ma({id:a,data:S,disabled:b.droppable,resizeObserverConfig:{updateMeasurementsFor:D,...l}}),{active:O,activatorEvent:q,activeNodeRect:G,attributes:Q,setNodeRef:Z,listeners:ee,isDragging:K,over:oe,setActivatorNodeRef:Y,transform:M}=Ra({id:a,data:S,attributes:{...Ya,...n},disabled:b.draggable}),P=ao(k,Z),U=!!O,V=U&&!A&&Tt(m)&&Tt(x),H=!E&&K,te=H&&V?M:null,W=V?te??(s??T)({rects:p,activeNodeRect:G,activeIndex:m,overIndex:x,index:N}):null,X=Tt(m)&&Tt(x)?o({id:a,items:u,activeIndex:m,overIndex:x}):N,J=O?.id,B=c.useRef({activeId:J,items:u,newIndex:X,containerId:f}),Me=u!==B.current.items,ae=t({active:O,containerId:f,isDragging:K,isSorting:U,id:a,index:N,items:u,newIndex:B.current.newIndex,previousItems:B.current.items,previousContainerId:B.current.containerId,transition:h,wasDragging:B.current.activeId!=null}),je=Va({disabled:!ae,index:N,node:v,rect:R});return c.useEffect(()=>{U&&B.current.newIndex!==X&&(B.current.newIndex=X),f!==B.current.containerId&&(B.current.containerId=f),u!==B.current.items&&(B.current.items=u)},[U,X,f,u]),c.useEffect(()=>{if(J===B.current.activeId)return;if(J!=null&&B.current.activeId==null){B.current.activeId=J;return}const He=setTimeout(()=>{B.current.activeId=J},50);return()=>clearTimeout(He)},[J]),{active:O,activeIndex:m,attributes:Q,data:S,rect:R,index:N,newIndex:X,items:u,isOver:C,isSorting:U,isDragging:K,listeners:ee,node:v,overIndex:x,over:oe,setNodeRef:P,setActivatorNodeRef:Y,setDroppableNodeRef:k,setDraggableNodeRef:Z,transform:je??W,transition:Ce()};function Ce(){if(je||Me&&B.current.newIndex===N)return qa;if(!(H&&!xn(q)||!h)&&(U||ae))return It.Transition.toString({...h,property:Pr})}}function Xa(e,t){var n,r;return typeof e=="boolean"?{draggable:e,droppable:!1}:{draggable:(n=e?.draggable)!=null?n:t.draggable,droppable:(r=e?.droppable)!=null?r:t.droppable}}$.Down,$.Right,$.Up,$.Left;const Ka=w(L)`
    width: 150px;
    height: 32px;
    background-color: ${({theme:e})=>e.colors.Background.Section.default};
    border-radius: 6px;
    padding: 3px 10px;
    flex-shrink: 0;
`;function Qa({year:e,semester:t,setYear:n,setSemester:r,setCurrentTimetableId:i}){const o=Ue(),{query:a}=ce("GET","/semesters");c.useEffect(()=>{const f=a.data?.semesters;if(f&&f.length>0){const m=f[f.length-1];m&&(n(m.year),r(m.semester))}},[a.data]);const{isFirstSemester:s,isLastSemester:l}=c.useMemo(()=>{if(!a.data)return{isFirstSemester:!1,isLastSemester:!1};const f=a.data.semesters,m=f[0],g=f[f.length-1];return!m||!g?{isFirstSemester:!0,isLastSemester:!0}:{isFirstSemester:e===m.year&&t===m.semester,isLastSemester:e===g.year&&t===g.semester}},[a.data,e,t]),h=()=>{s||(t===Ge.SPRING?(r(Ge.FALL),n(e-1)):r(Ge.SPRING),i(null))},u=()=>{l||(t===Ge.FALL?(r(Ge.SPRING),n(e+1)):r(Ge.FALL),i(null))};return y(Ka,{direction:"row",gap:0,justify:"space-between",align:"center",children:[d(nt,{onClick:s?void 0:h,styles:{padding:2.5},children:d(re,{size:20,color:s?o.colors.Text.disable:o.colors.Highlight.default,onClick:s?void 0:()=>{},children:d(Ei,{})})}),d(z,{color:"Highlight.default",children:e}),d(z,{color:"Highlight.default",children:tn(t)}),d(nt,{onClick:l?void 0:u,styles:{padding:2.5},children:d(re,{size:20,color:l?o.colors.Text.disable:o.colors.Highlight.default,onClick:l?void 0:()=>{},children:d(Si,{})})})]})}const Ur=w.div`
    display: inline-flex;
    padding: 5px 12px;
    justify-content: center;
    align-items: center;
    border-top-right-radius: 12px;
    border-top-left-radius: 12px;
    font-size: 14px;
    line-height: 17.5px;
    font-weight: 400;
`,Ja=w(Ur)`
    color: ${({theme:e})=>e.colors.Text.lighter};
    background-color: ${({theme:e})=>e.colors.Background.Tab.dark};
    cursor: pointer;

    &:hover {
        background-color: ${({theme:e})=>e.colors.Background.Tab.darker};
    }
`,Za=w(Ur)`
    color: ${({theme:e})=>e.colors.Highlight.default};
    background-color: ${({theme:e})=>e.colors.Background.Tab.default};
    cursor: pointer;
`,_a={default:Ja,selected:Za},es=w.div`
    width: 100%;
    height: 100%;
    justify-content: center;
    align-items: center;
    gap: 6px;
    display: inline-flex;
    white-space: nowrap;
`,ts=e=>d(es,{children:e}),cn=({type:e="default",children:t=void 0,buttonRef:n,...r})=>{const i=_a[e],o=()=>ts(t);return d(i,{ref:n,...r,onClick:r.onClick,children:d(o,{})})},ns=w(L)`
    width: 100%;
    max-width: 890px;

    ${j.laptop} {
        max-width: 586px;
    }

    ${j.tablet} {
        max-width: 100%;
    }
`,rs=w(L)`
    overflow-x: auto;
    scrollbar-width: none;
    min-width: 0;

    &::-webkit-scrollbar {
        display: none;
    }
`,is=w(z)`
    outline: none;
    user-select: none;
`,os=({timetable:e,isSelected:t,onClick:n,onCopy:r,onDelete:i,onNameChange:o,isDragging:a})=>{const s=Ue(),{attributes:l,listeners:h,setNodeRef:u,transform:f,transition:m}=Ga({id:e.id}),A={transform:(p=>{if(!p)return"";const{x,y:E,scaleX:T=1,scaleY:b=1}=p;return`translate3d(${x}px, ${E}px, 0) scaleX(${T}) scaleY(${b})`})(f),transition:m,touchAction:"none",opacity:a?.5:1};return d("div",{ref:u,style:A,...l,...h,children:y(cn,{type:t?"selected":"default",onClick:n,children:[d(is,{onClick:p=>{t&&(p.stopPropagation(),p.currentTarget.contentEditable="true",p.currentTarget.focus())},onBlur:p=>{const x=p.currentTarget.textContent||"";p.currentTarget.contentEditable="false",o(e.id,x)},onKeyDown:p=>{p.key==="Enter"&&(p.preventDefault(),p.currentTarget.blur())},contentEditable:!1,suppressContentEditableWarning:!0,type:"Normal",color:t?"Highlight.default":"Text.lighter",style:{paddingTop:4,paddingBottom:3.5},children:e.name?e.name:"No Title"}),y(L,{direction:"row",gap:0,align:"center",children:[t&&d(nt,{onClick:r,styles:{padding:5},children:d(re,{size:15,onClick:()=>{},color:t?s.colors.Highlight.default:s.colors.Text.lighter,children:d(vn,{})})}),d(nt,{onClick:i,styles:{padding:3.75},children:d(re,{size:17.5,onClick:()=>{},color:t?s.colors.Highlight.default:s.colors.Text.lighter,children:d(hr,{})})})]})]})})},as=({timeTableLectures:e,currentTimetableId:t,setCurrentTimetableId:n,setCurrentTimetableName:r,year:i,semester:o,setYear:a,setSemester:s})=>{const{t:l}=we(),{status:h}=mn(),u=Ue(),{query:f,setParams:m}=ce("GET","/timetables"),{requestFunction:g}=ce("POST","/timetables",{onSuccess:v=>{f.refetch(),n(v.id)}}),{requestFunction:A}=ce("DELETE","/timetables",{onMutate:v=>{t===v.id&&n(null)},onSuccess:()=>{f.refetch()}}),{requestFunction:p}=ce("PATCH","/timetables",{onSuccess:()=>{f.refetch()}}),[x,E]=c.useState([]),[T,b]=c.useState(null),N=xo(qn(Cn,{activationConstraint:{distance:8}}),qn(Ir,{activationConstraint:{delay:500,tolerance:5}}));c.useEffect(()=>{let v=f.data?.timetables??[];v=v.filter(C=>C.year===i&&C.semester===o),E(v.slice().sort((C,k)=>C.timeTableOrder-k.timeTableOrder)),t!=null&&f.data?.timetables.forEach(C=>{C.id===t&&r(C.name)})},[f.data,i,o]),c.useEffect(()=>{h==="success"&&i!==-1&&m({year:i,semester:o})},[i,o,h]),c.useEffect(()=>{r(t==null?l("timetable.myTimetable"):x.find(v=>v.id===t)?.name||"")},[t]);const S=v=>{b(v.active.id)},D=v=>{const{active:C,over:k}=v;if(b(null),k&&C.id!==k.id){const O=x.findIndex(Z=>Z.id===C.id),q=x.findIndex(Z=>Z.id===k.id),G=Dn(x,O,q);E(G);const Q=C.id;p({id:Q,order:q})}},R=v=>{if(v.deltaY===0)return;const C=v.currentTarget;C.scrollLeft=C.scrollLeft+v.deltaY};return y(ns,{direction:"row",justify:"space-between",align:"center",gap:4,children:[y(L,{direction:"row",align:"flex-start",gap:3,flex:"1 1 auto",style:{minWidth:0},children:[y(cn,{type:t==null?"selected":"default",onClick:()=>{n(null)},children:[d(z,{type:"Normal",color:t===null?"Highlight.default":"Text.lighter",style:{paddingTop:4,paddingBottom:3.5},children:l("timetable.myTimetable")}),t===null&&d(nt,{onClick:v=>{v.stopPropagation(),g({year:i,semester:o,lectureIds:e.map(C=>C.id)})},styles:{padding:5},children:d(re,{size:15,color:u.colors.Highlight.default,onClick:()=>{},children:d(vn,{})})})]},"my-timetable"),y(rs,{direction:"row",gap:3,flex:"1 1 auto",onWheel:R,children:[d(Ta,{sensors:N,collisionDetection:Do,onDragStart:S,onDragEnd:D,modifiers:[La,ka],children:d($a,{items:x.map(v=>v.id),strategy:Ua,children:x.map(v=>d(os,{timetable:v,isSelected:t===v.id,isDragging:T===v.id,onClick:()=>{n(v.id)},onCopy:C=>{C.stopPropagation(),g({year:i,semester:o,lectureIds:e.map(k=>k.id)})},onDelete:C=>{C.stopPropagation(),A({id:v.id})},onNameChange:(C,k)=>{E(O=>O.map(q=>q.id===C?{...q,name:k}:q)),p({id:C,name:k})}},v.id))})}),d(cn,{onClick:()=>{g({year:i,semester:o,lectureIds:[]})},children:d(nt,{onClick:v=>{},styles:{padding:3.75},children:d(re,{size:17.5,color:u.colors.Text.default,onClick:()=>{},children:d(pn,{})})})})]})]}),d(Qa,{year:i,semester:o,setYear:a,setSemester:s,setCurrentTimetableId:n})]})},ss=w.div`
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 4px 16px;

    ${j.tablet} {
        grid-template-columns: 1fr 1fr 1fr;
        gap: 4px 8px;
    }
`,Ke=w.div`
    display: flex;
    flex-direction: row;
    justify-content: flex-start;
    align-items: flex-start;
    padding-left: 16px;
    color: ${({theme:e})=>e.colors.Text.default};

    &:hover {
        color: ${({theme:e})=>e.colors.Highlight.default};
    }

    ${j.tablet} {
        padding-left: 0;
    }
`,Qe=w.span`
    font-size: 14px;
    font-weight: 700;
    white-space: nowrap;

    ${j.mobile} {
        font-size: 12px;
    }
`,Je=w.span`
    font-size: 14px;
    font-weight: 400;
    padding-left: 8px;
    white-space: nowrap;

    ${j.mobile} {
        font-size: 12px;
    }
`,Ze=w.span`
    font-size: 14px;
    font-weight: 400;
    padding-left: 2px;
    color: ${({theme:e})=>e.colors.Highlight.default};

    ${j.mobile} {
        display: none;
    }
`;function ls({hover:e,setHover:t,timetableLectures:n}){const{t:r}=we(),{lecturesByType:i,creditsByType:o}=c.useMemo(()=>{const l={basicRequired:0,basicElective:0,majorRequired:0,majorElective:0,humanitiesSocial:0,etc:0},h={basicRequired:[],basicElective:[],majorRequired:[],majorElective:[],humanitiesSocial:[],etc:[]};return n.forEach(u=>{u.type.includes("기초필수")?(l.basicRequired+=u.credit,h.basicRequired.push(u)):u.type.includes("기초선택")?(l.basicElective+=u.credit,h.basicElective.push(u)):u.type.includes("전공필수")?(l.majorRequired+=u.credit,h.majorRequired.push(u)):u.type.includes("전공선택")?(l.majorElective+=u.credit,h.majorElective.push(u)):u.type.includes("인문")?(l.humanitiesSocial+=u.credit,h.humanitiesSocial.push(u)):(l.etc+=u.credit,l.etc+=u.creditAU,h.etc.push(u))}),{lecturesByType:h,creditsByType:l}},[n]);function a(l){for(const h of["basicRequired","basicElective","majorRequired","majorElective","humanitiesSocial","etc"])if(l.type.includes(r(`common.type.${h}`)))return h;return"etc"}function s(l,h){if(!e||e.length==0||e?.length>1)return"";const u=e[0];return l.map(m=>m.id).includes(u.id)?`(${u.creditAU?u.creditAU:u.credit})`:h===a(u)?`(+${u.creditAU?u.creditAU:u.credit})`:""}return y(ss,{children:[y(Ke,{onMouseEnter:()=>t(i.basicRequired),onMouseLeave:()=>t(null),children:[d(Qe,{children:r("common.type.basicRequiredShort")}),d(Je,{children:o.basicRequired}),d(Ze,{children:s(i.basicRequired,"basicRequired")})]}),y(Ke,{onMouseEnter:()=>t(i.basicElective),onMouseLeave:()=>t(null),children:[d(Qe,{children:r("common.type.basicElectiveShort")}),d(Je,{children:o.basicElective}),d(Ze,{children:s(i.basicElective,"basicElective")})]}),y(Ke,{onMouseEnter:()=>t(i.majorRequired),onMouseLeave:()=>t(null),children:[d(Qe,{children:r("common.type.majorRequiredShort")}),d(Je,{children:o.majorRequired}),d(Ze,{children:s(i.majorRequired,"majorRequired")})]}),y(Ke,{onMouseEnter:()=>t(i.majorElective),onMouseLeave:()=>t(null),children:[d(Qe,{children:r("common.type.majorElectiveShort")}),d(Je,{children:o.majorElective}),d(Ze,{children:s(i.majorElective,"majorElective")})]}),y(Ke,{onMouseEnter:()=>t(i.humanitiesSocial),onMouseLeave:()=>t(null),children:[d(Qe,{children:r("common.type.humanitiesSocialElectiveShort")}),d(Je,{children:o.humanitiesSocial}),d(Ze,{children:s(i.humanitiesSocial,"humanitiesSocial")})]}),y(Ke,{onMouseEnter:()=>t(i.etc),onMouseLeave:()=>t(null),children:[d(Qe,{children:r("common.type.etcShort")}),d(Je,{children:o.etc}),d(Ze,{children:s(i.etc,"etc")})]})]})}const cs=w.div`
    display: flex;
    flex-direction: row;
    justify-content: center;
    align-items: center;
    gap: 48px;

    ${j.mobile} {
        gap: 20px;
    }
`,nr=w.div`
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 2px;
    color: ${({theme:e,highlighted:t})=>t?e.colors.Highlight.default:e.colors.Text.default};

    &:hover {
        color: ${({theme:e})=>e.colors.Highlight.default};
    }
`,rr=w.span`
    font-size: 20px;
    font-weight: 300;
`,ir=w.span`
    font-size: 10px;
    font-weight: 400;
`,ds=w.div`
    display: flex;
    flex-direction: row;
    justify-content: center;
    align-items: center;
    gap: 48px;

    ${j.mobile} {
        gap: 20px;
    }
`,Xt=w.div`
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 2px;
`,Kt=w.span`
    font-size: 20px;
    font-weight: 300;
    color: ${({theme:e})=>e.colors.Text.default};
`,Qt=w.span`
    font-size: 10px;
    font-weight: 400;
    color: ${({theme:e})=>e.colors.Text.dark};
`;function us({timetableLectures:e,hover:t,setHover:n}){const{t:r}=we(),i=c.useMemo(()=>{let o=e.reduce((u,f)=>u+f.credit,0),a=e.reduce((u,f)=>u+f.creditAU,0);if(t&&t.length==1){const u=t[0];e.some(f=>f.id===u.id)||(o+=u.credit,a+=u.creditAU)}let s=0,l=0,h=0;return e.forEach(u=>{s+=u.averageGrade,l+=u.averageLoad,h+=u.averageSpeech}),s=s/e.length,l=l/e.length,h=h/e.length,{totalCredits:o,totalAU:a,avgGrade:s,avgLoad:l,avgSpeech:h}},[e,t]);return y(Ot,{children:[y(cs,{children:[y(nr,{onMouseEnter:()=>n(e.filter(o=>o.credit>0)),onMouseLeave:()=>n(null),highlighted:t!==null&&t.some(o=>o.credit>0),children:[d(rr,{children:i.totalCredits}),d(ir,{children:r("common.credit")})]}),y(nr,{onMouseEnter:()=>n(e.filter(o=>o.creditAU>0)),onMouseLeave:()=>n(null),highlighted:t!==null&&t.some(o=>o.creditAU>0),children:[d(rr,{children:i.totalAU}),d(ir,{children:"AU"})]})]}),y(ds,{children:[y(Xt,{children:[d(Kt,{children:et(i.avgGrade/3)}),d(Qt,{children:r("common.grade")})]}),y(Xt,{children:[d(Kt,{children:et(i.avgLoad/3)}),d(Qt,{children:r("common.load")})]}),y(Xt,{children:[d(Kt,{children:et(i.avgSpeech/3)}),d(Qt,{children:r("common.speech")})]})]})]})}const hs=w(L)`
    overflow-y: auto;
    min-height: 0;
`,fs=w.div`
    display: flex;
    flex-direction: row;
    gap: 8px;
    align-items: flex-start;
`,ps=w.span`
    font-size: 14px;
    font-weight: 400;
    color: ${({color:e,theme:t})=>e||t.colors.Text.default};
    min-width: 16px;
`,gs=w(L)`
    color: ${({highlighted:e,theme:t})=>e?t.colors.Highlight.default:t.colors.Text.default};

    &:hover {
        color: ${({theme:e})=>e.colors.Highlight.default};
    }
`,ms=[{day:Se.Mon,color:"#E54C65"},{day:Se.Tue,color:"#F5A623"},{day:Se.Wed,color:"#7ED321"},{day:Se.Thu,color:"#4A90D9"},{day:Se.Fri,color:"#9B59B6"}];function vs({timetableLectures:e,hover:t,setHover:n}){const{t:r}=we(),i=c.useMemo(()=>{const o={[Se.Mon]:[],[Se.Tue]:[],[Se.Wed]:[],[Se.Thu]:[],[Se.Fri]:[]};if(e.forEach(a=>{a.examTimes.forEach(s=>{if(s==null)return;const l=s.day;o[l]&&o[l].push({lectureName:a.name,lectureId:a.id,time:s.str.split(" ").slice(1).join(" ")})})}),t&&t.length==1){const a=t[0];e.some(s=>s.id===a.id)||a.examTimes.forEach(s=>{if(s==null)return;const l=s.day;o[l]&&o[l].push({lectureName:a.name,lectureId:a.id,time:s.str})})}return o},[e,t]);return y(hs,{direction:"column",gap:15,style:{width:"100%"},flex:"1 1 0",children:[d(z,{type:"NormalBold",color:"Text.default",children:r("timetable.examTimetable")}),ms.map(({day:o,color:a})=>{const s=i[o];return!s||s.length===0?null:y(fs,{children:[d(ps,{color:a,onMouseEnter:()=>{n(e.filter(l=>l.examTimes.some(h=>h?.day===o)))},onMouseLeave:()=>n(null),children:si(o,!0)}),d(L,{direction:"column",gap:2,children:s.sort((l,h)=>l.time.localeCompare(h.time)).map((l,h)=>y(gs,{direction:"column",gap:0,highlighted:t?.some(u=>u.id===l.lectureId),onMouseEnter:()=>n(e.filter(u=>u.id===l.lectureId)),onMouseLeave:()=>n(null),children:[d(z,{type:"NormalBold",children:l.lectureName}),d(z,{type:"Normal",children:l.time})]},h))})]},o)})]})}const ys=e=>[e?.red?.[1],e?.red?.[2],e?.orange?.[1],e?.orange?.[2],e?.yellow?.[1],e?.yellow?.[2],e?.green?.[1],e?.green?.[2],e?.green?.[3],e?.blue?.[1],e?.blue?.[2],e?.purple?.[1],e?.purple?.[2],e?.pink?.[1],e?.pink?.[2]].map(t=>t??"#CCCCCC"),bs=w.div`
    width: 100%;
    height: 220px;
    border-radius: 8px;
    display: flex;
    align-items: center;
    justify-content: center;
    position: relative;
    overflow: hidden;

    &::before {
        content: "";
        position: absolute;
        width: 100%;
        height: 100%;
        background-image: url("/campus_map.png");
        background-size: cover;
        background-position: center;
        opacity: 0.8;
    }
`,ws=w.div`
    display: flex;
    gap: 4px;
    align-items: center;
    background-color: ${({theme:e})=>e.colors.Background.Section.default};
    left: ${({left:e})=>e}%;
    top: ${({top:e})=>e}%;
    position: absolute;
    font-size: 10px;
    color: ${({theme:e})=>e.colors.Text.default};
    border-radius: 4px;
    padding: 2px 4px;
`,xs=w.div`
    width: 0;
    height: 0;
    border-left: 3px solid transparent;
    border-right: 3px solid transparent;
    border-top: 6px solid ${({theme:e})=>e.colors.Background.Section.default};
    position: absolute;
    top: 17px;
`,Es=w.div`
    background-color: ${({theme:e,courseId:t,highlighted:n})=>n?e.colors.Highlight.default:(()=>{const r=ys(e.colors?.Tile?.TimeTable?.default);return r[t%r.length]})()};
    width: 10px;
    height: 10px;
    border-radius: 100%;
`,Ss=new Map([["E2",{left:52,top:70}],["E3",{left:59,top:64}],["E6",{left:60,top:52}],["E7",{left:69,top:50}],["E11",{left:45,top:47}],["E16",{left:45,top:38}],["N1",{left:80,top:28}],["N3",{left:45,top:34}],["N4",{left:54,top:30}],["N5",{left:66,top:28}],["N7",{left:25,top:30}],["N22",{left:71,top:24}],["N24",{left:68,top:20}],["N25",{left:51,top:25}],["N27",{left:49,top:13}],["W1",{left:26,top:73}],["W8",{left:27,top:44}],["W16",{left:35,top:76}]]);function Ts({timetableLectures:e,hover:t,setHover:n}){return d(bs,{children:Array.from(Ss).map(([r,{left:i,top:o}])=>{const a=e.filter(s=>s.classes.some(l=>l.buildingCode.includes(r)));return a.length===0?null:y(ws,{left:i,top:o,onMouseEnter:()=>{n(a)},onMouseLeave:()=>{n(null)},children:[d(xs,{}),r,a.map(s=>d(Es,{courseId:s.courseId,highlighted:t?.includes(s)??!1},s.id))]},r)})})}var dt={},or;function Cs(){return or||(or=1,dt.createCanvas=function(e,t){return Object.assign(document.createElement("canvas"),{width:e,height:t})},dt.createImageData=function(e,t,n){switch(arguments.length){case 0:return new ImageData;case 1:return new ImageData(e);case 2:return new ImageData(e,t);default:return new ImageData(e,t,n)}},dt.loadImage=function(e,t){return new Promise(function(n,r){const i=Object.assign(document.createElement("img"),t);function o(){i.onload=null,i.onerror=null}i.onload=function(){o(),n(i)},i.onerror=function(){o(),r(new Error('Failed to load the image "'+e+'"'))},i.src=e})}),dt}var ar=Cs(),Rn=(e=>(e.DAILY="DAILY",e.HOURLY="HOURLY",e.MINUTELY="MINUTELY",e.MONTHLY="MONTHLY",e.SECONDLY="SECONDLY",e.WEEKLY="WEEKLY",e.YEARLY="YEARLY",e))(Rn||{}),dn=(e=>(e.FR="FR",e.MO="MO",e.SA="SA",e.SU="SU",e.TH="TH",e.TU="TU",e.WE="WE",e))(dn||{});function ve(e,t,n){if(Array.isArray(t))e.x=t.map(r=>{if(Array.isArray(r))return r;if(typeof r.key!="string"||typeof r.value!="string")throw new Error("Either key or value is not a string!");if(r.key.substr(0,2)!=="X-")throw new Error("Key has to start with `X-`!");return[r.key,r.value]});else if(typeof t=="object")e.x=Object.entries(t).map(([r,i])=>{if(typeof r!="string"||typeof i!="string")throw new Error("Either key or value is not a string!");if(r.substr(0,2)!=="X-")throw new Error("Key has to start with `X-`!");return[r,i]});else if(typeof t=="string"&&typeof n=="string"){if(t.substr(0,2)!=="X-")throw new Error("Key has to start with `X-`!");e.x.push([t,n])}else return e.x.map(r=>({key:r[0],value:r[1]}))}function Re(e,t){if(e instanceof Date&&isNaN(e.getTime())||typeof e=="string"&&isNaN(new Date(e).getTime()))throw new Error(`\`${t}\` has to be a valid date!`);if(e instanceof Date||typeof e=="string"||Pt(e)&&e.isValid===!0||(Ut(e)||Rs(e))&&e.isValid())return e;throw new Error(`\`${t}\` has to be a valid date!`)}function me(e,t){let n=Object.values(e),r=String(t).toUpperCase();if(!r||!n.includes(r))throw new Error(`Input must be one of the following: ${n.join(", ")}`);return r}function yt(e,t){let n=null;if(typeof t=="string"){let r=t.match(/^(.+) ?<([^>]+)>$/);r?n={email:r[2].trim(),name:r[1].trim()}:t.includes("@")&&(n={email:t.trim(),name:t.trim()})}else typeof t=="object"&&(n={email:t.email,mailto:t.mailto,name:t.name,sentBy:t.sentBy});if(!n&&typeof t=="string")throw new Error("`"+e+"` isn't formated correctly. See https://sebbo2002.github.io/ical-generator/develop/reference/interfaces/ICalOrganizer.html");if(!n)throw new Error("`"+e+"` needs to be a valid formed string or an object. See https://sebbo2002.github.io/ical-generator/develop/reference/interfaces/ICalOrganizer.html");if(!n.name)throw new Error("`"+e+".name` is empty!");if(!n.email)throw new Error("`"+e+".email` is empty!");return n}function F(e,t){return String(e).replace(t?/[\\"]/g:/[\\;,]/g,function(n){return"\\"+n}).replace(/(?:\r\n|\r|\n)/g,"\\n")}function Ds(e){return e.split(`\r
`).map(function(t){let n="",r=0;for(let i=0;i<t.length;i++){let o=t.charAt(i);o>="\uD800"&&o<="\uDBFF"&&(o+=t.charAt(++i));let a=new TextEncoder().encode(o).length;r+=a,r>74&&(n+=`\r
 `,r=a),n+=o}return n}).join(`\r
`)}function ye(e,t,n,r){if(e?.startsWith("/")&&(e=e.substr(1)),typeof t=="string"||t instanceof Date){let i=Is(t)?t.withTimeZone(e):new Date(t),o=i.getUTCFullYear()+String(i.getUTCMonth()+1).padStart(2,"0")+i.getUTCDate().toString().padStart(2,"0");return e&&(o=i.getFullYear()+String(i.getMonth()+1).padStart(2,"0")+i.getDate().toString().padStart(2,"0")),n?o:e?(o+="T"+i.getHours().toString().padStart(2,"0")+i.getMinutes().toString().padStart(2,"0")+i.getSeconds().toString().padStart(2,"0"),o):(o+="T"+i.getUTCHours().toString().padStart(2,"0")+i.getUTCMinutes().toString().padStart(2,"0")+i.getUTCSeconds().toString().padStart(2,"0")+(r?"":"Z"),o)}else if(Ut(t)){let i=e?sr(t)&&!t.tz()?t.clone().tz(e):t:r||n&&sr(t)&&t.tz()?t:t.utc();return i.format("YYYYMMDD")+(n?"":"T"+i.format("HHmmss")+(r||e?"":"Z"))}else if(Pt(t)){let i=e?t.setZone(e):r||n&&t.zone.type!=="system"?t:t.setZone("utc");return i.toFormat("yyyyLLdd")+(n?"":"T"+i.toFormat("HHmmss")+(r||e?"":"Z"))}else{let i=t;if(e)i=typeof t.tz=="function"?t.tz(e):t;else if(!r)if(typeof t.utc=="function")i=t.utc();else throw new Error("Unable to convert dayjs object to UTC value: UTC plugin is not available!");return i.format("YYYYMMDD")+(n?"":"T"+i.format("HHmmss")+(r||e?"":"Z"))}}function Jt(e,t,n,r){let i="",o=r?.floating||!1;return r?.timezone&&(i=";TZID="+r.timezone,o=!0),t+i+":"+ye(e,n,!1,o)}function An(e){let t=e.x.map(([n,r])=>n.toUpperCase()+":"+F(r,!1)).join(`\r
`);return t.length?t+`\r
`:""}function Rs(e){return typeof e=="object"&&e!==null&&!(e instanceof Date)&&!Ut(e)&&!Pt(e)}function Pt(e){return typeof e=="object"&&e!==null&&"toJSDate"in e&&typeof e.toJSDate=="function"}function Ut(e){return e!=null&&e._isAMomentObject!=null}function As(e){return e!==null&&typeof e=="object"&&"asSeconds"in e&&typeof e.asSeconds=="function"}function sr(e){return Ut(e)&&"tz"in e&&typeof e.tz=="function"}function Zt(e){return e!==null&&typeof e=="object"&&"between"in e&&typeof e.between=="function"&&typeof e.toString=="function"}function Is(e){return e instanceof Date&&"internal"in e&&e.internal instanceof Date&&"withTimeZone"in e&&typeof e.withTimeZone=="function"&&"tzComponents"in e&&typeof e.tzComponents=="function"}function lr(e){return typeof e=="string"||e instanceof Date?new Date(e):Pt(e)?e.toJSDate():e.toDate()}function _e(e){let t="";return e<0&&(t="-",e*=-1),t+="P",e>=86400&&(t+=Math.floor(e/86400)+"D",e%=86400),!e&&t.length>1||(t+="T",e>=3600&&(t+=Math.floor(e/3600)+"H",e%=3600),e>=60&&(t+=Math.floor(e/60)+"M",e%=60),e>0?t+=e+"S":t.length<=2&&(t+="0S")),t}function Ae(e){return e?typeof e=="string"?e:e.toJSON():null}var Fr=(e=>(e.CHAIR="CHAIR",e.NON="NON-PARTICIPANT",e.OPT="OPT-PARTICIPANT",e.REQ="REQ-PARTICIPANT",e))(Fr||{}),$r=(e=>(e.CLIENT="CLIENT",e.NONE="NONE",e.SERVER="SERVER",e))($r||{}),jr=(e=>(e.ACCEPTED="ACCEPTED",e.DECLINED="DECLINED",e.DELEGATED="DELEGATED",e.NEEDSACTION="NEEDS-ACTION",e.TENTATIVE="TENTATIVE",e))(jr||{}),Hr=(e=>(e.GROUP="GROUP",e.INDIVIDUAL="INDIVIDUAL",e.RESOURCE="RESOURCE",e.ROOM="ROOM",e.UNKNOWN="UNKNOWN",e))(Hr||{}),Lt=class Ie{data;parent;constructor(t,n){if(this.data={delegatedFrom:null,delegatedTo:null,email:"",mailto:null,name:null,role:"REQ-PARTICIPANT",rsvp:null,scheduleAgent:null,sentBy:null,status:null,type:null,x:[]},this.parent=n,!this.parent)throw new Error("`event` option required!");if(!t.email)throw new Error("No value for `email` in ICalAttendee given!");t.name!==void 0&&this.name(t.name),t.email!==void 0&&this.email(t.email),t.mailto!==void 0&&this.mailto(t.mailto),t.sentBy!==void 0&&this.sentBy(t.sentBy),t.status!==void 0&&this.status(t.status),t.role!==void 0&&this.role(t.role),t.rsvp!==void 0&&this.rsvp(t.rsvp),t.type!==void 0&&this.type(t.type),t.delegatedTo!==void 0&&this.delegatedTo(t.delegatedTo),t.delegatedFrom!==void 0&&this.delegatedFrom(t.delegatedFrom),t.delegatesTo&&this.delegatesTo(t.delegatesTo),t.delegatesFrom&&this.delegatesFrom(t.delegatesFrom),t.scheduleAgent!==void 0&&this.scheduleAgent(t.scheduleAgent),t.x!==void 0&&this.x(t.x)}delegatedFrom(t){return t===void 0?this.data.delegatedFrom:(t?typeof t=="string"?this.data.delegatedFrom=new Ie(yt("delegatedFrom",t),this.parent):t instanceof Ie?this.data.delegatedFrom=t:this.data.delegatedFrom=new Ie(t,this.parent):this.data.delegatedFrom=null,this)}delegatedTo(t){return t===void 0?this.data.delegatedTo:t?(typeof t=="string"?this.data.delegatedTo=new Ie(yt("delegatedTo",t),this.parent):t instanceof Ie?this.data.delegatedTo=t:this.data.delegatedTo=new Ie(t,this.parent),this.data.status="DELEGATED",this):(this.data.delegatedTo=null,this.data.status==="DELEGATED"&&(this.data.status=null),this)}delegatesFrom(t){let n=t instanceof Ie?t:this.parent.createAttendee(t);return this.delegatedFrom(n),n.delegatedTo(this),n}delegatesTo(t){let n=t instanceof Ie?t:this.parent.createAttendee(t);return this.delegatedTo(n),n.delegatedFrom(this),n}email(t){return t?(this.data.email=t,this):this.data.email}mailto(t){return t===void 0?this.data.mailto:(this.data.mailto=t||null,this)}name(t){return t===void 0?this.data.name:(this.data.name=t||null,this)}role(t){return t===void 0?this.data.role:(this.data.role=me(Fr,t),this)}rsvp(t){return t===void 0?this.data.rsvp:t===null?(this.data.rsvp=null,this):(this.data.rsvp=!!t,this)}scheduleAgent(t){return t===void 0?this.data.scheduleAgent:t?typeof t=="string"&&t.toUpperCase().startsWith("X-")?(this.data.scheduleAgent=t,this):(this.data.scheduleAgent=me($r,t),this):(this.data.scheduleAgent=null,this)}sentBy(t){return t?(this.data.sentBy=t,this):this.data.sentBy}status(t){return t===void 0?this.data.status:t?(this.data.status=me(jr,t),this):(this.data.status=null,this)}toJSON(){return Object.assign({},this.data,{delegatedFrom:this.data.delegatedFrom?.email()||null,delegatedTo:this.data.delegatedTo?.email()||null,x:this.x()})}toString(){let t="ATTENDEE";if(!this.data.email)throw new Error("No value for `email` in ICalAttendee given!");return t+=";ROLE="+this.data.role,this.data.type&&(t+=";CUTYPE="+this.data.type),this.data.status&&(t+=";PARTSTAT="+this.data.status),this.data.rsvp!==null&&(t+=";RSVP="+this.data.rsvp.toString().toUpperCase()),this.data.sentBy!==null&&(t+=';SENT-BY="mailto:'+this.data.sentBy+'"'),this.data.delegatedTo&&(t+=';DELEGATED-TO="'+this.data.delegatedTo.email()+'"'),this.data.delegatedFrom&&(t+=';DELEGATED-FROM="'+this.data.delegatedFrom.email()+'"'),this.data.name&&(t+=';CN="'+F(this.data.name,!0)+'"'),this.data.email&&this.data.mailto&&(t+=";EMAIL="+F(this.data.email,!1)),this.data.scheduleAgent&&(t+=";SCHEDULE-AGENT="+this.data.scheduleAgent),this.data.x.length&&(t+=";"+this.data.x.map(([n,r])=>n.toUpperCase()+"="+F(r,!1)).join(";")),t+=":MAILTO:"+F(this.data.mailto||this.data.email,!1)+`\r
`,t}type(t){return t===void 0?this.data.type:t?(this.data.type=me(Hr,t),this):(this.data.type=null,this)}x(t,n){if(t===void 0)return ve(this.data);if(typeof t=="string"&&typeof n=="string")ve(this.data,t,n);else if(typeof t=="object")ve(this.data,t);else throw new Error("Either key or value is not a string!");return this}},In=(e=>(e.audio="audio",e.display="display",e.email="email",e))(In||{}),Ns={end:"END",start:"START"},cr=class{data;event;constructor(e,t){if(this.data={attach:null,attendees:[],description:null,interval:null,relatesTo:null,repeat:null,summary:null,trigger:-600,type:"display",x:[]},this.event=t,!t)throw new Error("`event` option required!");e.type!==void 0&&this.type(e.type),"trigger"in e&&e.trigger!==void 0&&this.trigger(e.trigger),"triggerBefore"in e&&e.triggerBefore!==void 0&&this.triggerBefore(e.triggerBefore),"triggerAfter"in e&&e.triggerAfter!==void 0&&this.triggerAfter(e.triggerAfter),e.repeat&&this.repeat(e.repeat),e.attach!==void 0&&this.attach(e.attach),e.description!==void 0&&this.description(e.description),e.summary!==void 0&&this.summary(e.summary),e.attendees!==void 0&&this.attendees(e.attendees),e.x!==void 0&&this.x(e.x)}attach(e){if(e===void 0)return this.data.attach;if(!e)return this.data.attach=null,this;let t=null;if(typeof e=="string")t={mime:null,uri:e};else if(typeof e=="object")t={mime:e.mime||null,uri:e.uri};else throw new Error("`attachment` needs to be a valid formed string or an object. See https://sebbo2002.github.io/ical-generator/develop/reference/classes/ICalAlarm.html#attach");if(!t.uri)throw new Error("`attach.uri` is empty!");return this.data.attach={mime:t.mime,uri:t.uri},this}attendees(e){return e?(e.forEach(t=>this.createAttendee(t)),this):this.data.attendees}createAttendee(e){if(e instanceof Lt)return this.data.attendees.push(e),e;typeof e=="string"&&(e=yt("data",e));let t=new Lt(e,this);return this.data.attendees.push(t),t}description(e){return e===void 0?this.data.description:e?(this.data.description=e,this):(this.data.description=null,this)}relatesTo(e){if(e===void 0)return this.data.relatesTo;if(!e)return this.data.relatesTo=null,this;if(!Object.values(Ns).includes(e))throw new Error("`relatesTo` is not correct, must be either `START` or `END`!");return this.data.relatesTo=e,this}repeat(e){if(e===void 0)return this.data.repeat;if(!e)return this.data.repeat=null,this;if(typeof e!="object")throw new Error("`repeat` is not correct, must be an object!");if(typeof e.times!="number"||!isFinite(e.times))throw new Error("`repeat.times` is not correct, must be numeric!");if(typeof e.interval!="number"||!isFinite(e.interval))throw new Error("`repeat.interval` is not correct, must be numeric!");return this.data.repeat=e,this}summary(e){return e===void 0?this.data.summary:e?(this.data.summary=e,this):(this.data.summary=null,this)}toJSON(){let e=this.trigger();return Object.assign({},this.data,{trigger:typeof e=="number"?e:Ae(e),x:this.x()})}toString(){let e=`BEGIN:VALARM\r
`;if(e+="ACTION:"+this.data.type.toUpperCase()+`\r
`,typeof this.data.trigger=="number"&&this.data.relatesTo===null?this.data.trigger>0?e+="TRIGGER;RELATED=END:"+_e(this.data.trigger)+`\r
`:e+="TRIGGER:"+_e(this.data.trigger)+`\r
`:typeof this.data.trigger=="number"?e+="TRIGGER;RELATED="+this.data.relatesTo?.toUpperCase()+":"+_e(this.data.trigger)+`\r
`:e+="TRIGGER;VALUE=DATE-TIME:"+ye(this.event.timezone(),this.data.trigger)+`\r
`,this.data.repeat){if(!this.data.repeat.times)throw new Error("No value for `repeat.times` in ICalAlarm given, but required for `interval`!");if(!this.data.repeat.interval)throw new Error("No value for `repeat.interval` in ICalAlarm given, but required for `repeat`!");e+="REPEAT:"+this.data.repeat.times+`\r
`,e+="DURATION:"+_e(this.data.repeat.interval)+`\r
`}return this.data.type==="audio"&&this.data.attach&&this.data.attach.mime?e+="ATTACH;FMTTYPE="+F(this.data.attach.mime,!1)+":"+F(this.data.attach.uri,!1)+`\r
`:this.data.type==="audio"&&this.data.attach?e+="ATTACH;VALUE=URI:"+F(this.data.attach.uri,!1)+`\r
`:this.data.type==="audio"&&(e+=`ATTACH;VALUE=URI:Basso\r
`),this.data.type!=="audio"&&this.data.description?e+="DESCRIPTION:"+F(this.data.description,!1)+`\r
`:this.data.type!=="audio"&&(e+="DESCRIPTION:"+F(this.event.summary(),!1)+`\r
`),this.data.type==="email"&&this.data.summary?e+="SUMMARY:"+F(this.data.summary,!1)+`\r
`:this.data.type==="email"&&(e+="SUMMARY:"+F(this.event.summary(),!1)+`\r
`),this.data.type==="email"&&this.data.attendees.forEach(t=>{e+=t.toString()}),e+=An(this.data),e+=`END:VALARM\r
`,e}trigger(e){if(e===void 0&&typeof this.data.trigger=="number")return-1*this.data.trigger;if(e===void 0)return this.data.trigger;if(typeof e=="number"&&isFinite(e))this.data.trigger=-1*e;else{if(!e||typeof e=="number")throw new Error("`trigger` is not correct, must be a finite number or a supported date!");this.data.trigger=Re(e,"trigger")}return this}triggerAfter(e){return e===void 0?this.data.trigger:this.trigger(typeof e=="number"?-1*e:e)}triggerBefore(e){return e===void 0?this.trigger():this.trigger(e)}type(e){if(e===void 0)return this.data.type;if(!e||!Object.keys(In).includes(e))throw new Error("`type` is not correct, must be either `display` or `audio`!");return this.data.type=e,this}x(e,t){if(e===void 0)return ve(this.data);if(typeof e=="string"&&typeof t=="string")ve(this.data,e,t);else if(typeof e=="object")ve(this.data,e);else throw new Error("Either key or value is not a string!");return this}},dr=class{data;constructor(e){if(this.data={name:""},!e.name)throw new Error("No value for `name` in ICalCategory given!");this.name(e.name)}name(e){return e===void 0?this.data.name:(this.data.name=e,this)}toJSON(){return Object.assign({},this.data)}toString(){return F(this.data.name,!1)}},Wr=(e=>(e.BUSY="BUSY",e.FREE="FREE",e.OOF="OOF",e.TENTATIVE="TENTATIVE",e))(Wr||{}),qr=(e=>(e.CONFIDENTIAL="CONFIDENTIAL",e.PRIVATE="PRIVATE",e.PUBLIC="PUBLIC",e))(qr||{}),Yr=(e=>(e.CANCELLED="CANCELLED",e.CONFIRMED="CONFIRMED",e.TENTATIVE="TENTATIVE",e))(Yr||{}),Vr=(e=>(e.OPAQUE="OPAQUE",e.TRANSPARENT="TRANSPARENT",e))(Vr||{}),ur=class{calendar;data;constructor(e,t){if(this.data={alarms:[],allDay:!1,attachments:[],attendees:[],busystatus:null,categories:[],class:null,created:null,description:null,end:null,floating:!1,id:crypto.randomUUID(),lastModified:null,location:null,organizer:null,priority:null,recurrenceId:null,repeating:null,sequence:0,stamp:new Date,start:new Date,status:null,summary:"",timezone:null,transparency:null,url:null,x:[]},this.calendar=t,!t)throw new Error("`calendar` option required!");e.id&&this.id(e.id),e.sequence!==void 0&&this.sequence(e.sequence),e.start&&this.start(e.start),e.end!==void 0&&this.end(e.end),e.recurrenceId!==void 0&&this.recurrenceId(e.recurrenceId),e.timezone!==void 0&&this.timezone(e.timezone),e.stamp!==void 0&&this.stamp(e.stamp),e.allDay!==void 0&&this.allDay(e.allDay),e.floating!==void 0&&this.floating(e.floating),e.repeating!==void 0&&this.repeating(e.repeating),e.summary!==void 0&&this.summary(e.summary),e.location!==void 0&&this.location(e.location),e.description!==void 0&&this.description(e.description),e.organizer!==void 0&&this.organizer(e.organizer),e.attendees!==void 0&&this.attendees(e.attendees),e.alarms!==void 0&&this.alarms(e.alarms),e.categories!==void 0&&this.categories(e.categories),e.status!==void 0&&this.status(e.status),e.busystatus!==void 0&&this.busystatus(e.busystatus),e.priority!==void 0&&this.priority(e.priority),e.url!==void 0&&this.url(e.url),e.attachments!==void 0&&this.attachments(e.attachments),e.transparency!==void 0&&this.transparency(e.transparency),e.created!==void 0&&this.created(e.created),e.lastModified!==void 0&&this.lastModified(e.lastModified),e.class!==void 0&&this.class(e.class),e.x!==void 0&&this.x(e.x)}alarms(e){return e?(e.forEach(t=>this.createAlarm(t)),this):this.data.alarms}allDay(e){return e===void 0?this.data.allDay:(this.data.allDay=!!e,this)}attachments(e){return e?(e.forEach(t=>this.createAttachment(t)),this):this.data.attachments}attendees(e){return e?(e.forEach(t=>this.createAttendee(t)),this):this.data.attendees}busystatus(e){return e===void 0?this.data.busystatus:e===null?(this.data.busystatus=null,this):(this.data.busystatus=me(Wr,e),this)}categories(e){return e?(e.forEach(t=>this.createCategory(t)),this):this.data.categories}class(e){return e===void 0?this.data.class:e===null?(this.data.class=null,this):(this.data.class=me(qr,e),this)}createAlarm(e){let t=e instanceof cr?e:new cr(e,this);return this.data.alarms.push(t),t}createAttachment(e){return this.data.attachments.push(e),this}createAttendee(e){if(e instanceof Lt)return this.data.attendees.push(e),e;typeof e=="string"&&(e=yt("data",e));let t=new Lt(e,this);return this.data.attendees.push(t),t}createCategory(e){let t=e instanceof dr?e:new dr(e);return this.data.categories.push(t),t}created(e){return e===void 0?this.data.created:e===null?(this.data.created=null,this):(this.data.created=Re(e,"created"),this)}description(e){return e===void 0?this.data.description:e===null?(this.data.description=null,this):(typeof e=="string"?this.data.description={plain:e}:this.data.description=e,this)}end(e){return e===void 0?(this.swapStartAndEndIfRequired(),this.data.end):e===null?(this.data.end=null,this):(this.data.end=Re(e,"end"),this)}floating(e){return e===void 0?this.data.floating:(this.data.floating=!!e,this.data.floating&&(this.data.timezone=null),this)}id(e){return e===void 0?this.data.id:(this.data.id=String(e),this)}lastModified(e){return e===void 0?this.data.lastModified:e===null?(this.data.lastModified=null,this):(this.data.lastModified=Re(e,"lastModified"),this)}location(e){if(e===void 0)return this.data.location;if(typeof e=="string")return this.data.location={title:e},this;if(e&&("title"in e&&!e.title||e?.geo&&(typeof e.geo.lat!="number"||!isFinite(e.geo.lat)||typeof e.geo.lon!="number"||!isFinite(e.geo.lon))||!("title"in e)&&!e?.geo))throw new Error("`location` isn't formatted correctly. See https://sebbo2002.github.io/ical-generator/develop/reference/classes/ICalEvent.html#location");return this.data.location=e||null,this}organizer(e){return e===void 0?this.data.organizer:e===null?(this.data.organizer=null,this):(this.data.organizer=yt("organizer",e),this)}priority(e){if(e===void 0)return this.data.priority;if(e===null)return this.data.priority=null,this;if(e<0||e>9)throw new Error("`priority` is invalid, musst be 0 ≤ priority ≤ 9.");return this.data.priority=Math.round(e),this}recurrenceId(e){return e===void 0?this.data.recurrenceId:e===null?(this.data.recurrenceId=null,this):(this.data.recurrenceId=Re(e,"recurrenceId"),this)}repeating(e){if(e===void 0)return this.data.repeating;if(!e)return this.data.repeating=null,this;if(Zt(e)||typeof e=="string")return this.data.repeating=e,this;if(this.data.repeating={freq:me(Rn,e.freq)},e.count){if(!isFinite(e.count))throw new Error("`repeating.count` must be a finite number!");this.data.repeating.count=e.count}if(e.interval){if(!isFinite(e.interval))throw new Error("`repeating.interval` must be a finite number!");this.data.repeating.interval=e.interval}if(e.until!==void 0&&(this.data.repeating.until=Re(e.until,"repeating.until")),e.byDay){let t=Array.isArray(e.byDay)?e.byDay:[e.byDay];this.data.repeating.byDay=t.map(n=>me(dn,n))}if(e.byMonth){let t=Array.isArray(e.byMonth)?e.byMonth:[e.byMonth];this.data.repeating.byMonth=t.map(n=>{if(typeof n!="number"||n<1||n>12)throw new Error("`repeating.byMonth` contains invalid value `"+n+"`!");return n})}if(e.byMonthDay){let t=Array.isArray(e.byMonthDay)?e.byMonthDay:[e.byMonthDay];this.data.repeating.byMonthDay=t.map(n=>{if(typeof n!="number"||n<-31||n>31||n===0)throw new Error("`repeating.byMonthDay` contains invalid value `"+n+"`!");return n})}if(e.bySetPos){if(!this.data.repeating.byDay)throw"`repeating.bySetPos` must be used along with `repeating.byDay`!";let t=Array.isArray(e.bySetPos)?e.bySetPos:[e.bySetPos];this.data.repeating.bySetPos=t.map(n=>{if(typeof n!="number"||n<-366||n>366||n===0)throw"`repeating.bySetPos` contains invalid value `"+n+"`!";return n})}if(e.exclude){let t=Array.isArray(e.exclude)?e.exclude:[e.exclude];this.data.repeating.exclude=t.map((n,r)=>Re(n,`repeating.exclude[${r}]`))}return e.startOfWeek&&(this.data.repeating.startOfWeek=me(dn,e.startOfWeek)),this}sequence(e){if(e===void 0)return this.data.sequence;let t=parseInt(String(e),10);if(isNaN(t))throw new Error("`sequence` must be a number!");return this.data.sequence=e,this}stamp(e){return e===void 0?this.data.stamp:(this.data.stamp=Re(e,"stamp"),this)}start(e){return e===void 0?(this.swapStartAndEndIfRequired(),this.data.start):(this.data.start=Re(e,"start"),this)}status(e){return e===void 0?this.data.status:e===null?(this.data.status=null,this):(this.data.status=me(Yr,e),this)}summary(e){return e===void 0?this.data.summary:(this.data.summary=e?String(e):"",this)}timestamp(e){return e===void 0?this.stamp():this.stamp(e)}timezone(e){return e===void 0&&this.data.timezone!==null?this.data.timezone:e===void 0?this.calendar.timezone():(this.data.timezone=e&&e!=="UTC"?e.toString():null,this.data.timezone&&(this.data.floating=!1),this)}toJSON(){let e=null;return Zt(this.data.repeating)||typeof this.data.repeating=="string"?e=this.data.repeating.toString():this.data.repeating&&(e=Object.assign({},this.data.repeating,{exclude:this.data.repeating.exclude?.map(t=>Ae(t)),until:Ae(this.data.repeating.until)||void 0})),this.swapStartAndEndIfRequired(),Object.assign({},this.data,{created:Ae(this.data.created)||null,end:Ae(this.data.end)||null,lastModified:Ae(this.data.lastModified)||null,recurrenceId:Ae(this.data.recurrenceId)||null,repeating:e,stamp:Ae(this.data.stamp)||null,start:Ae(this.data.start)||null,x:this.x()})}toString(){let e="";if(e+=`BEGIN:VEVENT\r
`,e+="UID:"+this.data.id+`\r
`,e+="SEQUENCE:"+this.data.sequence+`\r
`,this.swapStartAndEndIfRequired(),e+="DTSTAMP:"+ye(this.calendar.timezone(),this.data.stamp)+`\r
`,this.data.allDay?(e+="DTSTART;VALUE=DATE:"+ye(this.timezone(),this.data.start,!0)+`\r
`,this.data.end&&(e+="DTEND;VALUE=DATE:"+ye(this.timezone(),this.data.end,!0)+`\r
`),e+=`X-MICROSOFT-CDO-ALLDAYEVENT:TRUE\r
`,e+=`X-MICROSOFT-MSNCALENDAR-ALLDAYEVENT:TRUE\r
`):(e+=Jt(this.timezone(),"DTSTART",this.data.start,this.data)+`\r
`,this.data.end&&(e+=Jt(this.timezone(),"DTEND",this.data.end,this.data)+`\r
`)),Zt(this.data.repeating)||typeof this.data.repeating=="string"){let t=this.data.repeating.toString().replace(/\r\n/g,`
`).split(`
`).filter(n=>n&&!n.startsWith("DTSTART:")).join(`\r
`);!t.includes(`\r
`)&&!t.startsWith("RRULE:")&&(t="RRULE:"+t),e+=t.trim()+`\r
`}else this.data.repeating&&(e+="RRULE:FREQ="+this.data.repeating.freq,this.data.repeating.count&&(e+=";COUNT="+this.data.repeating.count),this.data.repeating.interval&&(e+=";INTERVAL="+this.data.repeating.interval),this.data.repeating.until&&(e+=";UNTIL="+ye(this.calendar.timezone(),this.data.repeating.until,!1,this.floating())),this.data.repeating.byDay&&(e+=";BYDAY="+this.data.repeating.byDay.join(",")),this.data.repeating.byMonth&&(e+=";BYMONTH="+this.data.repeating.byMonth.join(",")),this.data.repeating.byMonthDay&&(e+=";BYMONTHDAY="+this.data.repeating.byMonthDay.join(",")),this.data.repeating.bySetPos&&(e+=";BYSETPOS="+this.data.repeating.bySetPos.join(",")),this.data.repeating.startOfWeek&&(e+=";WKST="+this.data.repeating.startOfWeek),e+=`\r
`,this.data.repeating.exclude&&(this.data.allDay?e+="EXDATE;VALUE=DATE:"+this.data.repeating.exclude.map(t=>ye(this.calendar.timezone(),t,!0)).join(",")+`\r
`:(e+="EXDATE",this.timezone()?e+=";TZID="+this.timezone()+":"+this.data.repeating.exclude.map(t=>ye(this.timezone(),t,!1,!0)).join(",")+`\r
`:e+=":"+this.data.repeating.exclude.map(t=>ye(this.timezone(),t,!1,this.floating())).join(",")+`\r
`)));return this.data.recurrenceId&&(e+=Jt(this.timezone(),"RECURRENCE-ID",this.data.recurrenceId,this.data)+`\r
`),e+="SUMMARY:"+F(this.data.summary,!1)+`\r
`,this.data.transparency&&(e+="TRANSP:"+F(this.data.transparency,!1)+`\r
`),this.data.location&&"title"in this.data.location&&this.data.location.title&&(e+="LOCATION:"+F(this.data.location.title+(this.data.location.address?`
`+this.data.location.address:""),!1)+`\r
`,this.data.location.radius&&this.data.location.geo&&(e+="X-APPLE-STRUCTURED-LOCATION;VALUE=URI;"+(this.data.location.address?"X-ADDRESS="+F(this.data.location.address,!1)+";":"")+"X-APPLE-RADIUS="+F(this.data.location.radius,!1)+";X-TITLE="+F(this.data.location.title,!1)+":geo:"+F(this.data.location.geo?.lat,!1)+","+F(this.data.location.geo?.lon,!1)+`\r
`)),this.data.location?.geo?.lat&&this.data.location.geo.lon&&(e+="GEO:"+F(this.data.location.geo.lat,!1)+";"+F(this.data.location.geo.lon,!1)+`\r
`),this.data.description&&(e+="DESCRIPTION:"+F(this.data.description.plain,!1)+`\r
`,this.data.description.html&&(e+="X-ALT-DESC;FMTTYPE=text/html:"+F(this.data.description.html,!1)+`\r
`)),this.data.organizer&&(e+='ORGANIZER;CN="'+F(this.data.organizer.name,!0)+'"',this.data.organizer.sentBy&&(e+=';SENT-BY="mailto:'+F(this.data.organizer.sentBy,!0)+'"'),this.data.organizer.email&&this.data.organizer.mailto&&(e+=";EMAIL="+F(this.data.organizer.email,!1)),e+=":",this.data.organizer.email&&(e+="mailto:"+F(this.data.organizer.mailto||this.data.organizer.email,!1)),e+=`\r
`),this.data.attendees.forEach(function(t){e+=t.toString()}),this.data.alarms.forEach(function(t){e+=t.toString()}),this.data.categories.length>0&&(e+="CATEGORIES:"+this.data.categories.map(t=>t.toString()).join()+`\r
`),this.data.url&&(e+="URL;VALUE=URI:"+F(this.data.url,!1)+`\r
`),this.data.attachments.length>0&&this.data.attachments.forEach(t=>{e+="ATTACH:"+F(t,!1)+`\r
`}),this.data.status&&(e+="STATUS:"+this.data.status.toUpperCase()+`\r
`),this.data.busystatus&&(e+="X-MICROSOFT-CDO-BUSYSTATUS:"+this.data.busystatus.toUpperCase()+`\r
`),this.data.priority!==null&&(e+="PRIORITY:"+this.data.priority+`\r
`),e+=An(this.data),this.data.created&&(e+="CREATED:"+ye(this.calendar.timezone(),this.data.created)+`\r
`),this.data.lastModified&&(e+="LAST-MODIFIED:"+ye(this.calendar.timezone(),this.data.lastModified)+`\r
`),this.data.class&&(e+="CLASS:"+this.data.class.toUpperCase()+`\r
`),e+=`END:VEVENT\r
`,e}transparency(e){return e===void 0?this.data.transparency:e?(this.data.transparency=me(Vr,e),this):(this.data.transparency=null,this)}uid(e){return e===void 0?this.id():this.id(e)}url(e){return e===void 0?this.data.url:(this.data.url=e?String(e):null,this)}x(e,t){return e===void 0?ve(this.data):(typeof e=="string"&&typeof t=="string"&&ve(this.data,e,t),typeof e=="object"&&ve(this.data,e),this)}swapStartAndEndIfRequired(){if(this.data.start&&this.data.end&&lr(this.data.start).getTime()>lr(this.data.end).getTime()){let e=this.data.start;this.data.start=this.data.end,this.data.end=e}}},Gr=(e=>(e.ADD="ADD",e.CANCEL="CANCEL",e.COUNTER="COUNTER",e.DECLINECOUNTER="DECLINECOUNTER",e.PUBLISH="PUBLISH",e.REFRESH="REFRESH",e.REPLY="REPLY",e.REQUEST="REQUEST",e))(Gr||{}),Ms=class{data;constructor(e={}){this.data={description:null,events:[],method:null,name:null,prodId:"//sebbo.net//ical-generator//EN",scale:null,source:null,timezone:null,ttl:null,url:null,x:[]},e.prodId!==void 0&&this.prodId(e.prodId),e.method!==void 0&&this.method(e.method),e.name!==void 0&&this.name(e.name),e.description!==void 0&&this.description(e.description),e.timezone!==void 0&&this.timezone(e.timezone),e.source!==void 0&&this.source(e.source),e.url!==void 0&&this.url(e.url),e.scale!==void 0&&this.scale(e.scale),e.ttl!==void 0&&this.ttl(e.ttl),e.events!==void 0&&this.events(e.events),e.x!==void 0&&this.x(e.x)}clear(){return this.data.events=[],this}createEvent(e){let t=e instanceof ur?e:new ur(e,this);return this.data.events.push(t),t}description(e){return e===void 0?this.data.description:(this.data.description=e?String(e):null,this)}events(e){return e?(e.forEach(t=>this.createEvent(t)),this):this.data.events}length(){return this.data.events.length}method(e){return e===void 0?this.data.method:e?(this.data.method=me(Gr,e),this):(this.data.method=null,this)}name(e){return e===void 0?this.data.name:(this.data.name=e?String(e):null,this)}prodId(e){if(!e)return this.data.prodId;if(typeof e=="string")return this.data.prodId=e,this;if(typeof e!="object")throw new Error("`prodid` needs to be a string or an object!");if(!e.company)throw new Error("`prodid.company` is a mandatory item!");if(!e.product)throw new Error("`prodid.product` is a mandatory item!");let t=(e.language||"EN").toUpperCase();return this.data.prodId="//"+e.company+"//"+e.product+"//"+t,this}scale(e){return e===void 0?this.data.scale:(e===null?this.data.scale=null:this.data.scale=e.toUpperCase(),this)}source(e){return e===void 0?this.data.source:(this.data.source=e||null,this)}timezone(e){return e===void 0?this.data.timezone?.name||null:(e==="UTC"?this.data.timezone=null:typeof e=="string"?this.data.timezone={name:e}:e===null?this.data.timezone=null:this.data.timezone=e,this)}toJSON(){return Object.assign({},this.data,{events:this.data.events.map(e=>e.toJSON()),timezone:this.timezone(),x:this.x()})}toString(){let e="";return e=`BEGIN:VCALENDAR\r
VERSION:2.0\r
`,e+="PRODID:-"+this.data.prodId+`\r
`,this.data.url&&(e+="URL:"+this.data.url+`\r
`),this.data.source&&(e+="SOURCE;VALUE=URI:"+this.data.source+`\r
`),this.data.scale&&(e+="CALSCALE:"+this.data.scale+`\r
`),this.data.method&&(e+="METHOD:"+this.data.method+`\r
`),this.data.name&&(e+="NAME:"+this.data.name+`\r
`,e+="X-WR-CALNAME:"+this.data.name+`\r
`),this.data.description&&(e+="X-WR-CALDESC:"+this.data.description+`\r
`),this.data.timezone?.generator&&[...new Set([this.timezone(),...this.data.events.map(t=>t.timezone())])].filter(t=>t!==null&&!t.startsWith("/")).forEach(t=>{if(!this.data.timezone?.generator)return;let n=this.data.timezone.generator(t);n&&(e+=n.replace(/\r\n/g,`
`).replace(/\n/g,`\r
`).trim()+`\r
`)}),this.data.timezone?.name&&(e+="TIMEZONE-ID:"+this.data.timezone.name+`\r
`,e+="X-WR-TIMEZONE:"+this.data.timezone.name+`\r
`),this.data.ttl&&(e+="REFRESH-INTERVAL;VALUE=DURATION:"+_e(this.data.ttl)+`\r
`,e+="X-PUBLISHED-TTL:"+_e(this.data.ttl)+`\r
`),this.data.events.forEach(t=>e+=t.toString()),e+=An(this.data),e+="END:VCALENDAR",Ds(e)}ttl(e){return e===void 0?this.data.ttl:(As(e)?this.data.ttl=e.asSeconds():e&&e>0?this.data.ttl=e:this.data.ttl=null,this)}url(e){return e===void 0?this.data.url:(this.data.url=e||null,this)}x(e,t){if(e===void 0)return ve(this.data);if(typeof e=="string"&&typeof t=="string")ve(this.data,e,t);else if(typeof e=="object")ve(this.data,e);else throw new Error("Either key or value is not a string!");return this}};function Ls(e){return new Ms(e)}var Os=Ls;function ks(e){const{ctx:t,x:n,y:r,width:i,height:o,radius:a,color:s}=e;t.fillStyle=s,t.beginPath(),t.moveTo(n+a,r),t.lineTo(n+i-a,r),t.quadraticCurveTo(n+i,r,n+i,r+a),t.lineTo(n+i,r+o-a),t.quadraticCurveTo(n+i,r+o,n+i-a,r+o),t.lineTo(n+a,r+o),t.quadraticCurveTo(n,r+o,n,r+o-a),t.lineTo(n,r+a),t.quadraticCurveTo(n,r,n+a,r),t.closePath(),t.fill()}function _t(e,t,n,r){const o=document.createElement("canvas").getContext("2d");if(!o)return[];o.font=`${r}px '${n}'`;let a="";const s=[];for(const l of e){const h=a+l;o.measureText(h).width>t&&a!==""?(s.push(a),a=l):a=h}return a&&s.push(a),s}function Xr(e){const{ctx:t,x:n,y:r,text:i,font:o,fontSize:a,color:s,align:l="left"}=e;t.fillStyle=s,t.font=`${a}px '${o}'`,t.textAlign=l||"left",t.fillText(i,n,r)}function zs(e){const{ctx:t,x:n,y:r,width:i,height:o,title:a,professor:s,location:l,font:h,fontSize:u}=e,f=_t(a,i,h,u),m=_t(s,i,h,u),g=_t(l,i,h,u);let A=0;const p=[...f,...g,...m].slice(0,3);A=p.reduce((T,b,N)=>b===""?T+2:T+u,0);let E=(o-A)/2+u-7;p.forEach((T,b)=>{T!==""?(Xr({ctx:t,x:n,y:r+E,text:T,font:h,fontSize:u,color:`rgba(0, 0, 0, ${b<f.length?.8:.5})`}),E+=u+5):E+=2})}async function Kr(e){const{timetableName:t,lectures:n,timetableType:r,semesterName:i,semesterFontSize:o,tileFontSize:a}=e,s=["#F2CECE","#F4B3AE","#F2BCA0","#F0D3AB","#F1E1A9","#f4f2b3","#dbf4be","#beedd7","#b7e2de","#c9eaf4","#B4D3ED","#B9C5ED","#CCC6ED","#D8C1F0","#EBCAEF","#f4badb"],l=`Image_template_${r}.png`,h=new Image;h.src=l,await new Promise((g,A)=>{h.onload=g,h.onerror=A});const u=await ar.loadImage(l),f=ar.createCanvas(u.width,u.height),m=f.getContext("2d");m.drawImage(u,0,0),Xr({ctx:m,x:r==="5days"?952:1302,y:78,text:i+" "+t,font:"NotoSansKR",fontSize:o,color:"#CCCCCC",align:"right"});for(const g of n){const A=s[g.courseId%16]||"#F2CECE";for(const p of g.classes){const{day:x,begin:E,end:T}=p,[b,N,S,D]=[178*x+76,E*4/3-486,171,(T-E)*4/3-7];ks({ctx:m,x:b,y:N,width:S,height:D,radius:4,color:A}),zs({ctx:m,x:b+12,y:N+8,width:S-24,height:D-16,title:g.name,professor:mi(g.professors)||"",location:p.buildingCode+" "+p.roomName||"",font:"NotoSansKR",fontSize:a})}}return f}async function Bs(e){const n=(await Kr(e)).toDataURL("image/png"),r=document.createElement("a");r.href=n,r.download=`${e.timetableName}.png`,r.click(),URL.revokeObjectURL(n)}async function Ps(e){const n=(await Kr(e)).toDataURL("image/png"),i=await(await fetch(n)).blob();if(!navigator.clipboard?.write)return;const o=new ClipboardItem({"image/png":i});await navigator.clipboard.write([o])}function Us(e){const{name:t,lectures:n,semesterObject:r}=e,i=Os({name:t,prodId:"//SPARCS//OTL Plus",timezone:"Asia/Seoul"});for(const l of n)for(const h of l.classes){const u=h.buildingCode+" "+h.roomName,f=new Date(r.beginning),m=(h.day+1)%7,g=new Date(f),A=g.getDay(),p=(m+7-A)%7;g.setDate(g.getDate()+p);const x=Math.floor(h.begin/60),E=h.begin%60,T=Math.floor(h.end/60),b=h.end%60,N=new Date(g);N.setHours(x,E,0,0);const S=new Date(g);S.setHours(T,b,0,0),i.createEvent({start:N,end:S,summary:l.name,location:u,repeating:{freq:Rn.WEEKLY,until:new Date(r.end)},timezone:"Asia/Seoul"}).alarms([{type:In.display,trigger:900}])}const o=new Blob([i.toString()],{type:"text/calendar;charset=utf-8"}),a=URL.createObjectURL(o),s=document.createElement("a");s.href=a,s.download=`${t}.ics`,s.click(),URL.revokeObjectURL(a)}const Fs=w(L)`
    width: 100%;

    ${j.laptop} {
        height: 56px;
        flex-wrap: wrap;
        align-items: center;
    }

    ${j.tablet} {
        height: auto;
        flex-wrap: nowrap;
        align-items: flex-start;
    }
`,en=w.button`
    display: flex;
    flex-direction: row;
    align-items: center;
    gap: 8px;
    background: none;
    border: none;
    cursor: pointer;
    padding: 4px 0;
    color: ${({theme:e})=>e.colors.Highlight.default};
    font-size: 13px;

    &:hover {
        text-decoration: underline;
    }
`;function un({timetableName:e,timetableLectures:t,year:n,semester:r}){const{t:i}=we(),o=Ue(),a=Ne("tablet"),{query:s}=ce("GET","/semesters"),[l,h]=c.useState("idle"),u=c.useMemo(()=>s?s.data?.semesters.find(f=>f.year===n&&f.semester===r):null,[s.data,n,r]);return c.useEffect(()=>{if(l.startsWith("success")){const f=setTimeout(()=>{h("idle")},500);return()=>clearTimeout(f)}},[l]),y(Fs,{direction:a?"row":"column",gap:8,children:[y(en,{onClick:()=>{l==="idle"&&(Ps({timetableName:e,lectures:t,timetableType:"5days",semesterName:n+" "+tn(r),semesterFontSize:30,tileFontSize:20}),h("successCopyImage"))},children:[d(re,{size:16,color:o.colors.Highlight.default,onClick:()=>{},children:l=="successCopyImage"?d(Ht,{}):d(vn,{})}),!a&&d("span",{children:i("timetable.copyImage")})]}),y(en,{onClick:()=>{l==="idle"&&(Bs({timetableName:e,lectures:t,timetableType:"5days",semesterName:n+" "+tn(r),semesterFontSize:30,tileFontSize:20}),h("successDownloadImage"))},children:[d(re,{size:16,color:o.colors.Highlight.default,onClick:()=>{},children:l=="successDownloadImage"?d(Ht,{}):d(xi,{})}),!a&&d("span",{children:i("timetable.exportImage")})]}),y(en,{onClick:()=>{if(l==="idle"){if(!u)return;Us({name:e,lectures:t,semesterObject:{beginning:new Date(u.beginning),end:new Date(u.end)}}),h("successDownloadCalendar")}},children:[d(re,{size:16,color:o.colors.Highlight.default,children:l=="successDownloadCalendar"?d(Ht,{}):d(bi,{})}),!a&&d("span",{children:i("timetable.exportICal")})]})]})}const $s=w.div`
    display: flex;
    flex-direction: column;
    width: 264px;
    height: 100%;
    gap: 12px;
    overflow-y: auto;

    scrollbar-width: none;
    &::-webkit-scrollbar {
        display: none;
    }

    ${j.laptop} {
        flex-direction: row;
        justify-content: space-around;
        align-items: center;
        width: 100%;
    }
`;function js({timetableName:e,timetableLectures:t,hover:n,setHover:r,year:i,semester:o}){const a=Ne("laptop");return y($s,{children:[!a&&d(Ts,{timetableLectures:t,hover:n,setHover:r}),d(ls,{hover:n,setHover:r,timetableLectures:t}),!a&&d(ht,{direction:"row"}),d(us,{timetableLectures:t,hover:n,setHover:r}),!a&&d(ht,{direction:"row"}),!a&&d(vs,{timetableLectures:t,hover:n,setHover:r}),!a&&d(ht,{direction:"row"}),!a&&d(un,{timetableName:e,timetableLectures:t,year:i,semester:o})]})}const Hs=w(L)`
    min-height: 0;
    padding: 0 20px 12px 20px;

    ${j.tablet} {
        padding: 8px;
    }
`,Ws=w(L)`
    background-color: ${({theme:e})=>e.colors.Background.Section.default};
    padding: 16px;
    border-radius: 12px;
    align-self: stretch; /* 부모 Flex의 align-items: stretch에 맞춰 세로 길이 맞춤 */

    ${j.desktop} {
        background-color: transparent;
        padding: 0;
        border-radius: 0;
    }

    ${j.tablet} {
        flex: 1 0 0;
    }
`,qs=w(L)`
    border-radius: 12px;
    width: fit-content;
    align-self: stretch; /* 부모 Flex의 align-items: stretch에 맞춰 세로 길이 맞춤 */

    ${j.laptop} {
        max-width: none;
    }

    ${j.tablet} {
        width: 100%;
        max-width: none;
        flex: 1 0 0;
    }
`,Ys=w(L)`
    background-color: ${({theme:e})=>e.colors.Background.Section.default};
    border-top-right-radius: 12px;
    border-bottom-left-radius: 12px;
    border-bottom-right-radius: 12px;
    padding: 16px;
    flex: 1;
    min-height: 0;

    ${j.laptop} {
        background-color: transparent;
        padding: 0;
        border-radius: 0;
    }
`,Vs=w.div`
    width: 380px;
    height: 100%;
    display: flex;

    ${j.desktop} {
        background-color: ${({theme:e})=>e.colors.Background.Section.default};
        padding: 16px;
        border-radius: 12px;
    }

    ${j.laptop} {
        width: 300px;
    }
`,Gs=w.div`
    width: 300px;
    height: 100%;
    display: flex;

    scrollbar-width: none;
    &::-webkit-scrollbar {
        display: none;
    }

    ${j.desktop} {
        width: 380px;
        background-color: ${({theme:e})=>e.colors.Background.Section.default};
        padding: 16px;
        border-radius: 12px;
    }

    ${j.laptop} {
        width: 300px;
    }

    ${j.tablet} {
        width: 100%;
    }
`,Xs=w.div`
    ${j.laptop} {
        height: 100px;
        background-color: ${({theme:e})=>e.colors.Background.Section.default};
        padding: 22px;
        border-radius: 12px;
        width: 100%;
    }
`,Ks=w(L)`
    flex: 1;
    min-height: 0;

    ${j.laptop} {
        background-color: ${({theme:e})=>e.colors.Background.Section.default};
        padding: 16px;
        border-radius: 0 12px 12px 12px;
    }
`,Qs=w.div`
    ${j.laptop} {
        height: 100px;
        background-color: ${({theme:e})=>e.colors.Background.Section.default};
        padding: 16px;
        border-radius: 12px;
    }

    ${j.tablet} {
        height: auto;
        padding: 8px;
    }
`,Js=w(L)`
    background-color: ${({theme:e})=>e.colors.Background.Section.default};
    padding: 8px;
    border-radius: 12px;
    white-space: nowrap;
`,pl=oi(function(){const t=hn(),n=Ue(),r=Ne("tablet"),i=Ne("laptop"),o=Ne("desktop"),a=c.useRef(null),s=c.useRef(null),l=c.useRef(null),[h,u]=c.useState(null),[f,m]=c.useState(null),[g,A]=c.useState(null),[p,x]=c.useState(null),[E,T]=c.useState(""),[b,N]=c.useState(-1),[S,D]=c.useState(1),[R,v]=c.useState(0),[C,k]=c.useState(0),[O,q]=c.useState(!1),{query:G}=ce("GET",`/timetables/${p}`,{enabled:p!==null}),{query:Q,setParams:Z}=ce("GET","/timetables/my-timetable",{enabled:p===null}),ee=p===null?Q.data?.lectures??[]:G.data?.lectures??[],{requestFunction:K}=ce("PATCH",`/timetables/${p}`,{onSuccess:()=>{t.invalidateQueries({queryKey:[`/timetables/${p}`]}).then(()=>{m(null),u(null)})}}),oe=c.useCallback(Y=>{K({action:"delete",lectureId:Y})},[K]);return c.useEffect(()=>{function Y(){s.current&&(v(s.current.offsetWidth),k(s.current.offsetHeight))}return Y(),window.addEventListener("resize",Y),()=>window.removeEventListener("resize",Y)},[]),c.useEffect(()=>{const Y=M=>{a.current&&!a.current.contains(M.target)&&s.current&&!s.current.contains(M.target)&&l.current&&l.current.contains(M.target)&&m(null)};return document.addEventListener("mousedown",Y),()=>document.removeEventListener("mousedown",Y)},[]),c.useEffect(()=>{m(null),u(null),b!==-1&&Z({year:b,semester:S})},[b,S]),c.useEffect(()=>{m(null),u(null)},[p]),y(Hs,{direction:r?"column-reverse":"row",align:"stretch",justify:"center",gap:12,flex:"1 0 0",ref:l,children:[!O&&r&&y(Js,{direction:"row",gap:0,children:[d(un,{timetableName:E,timetableLectures:ee,year:b,semester:S}),y(L,{direction:"row",gap:4,align:"center",style:{height:"100%"},onClick:()=>{q(!0)},children:[d(re,{size:16,color:n.colors.Highlight.default,children:d(ai,{})}),d(z,{type:"Normal",color:"Highlight.default",children:"과목 검색하기"})]})]}),(O||!r)&&y(Ws,{direction:o?"column-reverse":"row",align:"flex-start",gap:12,ref:a,children:[!r&&i&&d(Xs,{children:d(un,{timetableName:E,timetableLectures:ee,year:b,semester:S})}),d(Gs,{style:r?void 0:{overflow:"auto"},children:d(oo,{timetableLectures:ee,year:b,semester:S,hoveredLecture:h,selectedLecture:f,setSelectedLecture:m,setHoveredLecture:u,timeFilter:g,setTimeFilter:A,currentTimetableId:p})}),!o&&d(ht,{direction:"column"}),!r&&d(Vs,{style:!r||r?{overflow:"auto"}:void 0,children:d(jn,{selectedLecture:f||(h?.length==1?h[0]:null),year:b,semester:S})})]}),y(qs,{direction:"column",gap:0,align:"stretch",justify:"stretch",children:[y(L,{direction:"row",align:"center",justify:"space-between",gap:8,children:[d(as,{timeTableLectures:ee,currentTimetableId:p,setCurrentTimetableId:x,setCurrentTimetableName:T,year:b,semester:S,setYear:N,setSemester:D}),d(Di,{})]}),y(Ys,{direction:i?"column":"row",gap:i?12:30,align:"stretch",justify:"flex-start",flex:"1 0 0",children:[d(Ks,{direction:"column",gap:0,ref:s,children:d(Li,{cellWidth:r?(R-60)/5:100,fullHeight:i?C-60:C-36,lectureSummary:ee,setTimeFilter:A,hover:h,setHover:u,selected:f,setSelected:m,removeFunction:p===null?void 0:oe})}),!i&&d(ht,{direction:"column"}),d(Qs,{children:d(js,{timetableName:E,timetableLectures:ee,hover:h,setHover:u,year:b,semester:S})})]})]}),r&&f&&d(li,{isOpen:r&&!!f,onClose:()=>{},fullScreen:!0,header:!1,children:d(jn,{selectedLecture:f||(h?.length==1?h[0]:null),year:b,semester:S,onMobileModalClose:()=>{u(null),m(null)},currentTimetableId:p,timetableLectures:ee})})]})});export{pl as default};
