{"version":3,"file":"infiniteQueryBehavior-CNaqYS70.js","sources":["../../../node_modules/.pnpm/@tanstack+query-core@5.90.20/node_modules/@tanstack/query-core/build/modern/infiniteQueryBehavior.js"],"sourcesContent":["// src/infiniteQueryBehavior.ts\nimport {\n  addConsumeAwareSignal,\n  addToEnd,\n  addToStart,\n  ensureQueryFn\n} from \"./utils.js\";\nfunction infiniteQueryBehavior(pages) {\n  return {\n    onFetch: (context, query) => {\n      const options = context.options;\n      const direction = context.fetchOptions?.meta?.fetchMore?.direction;\n      const oldPages = context.state.data?.pages || [];\n      const oldPageParams = context.state.data?.pageParams || [];\n      let result = { pages: [], pageParams: [] };\n      let currentPage = 0;\n      const fetchFn = async () => {\n        let cancelled = false;\n        const addSignalProperty = (object) => {\n          addConsumeAwareSignal(\n            object,\n            () => context.signal,\n            () => cancelled = true\n          );\n        };\n        const queryFn = ensureQueryFn(context.options, context.fetchOptions);\n        const fetchPage = async (data, param, previous) => {\n          if (cancelled) {\n            return Promise.reject();\n          }\n          if (param == null && data.pages.length) {\n            return Promise.resolve(data);\n          }\n          const createQueryFnContext = () => {\n            const queryFnContext2 = {\n              client: context.client,\n              queryKey: context.queryKey,\n              pageParam: param,\n              direction: previous ? \"backward\" : \"forward\",\n              meta: context.options.meta\n            };\n            addSignalProperty(queryFnContext2);\n            return queryFnContext2;\n          };\n          const queryFnContext = createQueryFnContext();\n          const page = await queryFn(queryFnContext);\n          const { maxPages } = context.options;\n          const addTo = previous ? addToStart : addToEnd;\n          return {\n            pages: addTo(data.pages, page, maxPages),\n            pageParams: addTo(data.pageParams, param, maxPages)\n          };\n        };\n        if (direction && oldPages.length) {\n          const previous = direction === \"backward\";\n          const pageParamFn = previous ? getPreviousPageParam : getNextPageParam;\n          const oldData = {\n            pages: oldPages,\n            pageParams: oldPageParams\n          };\n          const param = pageParamFn(options, oldData);\n          result = await fetchPage(oldData, param, previous);\n        } else {\n          const remainingPages = pages ?? oldPages.length;\n          do {\n            const param = currentPage === 0 ? oldPageParams[0] ?? options.initialPageParam : getNextPageParam(options, result);\n            if (currentPage > 0 && param == null) {\n              break;\n            }\n            result = await fetchPage(result, param);\n            currentPage++;\n          } while (currentPage < remainingPages);\n        }\n        return result;\n      };\n      if (context.options.persister) {\n        context.fetchFn = () => {\n          return context.options.persister?.(\n            fetchFn,\n            {\n              client: context.client,\n              queryKey: context.queryKey,\n              meta: context.options.meta,\n              signal: context.signal\n            },\n            query\n          );\n        };\n      } else {\n        context.fetchFn = fetchFn;\n      }\n    }\n  };\n}\nfunction getNextPageParam(options, { pages, pageParams }) {\n  const lastIndex = pages.length - 1;\n  return pages.length > 0 ? options.getNextPageParam(\n    pages[lastIndex],\n    pages,\n    pageParams[lastIndex],\n    pageParams\n  ) : void 0;\n}\nfunction getPreviousPageParam(options, { pages, pageParams }) {\n  return pages.length > 0 ? options.getPreviousPageParam?.(pages[0], pages, pageParams[0], pageParams) : void 0;\n}\nfunction hasNextPage(options, data) {\n  if (!data) return false;\n  return getNextPageParam(options, data) != null;\n}\nfunction hasPreviousPage(options, data) {\n  if (!data || !options.getPreviousPageParam) return false;\n  return getPreviousPageParam(options, data) != null;\n}\nexport {\n  hasNextPage,\n  hasPreviousPage,\n  infiniteQueryBehavior\n};\n//# sourceMappingURL=infiniteQueryBehavior.js.map"],"names":["infiniteQueryBehavior","pages","context","query","options","direction","oldPages","oldPageParams","result","currentPage","fetchFn","cancelled","addSignalProperty","object","addConsumeAwareSignal","queryFn","ensureQueryFn","fetchPage","data","param","previous","queryFnContext","queryFnContext2","page","maxPages","addTo","addToStart","addToEnd","pageParamFn","getPreviousPageParam","getNextPageParam","oldData","remainingPages","pageParams","lastIndex","hasNextPage","hasPreviousPage"],"mappings":"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","x_google_ignoreList":[0]}