name: PR Preview Cleanup

on:
    pull_request:
        branches: [main, rc]
        types: [closed]

jobs:
    cleanup-preview:
        name: Cleanup PR Preview
        runs-on: ubuntu-latest
        permissions:
            contents: write

        steps:
            - name: Checkout gh-pages branch
              uses: actions/checkout@v4
              with:
                  ref: gh-pages
                  fetch-depth: 0

            - name: Remove PR preview directory
              run: |
                  PR_DIR="pr-${{ github.event.pull_request.number }}"
                  if [ -d "$PR_DIR" ]; then
                    rm -rf "$PR_DIR"
                    git config user.name "github-actions[bot]"
                    git config user.email "github-actions[bot]@users.noreply.github.com"
                    git add -A
                    git commit -m "chore: cleanup preview for PR #${{ github.event.pull_request.number }}"
                    git push
                    echo "Removed preview for PR #${{ github.event.pull_request.number }}"
                  else
                    echo "No preview directory found for PR #${{ github.event.pull_request.number }}"
                  fi
