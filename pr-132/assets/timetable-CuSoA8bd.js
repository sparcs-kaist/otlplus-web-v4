const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-WIeaGq_p.js","assets/chunk-JZWAC4HX-CypP3aYd.js","assets/env-DU65zTMS.js"])))=>i.map(i=>d[i]);
import{u as Ut,t as Ce,_ as qn}from"./index-WIeaGq_p.js";import{p as He,r as c,L as xi,R as J,w as Ei}from"./chunk-JZWAC4HX-CypP3aYd.js";import{a as w,j as s,F as We,u as qe}from"./emotion-react-jsx-runtime.browser.esm-CSGOjjze.js";import{s as E,F as N}from"./FlexWrapper-ClZAwvme.js";import{C as cn,S as Ti}from"./proxy-CyuYuJ--.js";import{M as Dr}from"./Modal-CEZr2hGg.js";import{S as mt}from"./StyledDivider-CdYdSGO7.js";import{C as Wn}from"./CustomTimeTableGrid-C8CSpHTx.js";import{e as Ye,v as nt,g as je,u as Y,I as V,k as dn,q as Ke,W as ee,x as Si}from"./useIsDevice-BGP3W1m6.js";import{T as O}from"./Typography-TFUHRtP7.js";import{A as wn,S as Ci,c as Di,C as Kt}from"./checkEmpty-DjcxRYw8.js";import{R as Ri,F as xn,p as Ai}from"./ReviewBlock-MdHYsX_4.js";import{B as Lt,m as $}from"./media-Bo6ID7pW.js";import{u as Rr,b as Ar,C as Ii,S as Ni}from"./Credits-BVrgt44u.js";import{u as ot}from"./useUserStore-BEZOwGgD.js";import{u as Re}from"./useTranslation-0zVaXusR.js";import{L as un}from"./LoadingCircle-BOUIf7V0.js";import{a as gt}from"./index-CvVrTh64.js";import{I as it}from"./IconButton-DkctJ35P.js";import{u as ki}from"./useThemeStore-DL-MJNXI.js";import{T as Hn}from"./TextInputArea-BFk48Ijj.js";import{c as Li}from"./index-CmJKHkdf.js";import"./env-DU65zTMS.js";import"./infiniteQueryBehavior-BaBP6rAS.js";(function(){try{var e=typeof window<"u"?window:typeof global<"u"?global:typeof globalThis<"u"?globalThis:typeof self<"u"?self:{};e.SENTRY_RELEASE={id:"94bcaa45a12a089c377ec0a72ec75979c22d0e7c"};var t=new e.Error().stack;t&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[t]="b0e1b435-7fc9-4ad6-962f-387f298988ae",e._sentryDebugIdIdentifier="sentry-dbid-b0e1b435-7fc9-4ad6-962f-387f298988ae")}catch{}})();const Mi=Ye(He.jsx("path",{d:"M19 3H5c-1.11 0-2 .9-2 2v14c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2m-2 10h-4v4h-2v-4H7v-2h4V7h2v4h4z"})),Oi=Ye(He.jsx("path",{d:"M19 4h-1V2h-2v2H8V2H6v2H5c-1.11 0-1.99.9-1.99 2L3 20c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2m0 16H5V10h14zM9 14H7v-2h2zm4 0h-2v-2h2zm4 0h-2v-2h2zm-8 4H7v-2h2zm4 0h-2v-2h2zm4 0h-2v-2h2z"})),En=Ye(He.jsx("path",{d:"M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2m0 16H8V7h11z"})),Ir=Ye(He.jsx("path",{d:"M16.5 3c-1.74 0-3.41.81-4.5 2.09C10.91 3.81 9.24 3 7.5 3 4.42 3 2 5.42 2 8.5c0 3.78 3.4 6.86 8.55 11.54L12 21.35l1.45-1.32C18.6 15.36 22 12.28 22 8.5 22 5.42 19.58 3 16.5 3m-4.4 15.55-.1.1-.1-.1C7.14 14.24 4 11.39 4 8.5 4 6.5 5.5 5 7.5 5c1.54 0 3.04.99 3.57 2.36h1.87C13.46 5.99 14.96 5 16.5 5c2 0 3.5 1.5 3.5 3.5 0 2.89-3.14 5.74-7.9 10.05"})),Bi=Ye(He.jsx("path",{d:"M21 19V5c0-1.1-.9-2-2-2H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2M8.5 13.5l2.5 3.01L14.5 12l4.5 6H5z"})),zi=Ye(He.jsx("path",{d:"M15.41 7.41 14 6l-6 6 6 6 1.41-1.41L10.83 12z"})),Pi=Ye(He.jsx("path",{d:"M10 6 8.59 7.41 13.17 12l-4.58 4.59L10 18l6-6z"}));function wt(e,t){for(const n of e)for(const r of t)if(n.day==r.day&&n.begin<r.end&&r.begin<n.end)return!0;return!1}function Nr(e){return e.map(t=>t.name).join(", ")}function $i(e){return e.slice().sort((n,r)=>{const i=n.day,o=r.day;return i!==o?i-o:n.begin-r.begin}).map(n=>n.str).join(" / ")}function Fi(e){const t={};return e.forEach(n=>{const r=n.buildingCode,i=n.roomName;r in t?t[r]&&!t[r].includes(i)&&(t[r]=t[r].concat(`, ${i}`)):t[r]=i}),Object.entries(t).map(([n,r])=>`(${n}) ${r}`).join(" / ")}const Ui=E(N)`
    width: 100%;
`,ji=E(N)`
    width: 100%;
    max-width: 300px;
    padding: 10px;
`,qi=E(N)`
    flex: 1 0 0;
`,_e=E(O)`
    white-space: nowrap;
`,Wi=({selectedLecture:e})=>{const{t}=Re();return e?w(We,{children:[w(Ui,{direction:"column",gap:8,children:[w(N,{direction:"row",gap:6,children:[s(_e,{type:"NormalBold",color:"Text.default",children:t("common.search.type")}),s(O,{type:"Normal",color:"Text.default",children:e?.type})]}),w(N,{direction:"row",gap:6,children:[s(_e,{type:"NormalBold",color:"Text.default",children:t("common.search.department")}),s(O,{type:"Normal",color:"Text.default",children:e?.department.name})]}),w(N,{direction:"row",gap:6,children:[s(_e,{type:"NormalBold",color:"Text.default",children:t("common.professor")}),s(O,{type:"Normal",color:"Text.default",children:Nr(e?.professors||[])})]}),w(N,{direction:"row",gap:6,children:[s(_e,{type:"NormalBold",color:"Text.default",children:t("common.room")}),s(O,{type:"Normal",color:"Text.default",children:Fi(e?.classes||[])})]}),w(N,{direction:"row",gap:6,children:[s(_e,{type:"NormalBold",color:"Text.default",children:t("common.limit")}),s(O,{type:"Normal",color:"Text.default",children:e?.limitPeople})]}),w(N,{direction:"row",gap:6,children:[s(_e,{type:"NormalBold",color:"Text.default",children:t("common.exam")}),s(O,{type:"Normal",color:"Text.default",children:$i(e?.examTimes||[])})]})]}),s(ji,{direction:"row",gap:0,justify:"space-around",align:"center",children:[[e.isEnglish?"Eng":"한",t("common.language")],[e.credit,t("common.credit")],[e.limitPeople===0?"0.00:1":(e.numPeople/e.limitPeople).toFixed(2)+":1",t("timetable.competitionRate")]].map(([n,r],i)=>w(qi,{direction:"column",gap:0,align:"center",children:[s(O,{type:"Bigger",color:"Text.default",children:n}),s(O,{type:"Smaller",color:"Text.default",children:r})]},i))})]}):null},Hi=E(N)`
    width: 100%;
    max-width: 300px;
    padding: 10px;
`,Yi=E(N)`
    flex: 1 0 0;
`,Vi=E.div`
    width: 100%;
    min-height: 1px;
    background-color: ${({theme:e})=>e.colors.Line.divider};
`,Gi=({selectedCourseId:e,selectedProfessorId:t})=>{const{t:n}=Re(),[r,i]=c.useState(!1),{query:o,setParams:a,data:l}=Rr("GET","/reviews",{gcTime:0,infinites:["reviews"],limit:20}),{ref:d,inView:h}=Ar({threshold:0});return c.useEffect(()=>{i(!1);const u=setTimeout(()=>{a({mode:"default",courseId:e??void 0,professorId:t??void 0}),i(!0)},1e3);return()=>clearTimeout(u)},[e,t]),c.useEffect(()=>{h&&o.hasNextPage&&!o.isFetchingNextPage&&o.fetchNextPage()},[h,o]),!l||!r?s(un,{}):w(We,{children:[s(N,{direction:"row",gap:0,justify:"center",align:"center",style:{width:"100%"},children:s(Hi,{direction:"row",gap:0,justify:"space-between",align:"center",children:[[nt(l?.averageGrade,l?.reviews.length),n("common.grade")],[nt(l?.averageLoad,l?.reviews.length),n("common.load")],[nt(l?.averageSpeech,l?.reviews.length),n("common.speech")]].map(([u,f],g)=>w(Yi,{direction:"column",gap:0,align:"center",children:[s(O,{type:"Bigger",color:"Text.default",children:u}),s(O,{type:"Smaller",color:"Text.default",children:f})]},g))})}),s(Vi,{}),l?.reviews.map(u=>s(Ri,{review:u,linkToDictionary:!0},u.id)),o.hasNextPage&&s(un,{ref:d})]})},Xi=E(N)`
    width: 100%;
    height: 100%;
    overflow-x: hidden;
    overflow-y: auto;

    scrollbar-width: none;
    &::-webkit-scrollbar {
        display: none;
    }
`,Yn=E(N)`
    width: 100%;
`,Ki=E(N)`
    width: 100%;
    position: sticky;
    top: 0;
    background-color: ${({theme:e})=>e.colors.Background.Section.default};
    z-index: 10;
    padding-bottom: 10px;
    text-align: center;
`,_i=E(N)`
    position: sticky;
    bottom: 0;
    width: 100%;
    padding: 12px 0;
    background-color: ${({theme:e})=>e.colors.Background.Section.default};
    margin-top: auto;
    z-index: 20;
`,Qi=E(xi)`
    text-decoration: none;
`,Ji=E.a`
    text-decoration: none;
`,Vn=({setNonLoginTimetable:e,handleRemoveFromTimetable:t,selectedLecture:n,onMobileModalClose:r,year:i,semester:o,currentTimetableId:a,timetableLectures:l})=>{const d=Ut(),h=qe(),{t:u}=Re(),{user:f,status:g}=ot(),p=je("tablet"),{requestFunction:C}=Y("PATCH",`/timetables/${a}`,{onSuccess:()=>{d.invalidateQueries({queryKey:[`/timetables/${a}`]})}}),[b,m]=c.useState([]),{query:v,setParams:x}=Y("GET",`/users/${f?.id}/wishlist`,{enabled:g==="success"&&i!=-1});c.useEffect(()=>{i!==-1&&x({year:i,semester:o})},[i,o,a]),c.useEffect(()=>{v.data&&m(v.data.courses.flatMap(y=>y.lectures).map(y=>y.id))},[v.data]);const{requestFunction:R}=Y("PATCH",`/users/${f?.id}/wishlist`,{onSuccess:()=>{d.invalidateQueries({queryKey:[`/users/${f?.id}/wishlist`]})}}),S=c.useRef(null),k=y=>{const D={syy:String(i),smtDivCd:String(o),subjtCd:y.code,syllabusOpenYn:"0"};return`https://erp.kaist.ac.kr/com/lgin/SsoCtr/initExtPageWork.do?link=estblSubjt&params=${btoa(JSON.stringify(D))}`},A=async y=>{if(l){if(g!=="success"&&e!==void 0){if(l.some(D=>wt(D.classes,y.classes))){alert(u("timetable.addLectureConflict"));return}e(D=>[...D,y]),Ce("Add Lecture to Timetable",{lectureId:y.id,lectureCode:y.code,courseName:y.name,timetableId:null,isGuest:!0,source:"LectureDetail"});return}if(a){if(l.some(D=>wt(D.classes,y.classes))){alert(u("timetable.addLectureConflict"));return}}else{console.warn("No timetable selected");return}C({action:"add",lectureId:y.id}),Ce("Add Lecture to Timetable",{lectureId:y.id,lectureCode:y.code,courseName:y.name,timetableId:a,source:"LectureDetail"})}},M=async(y,D)=>{if(g==="idle")return;const L=y?"delete":"add";Ce("Update Wishlist",{action:L,lectureId:D,source:"LectureDetail"}),R({lectureId:D,mode:L})};return s(Xi,{direction:"column",gap:12,align:"center",justify:n?"start":"center",children:n?w(We,{children:[w(Ki,{direction:"column",gap:2,align:"center",justify:"center",children:[w(N,{direction:"row",align:"center",gap:8,justify:p?"space-between":"center",style:{width:"100%"},children:[p&&s("div",{style:{width:20}}),s(O,{type:"Bigger",color:"Text.default",children:n.name+n.subtitle}),p&&s(V,{size:20,onClick:r,color:h.colors.Text.default,children:s(cn,{})})]}),s(O,{type:"Big",color:"Text.default",children:n.code})]}),w(N,{direction:"row",gap:8,justify:"flex-end",style:{width:"100%"},children:[s(Qi,{to:`/dictionary?courseId=${n.courseId}`,children:s(O,{type:"Normal",color:"Highlight.default",style:{cursor:"pointer"},children:u("header.dictionary")})}),s(Ji,{href:k(n),target:"_blank",children:s(O,{type:"Normal",color:"Highlight.default",style:{cursor:"pointer"},children:u("header.syllabus")})})]}),s(Yn,{direction:"column",gap:10,align:"center",children:s(Wi,{selectedLecture:n})}),s(Yn,{ref:S,direction:"column",gap:10,children:s(Gi,{selectedCourseId:n.courseId,selectedProfessorId:n.professors[0]?.id??-1})}),p&&w(_i,{direction:"row",gap:12,justify:"flex-end",children:[g==="success"&&w(Lt,{onClick:()=>{M(b.includes(n.id),n.id),r&&r()},children:[s(V,{size:15,children:s(xn,{})}),s(O,{type:"NormalBold",children:b.includes(n.id)?u("timetable.removeFromWishlist"):u("timetable.addToWishlist")})]}),(a||g!=="success")&&(l?.some(y=>y.id===n.id)?w(Lt,{type:"selected",onClick:()=>{t&&t(n.id),r&&r()},children:[s(V,{size:15,children:s(cn,{})}),s(O,{type:"NormalBold",children:u("timetable.removeFromTimetable")})]}):w(Lt,{type:"selected",onClick:()=>{A(n),r&&r()},children:[s(V,{size:15,children:s(wn,{})}),s(O,{type:"NormalBold",children:u("timetable.addToTimetable")})]}))]})]}):s(Ii,{})})},Zi=E.div`
    width: 100%;
    display: flex;
    flex-direction: column;
    border-radius: 8px;
    background-color: ${({theme:e})=>e.colors.Background.Block.default};
    transition: all 0.2s ease;
    transform: none;
    box-shadow: none;
    overflow: hidden;
    flex-shrink: 0;
    opacity: 0.2;

    [data-selected-lecture=""] & {
        opacity: 1;
    }

    &[data-is-selected="true"] {
        opacity: 1;
        transform: translateY(-2px);
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.15);
    }
`,eo=E(N)`
    width: 100%;
    padding: 8px 12px;
    word-break: keep-all;
`,to=E.div`
    width: 100%;
    display: flex;
    align-items: center;
    padding: 8px 12px 8px 18px;
    flex-direction: row;
    justify-content: space-between;
    background-color: ${({theme:e})=>e.colors.Background.Block.default};
    cursor: pointer;

    &:hover,
    [data-selected-lecture="${({lectureId:e})=>e}"] &,
    [data-hovered-lectures~="${({lectureId:e})=>e}"]:not(:hover) & {
        background-color: ${({theme:e})=>e.colors.Background.Block.dark};
    }

    ${$.tablet} {
        &:hover {
            background-color: ${({theme:e})=>e.colors.Background.Block.default};
        }
        [data-hovered-lectures~="${({lectureId:e})=>e}"] & {
            background-color: ${({theme:e})=>e.colors.Background.Block.dark};
        }
    }
`,Gn=E.div`
    width: 95%;
    height: 1px;
    background-color: ${({theme:e})=>e.colors.Line.block};
    align-self: center;
`,no=({course:e,wishlist:t,currentTimetableId:n,timetableLectures:r,isAddTimetablePending:i,handleSetHoveredLecture:o,handleClearHoveredLecture:a,handleSetSelectedLecture:l,selectedLecture:d,hoveredLecture:h,handleLikeClick:u,handleAddToTimetable:f,t:g})=>{const{status:p}=ot(),C=qe(),b=je("tablet"),m=J.useRef(null);return c.useEffect(()=>{m.current?.setAttribute("data-is-selected",d?.id!=null&&e.lectures.some(v=>v.id===d.id)?"true":"false")},[d,e]),w(Zi,{ref:m,"data-is-selected":"",children:[w(eo,{direction:"row",gap:6,align:"center",justify:"space-between",children:[w(N,{direction:"row",gap:6,align:"center",style:{opacity:e.completed?.3:1},children:[s(O,{type:"NormalBold",color:"Text.default",children:e.name}),s(O,{type:"Normal",color:"Text.default",children:e.code})]}),e.completed?s(O,{type:"Normal",color:"Text.default",children:g("common.completedCourse")}):s(O,{type:"Normal",color:"Highlight.default",style:{textAlign:"end"},children:e.type})]}),s(Gn,{}),e.lectures.map((v,x)=>{const R=t.includes(v.id),S=h?.some(k=>k.id===v.id);return w(J.Fragment,{children:[w(to,{"data-lecture-id":v.id,onMouseEnter:()=>o(v),onMouseLeave:a,onClick:()=>l(v),lectureId:v.id,children:[w(N,{direction:"column",gap:0,children:[b&&S&&w(O,{type:"Small",color:"Text.placeholder",className:"onTablet",children:[v.department.name," / ",v.type]}),w(N,{direction:"row",gap:6,style:{opacity:e.completed?.3:1},children:[w(O,{type:"NormalBold",color:"Text.default",children:[v.classNo," ",v.subtitle]}),s(O,{type:"Normal",color:"Text.default",children:Nr(v.professors)})]}),b&&S&&w(O,{type:"Small",color:"Text.placeholder",className:"onTablet",children:[v.classes[0]?.buildingName," ",v.classes[0]?.roomName," /"," ",v.limitPeople]})]}),w(N,{direction:"row",gap:6,onClick:k=>k.stopPropagation(),children:[!b&&p==="success"&&(R?s(V,{size:15,color:C.colors.Highlight.default,onClick:()=>u(R,v.id),children:s(xn,{})}):s(V,{size:15,color:C.colors.Text.default,onClick:()=>u(R,v.id),children:s(Ir,{})})),(!b||S)&&s("span",{title:n==null&&p==="success"?g("timetable.myTimeTableLectureAddWarning"):"",style:{opacity:n==null&&p==="success"||r.some(k=>wt(k.classes,v.classes))?.3:1,cursor:i?"wait":"pointer"},children:s(V,{size:b?30:15,color:C.colors.Text.default,onClick:()=>f(v),children:s(wn,{})})})]})]}),x!==e.lectures.length-1&&s(Gn,{})]},v.id)})]})},ro=c.memo(no,(e,t)=>!(e.course!==t.course||e.wishlist!==t.wishlist||e.currentTimetableId!==t.currentTimetableId||e.timetableLectures!==t.timetableLectures||e.isAddTimetablePending!==t.isAddTimetablePending||e.selectedLecture!==t.selectedLecture||e.hoveredLecture!==t.hoveredLecture)),io=E(N)`
    border-radius: 6px;
    border: 1px solid ${({theme:e})=>e.colors.Line.divider};
    max-height: 100%;
`,oo=E(N)`
    height: 36px;
`,ao=E.div`
    display: flex;
    align-items: center;
    padding: 8px 12px;
    flex-direction: row;
    gap: 8px;
    border-radius: 6px;
    background-color: ${({isSelected:e,theme:t})=>e?t.colors.Background.Button.highlightDark:t.colors.Background.Button.highlight};
    cursor: pointer;
    &:hover {
        background-color: ${({theme:e})=>e.colors.Background.Button.highlightDark};
    }
`;function so({year:e,semester:t,timeFilter:n,setTimeFilter:r,data:i,setSearchResult:o,isWishlist:a,setIsWishlist:l,setWishlist:d,sortOption:h,setSortOption:u,handleSearch:f,t:g}){const p=qe(),{user:C,status:b}=ot(),{query:m,setParams:v}=Y("GET",`/users/${C?.id}/wishlist`,{enabled:b==="success"&&e!=-1});return c.useEffect(()=>{m.data!==void 0&&o(a?m.data:i??{courses:[]})},[a,i]),c.useEffect(()=>{m.data!==void 0&&(d(m.data.courses.flatMap(x=>x.lectures).map(x=>x.id)),a&&o(m.data))},[m.data]),c.useEffect(()=>{o({courses:[]}),e!==-1&&v({year:e,semester:t})},[e,t]),c.useEffect(()=>{i!==void 0&&(o(i),l(!1))},[i]),w(We,{children:[s(io,{direction:"row",justify:"stretch",gap:0,children:s(Ci,{options:["type","department","level","term","time"],timeFilter:n,setTimeFilter:r,onSearch:f})}),w(N,{direction:"row",gap:0,justify:"space-between",align:"center",children:[w(ao,{isSelected:a,onClick:()=>{l(x=>!x)},style:{paddingBlock:10},children:[s(V,{size:15,color:p.colors.Highlight.default,children:a?s(xn,{}):s(Ir,{})}),s(O,{type:"Normal",color:"Highlight.default",children:g("common.wishlist")})]}),s(oo,{direction:"row",gap:0,children:s(Ni,{options:[g("dictionary.sortOptions.code"),g("dictionary.sortOptions.popularity"),g("dictionary.sortOptions.studentCount")],setSelectedOption:u,selectedOption:h})})]})]})}const lo=c.memo(so,(e,t)=>e.year===t.year&&e.semester===t.semester&&e.timeFilter===t.timeFilter&&e.sortOption===t.sortOption&&e.isWishlist===t.isWishlist&&e.data===t.data),co=E(N)`
    width: 100%;
    height: 100%;
    overflow: hidden;
`,uo=E(O)`
    width: 100%;
    flex-grow: 1;
    display: flex;
    align-items: center;
    justify-content: center;
`,ho=E(N)`
    height: fit-content;
    overflow-y: auto;
    position: relative;
    flex-grow: 1;

    scrollbar-width: none;

    &::-webkit-scrollbar {
        display: none;
    }

    /* 상단/하단 페이드 오버레이: 자식 배경에 가려지지 않도록 컨테이너 위에 표시 */
    ${$.tablet} {
        &::before,
        &::after {
            width: 100%;
            content: "";
            position: sticky;
            left: 0;
            right: 0;
            min-height: 40%;
            pointer-events: none; /* 클릭을 막지 않도록 */
            z-index: 1;
        }
        &::before {
            top: 0;
            /* 현재 배경색 기준으로 페이드 */
            background: linear-gradient(
                to bottom,
                ${({theme:e})=>e.colors.Background.Section.default} 0%,
                rgba(0, 0, 0, 0) 100%
            );
        }
        &::after {
            bottom: 0;
            background: linear-gradient(
                to top,
                ${({theme:e})=>e.colors.Background.Section.default} 0%,
                rgba(0, 0, 0, 0) 100%
            );
        }
    }
`,fo=E(N)`
    width: 100%;
`,po=E(N)`
    width: 100%;
    height: 100%;
    flex-grow: 1;

    ${$.tablet} {
        padding-right: 4px;
    }
`,go=E.div`
    width: 0;
    height: 0;
    border-top: 7px solid transparent;
    border-bottom: 7px solid transparent;
    border-right: 10px solid ${({theme:e})=>e.colors.Text.default};
    top: 50%;
    right: 0;
    position: sticky;
    transform: translateY(-50%);
`,mo=e=>{if(!e)return e;const t=new Map;return e.courses.forEach(n=>{const r=t.get(n.id);if(!r){t.set(n.id,{...n,lectures:[...n.lectures]});return}const i=new Set(r.lectures.map(a=>a.id)),o=[...r.lectures];n.lectures.forEach(a=>{i.has(a.id)||(i.add(a.id),o.push(a))}),t.set(n.id,{...r,lectures:o})}),{...e,courses:Array.from(t.values())}},_t=50,bo=({timetableLectures:e,year:t,semester:n,setNonLoginTimetable:r,hoveredLecture:i,setHoveredLecture:o,selectedLecture:a,setSelectedLecture:l,timeFilter:d,setTimeFilter:h,currentTimetableId:u})=>{const{t:f}=Re(),{user:g,status:p}=ot(),C=Ut(),{ref:b,inView:m}=Ar({threshold:0}),v=je("tablet"),{mutation:x,requestFunction:R}=Y("PATCH",`/timetables/${u}`,{onSuccess:()=>{C.invalidateQueries({queryKey:[`/timetables/${u}`]})}}),S=c.useRef(null),k=c.useRef(null),A=c.useRef(null),{requestFunction:M}=Y("PATCH",`/users/${g?.id}/wishlist`,{onSuccess:()=>{C.invalidateQueries({queryKey:[`/users/${g?.id}/wishlist`]})}}),[y,D]=c.useState(!1),[L,B]=c.useState({courses:[]}),[U,q]=c.useState(!1),[te,F]=c.useState([]),[fe,G]=c.useState(0),{query:ie,setParams:le,data:ye}=Rr("GET","/lectures",{infinites:["courses"],limit:_t,gcTime:0,select:mo,enabled:y,iterate:T=>{let I=0;return T.courses.forEach(pe=>{I+=pe.lectures.length}),I<_t?0:I}}),Ee=c.useCallback(T=>{if(Di(T)){alert(f("common.search.empty"));return}q(!1);const I={year:t,semester:n,...T,order:["code","popular","studentCount"][fe]??"code",offset:0,limit:_t,day:T.time?.day??void 0,begin:T.time?.begin??void 0,end:T.time?.end??void 0};le(I),D(!0),Ce("Search Lectures",{year:t,semester:n,keyword:T.keyword??"",department:T.department??"",type:T.type??"",level:T.level??""})},[t,n,fe]);c.useEffect(()=>{q(!1),le(T=>({...T,order:["code","popular","studentCount"][fe]??"code",offset:0}))},[fe]),c.useEffect(()=>{m&&ie.hasNextPage&&!ie.isFetchingNextPage&&ie.fetchNextPage()},[m]),c.useEffect(()=>{const T=I=>{S.current&&!S.current.contains(I.target)&&k.current&&k.current.contains(I.target)&&l(null)};return document.addEventListener("mousedown",T),()=>document.removeEventListener("mousedown",T)},[]);const X=J.useMemo(()=>L.courses.flatMap(T=>T.lectures),[L.courses]),K=c.useCallback(()=>{if(!v)return;if(!A.current){o([]);return}const I=A.current.getBoundingClientRect(),pe=I.top+I.height/2,W=document.elementFromPoint(I.left+50,pe);if(!W)return;const re=W.closest("[data-lecture-id]");if(re){const ce=parseInt(re.getAttribute("data-lecture-id")||"",10),Ae=X.find(Oe=>Oe.id===ce);o(Ae?[Ae]:[])}},[v,X,o,l]);c.useEffect(()=>{if(!v||!A.current)return;const T=A.current;return T.addEventListener("scroll",K),()=>{T.removeEventListener("scroll",K)}},[v,K]),c.useEffect(()=>{if(!v||ie.isFetching||a)return;let T;const I=requestAnimationFrame(()=>{T=requestAnimationFrame(()=>{K()})});return()=>{cancelAnimationFrame(I),cancelAnimationFrame(T)}},[ie.isFetching,v,K,a]);const j=async(T,I)=>{if(p==="idle")return;const pe=T?"delete":"add";Ce("Update Wishlist",{action:pe,lectureId:I}),F(T?W=>W.filter(re=>re!==I):W=>[...W,I]);try{M({lectureId:I,mode:pe})}catch(W){console.error("Failed to update wishlist:",W),F(T?re=>[...re,I]:re=>re.filter(ce=>ce!==I))}},oe=async T=>{if(p==="success"){if(!u){console.warn("No timetable selected");return}if(e.some(I=>wt(I.classes,T.classes))){alert(f("timetable.addLectureConflict"));return}R({action:"add",lectureId:T.id}),Ce("Add Lecture to Timetable",{lectureId:T.id,lectureCode:T.code,courseName:T.name,timetableId:u})}else{if(e.some(I=>wt(I.classes,T.classes))){alert(f("timetable.addLectureConflict"));return}r(I=>[...I,T]),Ce("Add Lecture to Timetable",{lectureId:T.id,lectureCode:T.code,courseName:T.name,timetableId:null,isGuest:!0})}},_=c.useCallback(T=>{v||o([T])},[v,o]),Me=c.useCallback(()=>{v||o([])},[v,o]),ae=c.useCallback(T=>{if(a?.id===T.id){l(null);return}l(T)},[l,a]);return c.useEffect(()=>{A.current?.setAttribute("data-hovered-lectures",i.map(T=>T.id).join(" "))},[i,L]),c.useEffect(()=>{A.current?.setAttribute("data-selected-lecture",a?a.id.toString():"")},[a,L]),w(co,{direction:"column",justify:"stretch",align:"stretch",gap:8,ref:k,children:[s(lo,{year:t,semester:n,timeFilter:d,setTimeFilter:h,sortOption:fe,setSortOption:G,data:ye,isWishlist:U,setIsWishlist:q,setWishlist:F,setSearchResult:B,t:f,handleSearch:Ee}),L.courses.length!==0?s(ho,{direction:"column",gap:0,ref:A,"data-hovered-lectures":"","data-selected-lecture":"",children:w(fo,{direction:"row",gap:0,children:[w(po,{direction:"column",gap:12,ref:S,children:[L.courses.map(T=>s(ro,{course:T,hoveredLecture:i,selectedLecture:a,wishlist:te,currentTimetableId:u,timetableLectures:e,isAddTimetablePending:x.isPending,handleSetHoveredLecture:_,handleClearHoveredLecture:Me,handleSetSelectedLecture:ae,handleLikeClick:j,handleAddToTimetable:oe,t:f},T.id)),!U&&ie.hasNextPage&&s(un,{ref:b})]}),v&&s(go,{})]})}):s(uo,{type:"Bigger",color:"Text.placeholder",children:f("dictionary.noResults")})]})},Xn=J.memo(bo,(e,t)=>e.year===t.year&&e.semester===t.semester&&e.timeFilter===t.timeFilter&&e.currentTimetableId===t.currentTimetableId&&e.hoveredLecture===t.hoveredLecture&&e.selectedLecture===t.selectedLecture&&e.timetableLectures===t.timetableLectures);function vo(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return c.useMemo(()=>r=>{t.forEach(i=>i(r))},t)}const jt=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u";function at(e){const t=Object.prototype.toString.call(e);return t==="[object Window]"||t==="[object global]"}function Tn(e){return"nodeType"in e}function se(e){var t,n;return e?at(e)?e:Tn(e)&&(t=(n=e.ownerDocument)==null?void 0:n.defaultView)!=null?t:window:window}function Sn(e){const{Document:t}=se(e);return e instanceof t}function St(e){return at(e)?!1:e instanceof se(e).HTMLElement}function kr(e){return e instanceof se(e).SVGElement}function st(e){return e?at(e)?e.document:Tn(e)?Sn(e)?e:St(e)||kr(e)?e.ownerDocument:document:document:document}const De=jt?c.useLayoutEffect:c.useEffect;function Cn(e){const t=c.useRef(e);return De(()=>{t.current=e}),c.useCallback(function(){for(var n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];return t.current==null?void 0:t.current(...r)},[])}function yo(){const e=c.useRef(null),t=c.useCallback((r,i)=>{e.current=setInterval(r,i)},[]),n=c.useCallback(()=>{e.current!==null&&(clearInterval(e.current),e.current=null)},[]);return[t,n]}function xt(e,t){t===void 0&&(t=[e]);const n=c.useRef(e);return De(()=>{n.current!==e&&(n.current=e)},t),n}function Ct(e,t){const n=c.useRef();return c.useMemo(()=>{const r=e(n.current);return n.current=r,r},[...t])}function Ot(e){const t=Cn(e),n=c.useRef(null),r=c.useCallback(i=>{i!==n.current&&t?.(i,n.current),n.current=i},[]);return[n,r]}function hn(e){const t=c.useRef();return c.useEffect(()=>{t.current=e},[e]),t.current}let Qt={};function Dt(e,t){return c.useMemo(()=>{if(t)return t;const n=Qt[e]==null?0:Qt[e]+1;return Qt[e]=n,e+"-"+n},[e,t])}function Lr(e){return function(t){for(var n=arguments.length,r=new Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];return r.reduce((o,a)=>{const l=Object.entries(a);for(const[d,h]of l){const u=o[d];u!=null&&(o[d]=u+e*h)}return o},{...t})}}const rt=Lr(1),Bt=Lr(-1);function wo(e){return"clientX"in e&&"clientY"in e}function Dn(e){if(!e)return!1;const{KeyboardEvent:t}=se(e.target);return t&&e instanceof t}function xo(e){if(!e)return!1;const{TouchEvent:t}=se(e.target);return t&&e instanceof t}function fn(e){if(xo(e)){if(e.touches&&e.touches.length){const{clientX:t,clientY:n}=e.touches[0];return{x:t,y:n}}else if(e.changedTouches&&e.changedTouches.length){const{clientX:t,clientY:n}=e.changedTouches[0];return{x:t,y:n}}}return wo(e)?{x:e.clientX,y:e.clientY}:null}const zt=Object.freeze({Translate:{toString(e){if(!e)return;const{x:t,y:n}=e;return"translate3d("+(t?Math.round(t):0)+"px, "+(n?Math.round(n):0)+"px, 0)"}},Scale:{toString(e){if(!e)return;const{scaleX:t,scaleY:n}=e;return"scaleX("+t+") scaleY("+n+")"}},Transform:{toString(e){if(e)return[zt.Translate.toString(e),zt.Scale.toString(e)].join(" ")}},Transition:{toString(e){let{property:t,duration:n,easing:r}=e;return t+" "+n+"ms "+r}}}),Kn="a,frame,iframe,input:not([type=hidden]):not(:disabled),select:not(:disabled),textarea:not(:disabled),button:not(:disabled),*[tabindex]";function Eo(e){return e.matches(Kn)?e:e.querySelector(Kn)}const To={display:"none"};function So(e){let{id:t,value:n}=e;return J.createElement("div",{id:t,style:To},n)}function Co(e){let{id:t,announcement:n,ariaLiveType:r="assertive"}=e;const i={position:"fixed",top:0,left:0,width:1,height:1,margin:-1,border:0,padding:0,overflow:"hidden",clip:"rect(0 0 0 0)",clipPath:"inset(100%)",whiteSpace:"nowrap"};return J.createElement("div",{id:t,style:i,role:"status","aria-live":r,"aria-atomic":!0},n)}function Do(){const[e,t]=c.useState("");return{announce:c.useCallback(r=>{r!=null&&t(r)},[]),announcement:e}}const Mr=c.createContext(null);function Ro(e){const t=c.useContext(Mr);c.useEffect(()=>{if(!t)throw new Error("useDndMonitor must be used within a children of <DndContext>");return t(e)},[e,t])}function Ao(){const[e]=c.useState(()=>new Set),t=c.useCallback(r=>(e.add(r),()=>e.delete(r)),[e]);return[c.useCallback(r=>{let{type:i,event:o}=r;e.forEach(a=>{var l;return(l=a[i])==null?void 0:l.call(a,o)})},[e]),t]}const Io={draggable:`
    To pick up a draggable item, press the space bar.
    While dragging, use the arrow keys to move the item.
    Press space again to drop the item in its new position, or press escape to cancel.
  `},No={onDragStart(e){let{active:t}=e;return"Picked up draggable item "+t.id+"."},onDragOver(e){let{active:t,over:n}=e;return n?"Draggable item "+t.id+" was moved over droppable area "+n.id+".":"Draggable item "+t.id+" is no longer over a droppable area."},onDragEnd(e){let{active:t,over:n}=e;return n?"Draggable item "+t.id+" was dropped over droppable area "+n.id:"Draggable item "+t.id+" was dropped."},onDragCancel(e){let{active:t}=e;return"Dragging was cancelled. Draggable item "+t.id+" was dropped."}};function ko(e){let{announcements:t=No,container:n,hiddenTextDescribedById:r,screenReaderInstructions:i=Io}=e;const{announce:o,announcement:a}=Do(),l=Dt("DndLiveRegion"),[d,h]=c.useState(!1);if(c.useEffect(()=>{h(!0)},[]),Ro(c.useMemo(()=>({onDragStart(f){let{active:g}=f;o(t.onDragStart({active:g}))},onDragMove(f){let{active:g,over:p}=f;t.onDragMove&&o(t.onDragMove({active:g,over:p}))},onDragOver(f){let{active:g,over:p}=f;o(t.onDragOver({active:g,over:p}))},onDragEnd(f){let{active:g,over:p}=f;o(t.onDragEnd({active:g,over:p}))},onDragCancel(f){let{active:g,over:p}=f;o(t.onDragCancel({active:g,over:p}))}}),[o,t])),!d)return null;const u=J.createElement(J.Fragment,null,J.createElement(So,{id:r,value:i.draggable}),J.createElement(Co,{id:l,announcement:a}));return n?gt.createPortal(u,n):u}var H;(function(e){e.DragStart="dragStart",e.DragMove="dragMove",e.DragEnd="dragEnd",e.DragCancel="dragCancel",e.DragOver="dragOver",e.RegisterDroppable="registerDroppable",e.SetDroppableDisabled="setDroppableDisabled",e.UnregisterDroppable="unregisterDroppable"})(H||(H={}));function Pt(){}function _n(e,t){return c.useMemo(()=>({sensor:e,options:t??{}}),[e,t])}function Lo(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return c.useMemo(()=>[...t].filter(r=>r!=null),[...t])}const xe=Object.freeze({x:0,y:0});function Mo(e,t){return Math.sqrt(Math.pow(e.x-t.x,2)+Math.pow(e.y-t.y,2))}function Oo(e,t){let{data:{value:n}}=e,{data:{value:r}}=t;return n-r}function Bo(e,t){let{data:{value:n}}=e,{data:{value:r}}=t;return r-n}function zo(e,t){if(!e||e.length===0)return null;const[n]=e;return n[t]}function Qn(e,t,n){return t===void 0&&(t=e.left),n===void 0&&(n=e.top),{x:t+e.width*.5,y:n+e.height*.5}}const Po=e=>{let{collisionRect:t,droppableRects:n,droppableContainers:r}=e;const i=Qn(t,t.left,t.top),o=[];for(const a of r){const{id:l}=a,d=n.get(l);if(d){const h=Mo(Qn(d),i);o.push({id:l,data:{droppableContainer:a,value:h}})}}return o.sort(Oo)};function $o(e,t){const n=Math.max(t.top,e.top),r=Math.max(t.left,e.left),i=Math.min(t.left+t.width,e.left+e.width),o=Math.min(t.top+t.height,e.top+e.height),a=i-r,l=o-n;if(r<i&&n<o){const d=t.width*t.height,h=e.width*e.height,u=a*l,f=u/(d+h-u);return Number(f.toFixed(4))}return 0}const Fo=e=>{let{collisionRect:t,droppableRects:n,droppableContainers:r}=e;const i=[];for(const o of r){const{id:a}=o,l=n.get(a);if(l){const d=$o(l,t);d>0&&i.push({id:a,data:{droppableContainer:o,value:d}})}}return i.sort(Bo)};function Uo(e,t,n){return{...e,scaleX:t&&n?t.width/n.width:1,scaleY:t&&n?t.height/n.height:1}}function Or(e,t){return e&&t?{x:e.left-t.left,y:e.top-t.top}:xe}function jo(e){return function(n){for(var r=arguments.length,i=new Array(r>1?r-1:0),o=1;o<r;o++)i[o-1]=arguments[o];return i.reduce((a,l)=>({...a,top:a.top+e*l.y,bottom:a.bottom+e*l.y,left:a.left+e*l.x,right:a.right+e*l.x}),{...n})}}const qo=jo(1);function Wo(e){if(e.startsWith("matrix3d(")){const t=e.slice(9,-1).split(/, /);return{x:+t[12],y:+t[13],scaleX:+t[0],scaleY:+t[5]}}else if(e.startsWith("matrix(")){const t=e.slice(7,-1).split(/, /);return{x:+t[4],y:+t[5],scaleX:+t[0],scaleY:+t[3]}}return null}function Ho(e,t,n){const r=Wo(t);if(!r)return e;const{scaleX:i,scaleY:o,x:a,y:l}=r,d=e.left-a-(1-i)*parseFloat(n),h=e.top-l-(1-o)*parseFloat(n.slice(n.indexOf(" ")+1)),u=i?e.width/i:e.width,f=o?e.height/o:e.height;return{width:u,height:f,top:h,right:d+u,bottom:h+f,left:d}}const Yo={ignoreTransform:!1};function lt(e,t){t===void 0&&(t=Yo);let n=e.getBoundingClientRect();if(t.ignoreTransform){const{transform:h,transformOrigin:u}=se(e).getComputedStyle(e);h&&(n=Ho(n,h,u))}const{top:r,left:i,width:o,height:a,bottom:l,right:d}=n;return{top:r,left:i,width:o,height:a,bottom:l,right:d}}function Jn(e){return lt(e,{ignoreTransform:!0})}function Vo(e){const t=e.innerWidth,n=e.innerHeight;return{top:0,left:0,right:t,bottom:n,width:t,height:n}}function Go(e,t){return t===void 0&&(t=se(e).getComputedStyle(e)),t.position==="fixed"}function Xo(e,t){t===void 0&&(t=se(e).getComputedStyle(e));const n=/(auto|scroll|overlay)/;return["overflow","overflowX","overflowY"].some(i=>{const o=t[i];return typeof o=="string"?n.test(o):!1})}function Rn(e,t){const n=[];function r(i){if(t!=null&&n.length>=t||!i)return n;if(Sn(i)&&i.scrollingElement!=null&&!n.includes(i.scrollingElement))return n.push(i.scrollingElement),n;if(!St(i)||kr(i)||n.includes(i))return n;const o=se(e).getComputedStyle(i);return i!==e&&Xo(i,o)&&n.push(i),Go(i,o)?n:r(i.parentNode)}return e?r(e):n}function Br(e){const[t]=Rn(e,1);return t??null}function Jt(e){return!jt||!e?null:at(e)?e:Tn(e)?Sn(e)||e===st(e).scrollingElement?window:St(e)?e:null:null}function zr(e){return at(e)?e.scrollX:e.scrollLeft}function Pr(e){return at(e)?e.scrollY:e.scrollTop}function pn(e){return{x:zr(e),y:Pr(e)}}var Q;(function(e){e[e.Forward=1]="Forward",e[e.Backward=-1]="Backward"})(Q||(Q={}));function $r(e){return!jt||!e?!1:e===document.scrollingElement}function Fr(e){const t={x:0,y:0},n=$r(e)?{height:window.innerHeight,width:window.innerWidth}:{height:e.clientHeight,width:e.clientWidth},r={x:e.scrollWidth-n.width,y:e.scrollHeight-n.height},i=e.scrollTop<=t.y,o=e.scrollLeft<=t.x,a=e.scrollTop>=r.y,l=e.scrollLeft>=r.x;return{isTop:i,isLeft:o,isBottom:a,isRight:l,maxScroll:r,minScroll:t}}const Ko={x:.2,y:.2};function _o(e,t,n,r,i){let{top:o,left:a,right:l,bottom:d}=n;r===void 0&&(r=10),i===void 0&&(i=Ko);const{isTop:h,isBottom:u,isLeft:f,isRight:g}=Fr(e),p={x:0,y:0},C={x:0,y:0},b={height:t.height*i.y,width:t.width*i.x};return!h&&o<=t.top+b.height?(p.y=Q.Backward,C.y=r*Math.abs((t.top+b.height-o)/b.height)):!u&&d>=t.bottom-b.height&&(p.y=Q.Forward,C.y=r*Math.abs((t.bottom-b.height-d)/b.height)),!g&&l>=t.right-b.width?(p.x=Q.Forward,C.x=r*Math.abs((t.right-b.width-l)/b.width)):!f&&a<=t.left+b.width&&(p.x=Q.Backward,C.x=r*Math.abs((t.left+b.width-a)/b.width)),{direction:p,speed:C}}function Qo(e){if(e===document.scrollingElement){const{innerWidth:o,innerHeight:a}=window;return{top:0,left:0,right:o,bottom:a,width:o,height:a}}const{top:t,left:n,right:r,bottom:i}=e.getBoundingClientRect();return{top:t,left:n,right:r,bottom:i,width:e.clientWidth,height:e.clientHeight}}function Ur(e){return e.reduce((t,n)=>rt(t,pn(n)),xe)}function Jo(e){return e.reduce((t,n)=>t+zr(n),0)}function Zo(e){return e.reduce((t,n)=>t+Pr(n),0)}function ea(e,t){if(t===void 0&&(t=lt),!e)return;const{top:n,left:r,bottom:i,right:o}=t(e);Br(e)&&(i<=0||o<=0||n>=window.innerHeight||r>=window.innerWidth)&&e.scrollIntoView({block:"center",inline:"center"})}const ta=[["x",["left","right"],Jo],["y",["top","bottom"],Zo]];class An{constructor(t,n){this.rect=void 0,this.width=void 0,this.height=void 0,this.top=void 0,this.bottom=void 0,this.right=void 0,this.left=void 0;const r=Rn(n),i=Ur(r);this.rect={...t},this.width=t.width,this.height=t.height;for(const[o,a,l]of ta)for(const d of a)Object.defineProperty(this,d,{get:()=>{const h=l(r),u=i[o]-h;return this.rect[d]+u},enumerable:!0});Object.defineProperty(this,"rect",{enumerable:!1})}}class bt{constructor(t){this.target=void 0,this.listeners=[],this.removeAll=()=>{this.listeners.forEach(n=>{var r;return(r=this.target)==null?void 0:r.removeEventListener(...n)})},this.target=t}add(t,n,r){var i;(i=this.target)==null||i.addEventListener(t,n,r),this.listeners.push([t,n,r])}}function na(e){const{EventTarget:t}=se(e);return e instanceof t?e:st(e)}function Zt(e,t){const n=Math.abs(e.x),r=Math.abs(e.y);return typeof t=="number"?Math.sqrt(n**2+r**2)>t:"x"in t&&"y"in t?n>t.x&&r>t.y:"x"in t?n>t.x:"y"in t?r>t.y:!1}var me;(function(e){e.Click="click",e.DragStart="dragstart",e.Keydown="keydown",e.ContextMenu="contextmenu",e.Resize="resize",e.SelectionChange="selectionchange",e.VisibilityChange="visibilitychange"})(me||(me={}));function Zn(e){e.preventDefault()}function ra(e){e.stopPropagation()}var P;(function(e){e.Space="Space",e.Down="ArrowDown",e.Right="ArrowRight",e.Left="ArrowLeft",e.Up="ArrowUp",e.Esc="Escape",e.Enter="Enter",e.Tab="Tab"})(P||(P={}));const jr={start:[P.Space,P.Enter],cancel:[P.Esc],end:[P.Space,P.Enter,P.Tab]},ia=(e,t)=>{let{currentCoordinates:n}=t;switch(e.code){case P.Right:return{...n,x:n.x+25};case P.Left:return{...n,x:n.x-25};case P.Down:return{...n,y:n.y+25};case P.Up:return{...n,y:n.y-25}}};class qr{constructor(t){this.props=void 0,this.autoScrollEnabled=!1,this.referenceCoordinates=void 0,this.listeners=void 0,this.windowListeners=void 0,this.props=t;const{event:{target:n}}=t;this.props=t,this.listeners=new bt(st(n)),this.windowListeners=new bt(se(n)),this.handleKeyDown=this.handleKeyDown.bind(this),this.handleCancel=this.handleCancel.bind(this),this.attach()}attach(){this.handleStart(),this.windowListeners.add(me.Resize,this.handleCancel),this.windowListeners.add(me.VisibilityChange,this.handleCancel),setTimeout(()=>this.listeners.add(me.Keydown,this.handleKeyDown))}handleStart(){const{activeNode:t,onStart:n}=this.props,r=t.node.current;r&&ea(r),n(xe)}handleKeyDown(t){if(Dn(t)){const{active:n,context:r,options:i}=this.props,{keyboardCodes:o=jr,coordinateGetter:a=ia,scrollBehavior:l="smooth"}=i,{code:d}=t;if(o.end.includes(d)){this.handleEnd(t);return}if(o.cancel.includes(d)){this.handleCancel(t);return}const{collisionRect:h}=r.current,u=h?{x:h.left,y:h.top}:xe;this.referenceCoordinates||(this.referenceCoordinates=u);const f=a(t,{active:n,context:r.current,currentCoordinates:u});if(f){const g=Bt(f,u),p={x:0,y:0},{scrollableAncestors:C}=r.current;for(const b of C){const m=t.code,{isTop:v,isRight:x,isLeft:R,isBottom:S,maxScroll:k,minScroll:A}=Fr(b),M=Qo(b),y={x:Math.min(m===P.Right?M.right-M.width/2:M.right,Math.max(m===P.Right?M.left:M.left+M.width/2,f.x)),y:Math.min(m===P.Down?M.bottom-M.height/2:M.bottom,Math.max(m===P.Down?M.top:M.top+M.height/2,f.y))},D=m===P.Right&&!x||m===P.Left&&!R,L=m===P.Down&&!S||m===P.Up&&!v;if(D&&y.x!==f.x){const B=b.scrollLeft+g.x,U=m===P.Right&&B<=k.x||m===P.Left&&B>=A.x;if(U&&!g.y){b.scrollTo({left:B,behavior:l});return}U?p.x=b.scrollLeft-B:p.x=m===P.Right?b.scrollLeft-k.x:b.scrollLeft-A.x,p.x&&b.scrollBy({left:-p.x,behavior:l});break}else if(L&&y.y!==f.y){const B=b.scrollTop+g.y,U=m===P.Down&&B<=k.y||m===P.Up&&B>=A.y;if(U&&!g.x){b.scrollTo({top:B,behavior:l});return}U?p.y=b.scrollTop-B:p.y=m===P.Down?b.scrollTop-k.y:b.scrollTop-A.y,p.y&&b.scrollBy({top:-p.y,behavior:l});break}}this.handleMove(t,rt(Bt(f,this.referenceCoordinates),p))}}}handleMove(t,n){const{onMove:r}=this.props;t.preventDefault(),r(n)}handleEnd(t){const{onEnd:n}=this.props;t.preventDefault(),this.detach(),n()}handleCancel(t){const{onCancel:n}=this.props;t.preventDefault(),this.detach(),n()}detach(){this.listeners.removeAll(),this.windowListeners.removeAll()}}qr.activators=[{eventName:"onKeyDown",handler:(e,t,n)=>{let{keyboardCodes:r=jr,onActivation:i}=t,{active:o}=n;const{code:a}=e.nativeEvent;if(r.start.includes(a)){const l=o.activatorNode.current;return l&&e.target!==l?!1:(e.preventDefault(),i?.({event:e.nativeEvent}),!0)}return!1}}];function er(e){return!!(e&&"distance"in e)}function tr(e){return!!(e&&"delay"in e)}class In{constructor(t,n,r){var i;r===void 0&&(r=na(t.event.target)),this.props=void 0,this.events=void 0,this.autoScrollEnabled=!0,this.document=void 0,this.activated=!1,this.initialCoordinates=void 0,this.timeoutId=null,this.listeners=void 0,this.documentListeners=void 0,this.windowListeners=void 0,this.props=t,this.events=n;const{event:o}=t,{target:a}=o;this.props=t,this.events=n,this.document=st(a),this.documentListeners=new bt(this.document),this.listeners=new bt(r),this.windowListeners=new bt(se(a)),this.initialCoordinates=(i=fn(o))!=null?i:xe,this.handleStart=this.handleStart.bind(this),this.handleMove=this.handleMove.bind(this),this.handleEnd=this.handleEnd.bind(this),this.handleCancel=this.handleCancel.bind(this),this.handleKeydown=this.handleKeydown.bind(this),this.removeTextSelection=this.removeTextSelection.bind(this),this.attach()}attach(){const{events:t,props:{options:{activationConstraint:n,bypassActivationConstraint:r}}}=this;if(this.listeners.add(t.move.name,this.handleMove,{passive:!1}),this.listeners.add(t.end.name,this.handleEnd),t.cancel&&this.listeners.add(t.cancel.name,this.handleCancel),this.windowListeners.add(me.Resize,this.handleCancel),this.windowListeners.add(me.DragStart,Zn),this.windowListeners.add(me.VisibilityChange,this.handleCancel),this.windowListeners.add(me.ContextMenu,Zn),this.documentListeners.add(me.Keydown,this.handleKeydown),n){if(r!=null&&r({event:this.props.event,activeNode:this.props.activeNode,options:this.props.options}))return this.handleStart();if(tr(n)){this.timeoutId=setTimeout(this.handleStart,n.delay),this.handlePending(n);return}if(er(n)){this.handlePending(n);return}}this.handleStart()}detach(){this.listeners.removeAll(),this.windowListeners.removeAll(),setTimeout(this.documentListeners.removeAll,50),this.timeoutId!==null&&(clearTimeout(this.timeoutId),this.timeoutId=null)}handlePending(t,n){const{active:r,onPending:i}=this.props;i(r,t,this.initialCoordinates,n)}handleStart(){const{initialCoordinates:t}=this,{onStart:n}=this.props;t&&(this.activated=!0,this.documentListeners.add(me.Click,ra,{capture:!0}),this.removeTextSelection(),this.documentListeners.add(me.SelectionChange,this.removeTextSelection),n(t))}handleMove(t){var n;const{activated:r,initialCoordinates:i,props:o}=this,{onMove:a,options:{activationConstraint:l}}=o;if(!i)return;const d=(n=fn(t))!=null?n:xe,h=Bt(i,d);if(!r&&l){if(er(l)){if(l.tolerance!=null&&Zt(h,l.tolerance))return this.handleCancel();if(Zt(h,l.distance))return this.handleStart()}if(tr(l)&&Zt(h,l.tolerance))return this.handleCancel();this.handlePending(l,h);return}t.cancelable&&t.preventDefault(),a(d)}handleEnd(){const{onAbort:t,onEnd:n}=this.props;this.detach(),this.activated||t(this.props.active),n()}handleCancel(){const{onAbort:t,onCancel:n}=this.props;this.detach(),this.activated||t(this.props.active),n()}handleKeydown(t){t.code===P.Esc&&this.handleCancel()}removeTextSelection(){var t;(t=this.document.getSelection())==null||t.removeAllRanges()}}const oa={cancel:{name:"pointercancel"},move:{name:"pointermove"},end:{name:"pointerup"}};class Wr extends In{constructor(t){const{event:n}=t,r=st(n.target);super(t,oa,r)}}Wr.activators=[{eventName:"onPointerDown",handler:(e,t)=>{let{nativeEvent:n}=e,{onActivation:r}=t;return!n.isPrimary||n.button!==0?!1:(r?.({event:n}),!0)}}];const aa={move:{name:"mousemove"},end:{name:"mouseup"}};var gn;(function(e){e[e.RightClick=2]="RightClick"})(gn||(gn={}));class Hr extends In{constructor(t){super(t,aa,st(t.event.target))}}Hr.activators=[{eventName:"onMouseDown",handler:(e,t)=>{let{nativeEvent:n}=e,{onActivation:r}=t;return n.button===gn.RightClick?!1:(r?.({event:n}),!0)}}];const en={cancel:{name:"touchcancel"},move:{name:"touchmove"},end:{name:"touchend"}};class Yr extends In{constructor(t){super(t,en)}static setup(){return window.addEventListener(en.move.name,t,{capture:!1,passive:!1}),function(){window.removeEventListener(en.move.name,t)};function t(){}}}Yr.activators=[{eventName:"onTouchStart",handler:(e,t)=>{let{nativeEvent:n}=e,{onActivation:r}=t;const{touches:i}=n;return i.length>1?!1:(r?.({event:n}),!0)}}];var vt;(function(e){e[e.Pointer=0]="Pointer",e[e.DraggableRect=1]="DraggableRect"})(vt||(vt={}));var $t;(function(e){e[e.TreeOrder=0]="TreeOrder",e[e.ReversedTreeOrder=1]="ReversedTreeOrder"})($t||($t={}));function sa(e){let{acceleration:t,activator:n=vt.Pointer,canScroll:r,draggingRect:i,enabled:o,interval:a=5,order:l=$t.TreeOrder,pointerCoordinates:d,scrollableAncestors:h,scrollableAncestorRects:u,delta:f,threshold:g}=e;const p=ca({delta:f,disabled:!o}),[C,b]=yo(),m=c.useRef({x:0,y:0}),v=c.useRef({x:0,y:0}),x=c.useMemo(()=>{switch(n){case vt.Pointer:return d?{top:d.y,bottom:d.y,left:d.x,right:d.x}:null;case vt.DraggableRect:return i}},[n,i,d]),R=c.useRef(null),S=c.useCallback(()=>{const A=R.current;if(!A)return;const M=m.current.x*v.current.x,y=m.current.y*v.current.y;A.scrollBy(M,y)},[]),k=c.useMemo(()=>l===$t.TreeOrder?[...h].reverse():h,[l,h]);c.useEffect(()=>{if(!o||!h.length||!x){b();return}for(const A of k){if(r?.(A)===!1)continue;const M=h.indexOf(A),y=u[M];if(!y)continue;const{direction:D,speed:L}=_o(A,y,x,t,g);for(const B of["x","y"])p[B][D[B]]||(L[B]=0,D[B]=0);if(L.x>0||L.y>0){b(),R.current=A,C(S,a),m.current=L,v.current=D;return}}m.current={x:0,y:0},v.current={x:0,y:0},b()},[t,S,r,b,o,a,JSON.stringify(x),JSON.stringify(p),C,h,k,u,JSON.stringify(g)])}const la={x:{[Q.Backward]:!1,[Q.Forward]:!1},y:{[Q.Backward]:!1,[Q.Forward]:!1}};function ca(e){let{delta:t,disabled:n}=e;const r=hn(t);return Ct(i=>{if(n||!r||!i)return la;const o={x:Math.sign(t.x-r.x),y:Math.sign(t.y-r.y)};return{x:{[Q.Backward]:i.x[Q.Backward]||o.x===-1,[Q.Forward]:i.x[Q.Forward]||o.x===1},y:{[Q.Backward]:i.y[Q.Backward]||o.y===-1,[Q.Forward]:i.y[Q.Forward]||o.y===1}}},[n,t,r])}function da(e,t){const n=t!=null?e.get(t):void 0,r=n?n.node.current:null;return Ct(i=>{var o;return t==null?null:(o=r??i)!=null?o:null},[r,t])}function ua(e,t){return c.useMemo(()=>e.reduce((n,r)=>{const{sensor:i}=r,o=i.activators.map(a=>({eventName:a.eventName,handler:t(a.handler,r)}));return[...n,...o]},[]),[e,t])}var Et;(function(e){e[e.Always=0]="Always",e[e.BeforeDragging=1]="BeforeDragging",e[e.WhileDragging=2]="WhileDragging"})(Et||(Et={}));var mn;(function(e){e.Optimized="optimized"})(mn||(mn={}));const nr=new Map;function ha(e,t){let{dragging:n,dependencies:r,config:i}=t;const[o,a]=c.useState(null),{frequency:l,measure:d,strategy:h}=i,u=c.useRef(e),f=m(),g=xt(f),p=c.useCallback(function(v){v===void 0&&(v=[]),!g.current&&a(x=>x===null?v:x.concat(v.filter(R=>!x.includes(R))))},[g]),C=c.useRef(null),b=Ct(v=>{if(f&&!n)return nr;if(!v||v===nr||u.current!==e||o!=null){const x=new Map;for(let R of e){if(!R)continue;if(o&&o.length>0&&!o.includes(R.id)&&R.rect.current){x.set(R.id,R.rect.current);continue}const S=R.node.current,k=S?new An(d(S),S):null;R.rect.current=k,k&&x.set(R.id,k)}return x}return v},[e,o,n,f,d]);return c.useEffect(()=>{u.current=e},[e]),c.useEffect(()=>{f||p()},[n,f]),c.useEffect(()=>{o&&o.length>0&&a(null)},[JSON.stringify(o)]),c.useEffect(()=>{f||typeof l!="number"||C.current!==null||(C.current=setTimeout(()=>{p(),C.current=null},l))},[l,f,p,...r]),{droppableRects:b,measureDroppableContainers:p,measuringScheduled:o!=null};function m(){switch(h){case Et.Always:return!1;case Et.BeforeDragging:return n;default:return!n}}}function Vr(e,t){return Ct(n=>e?n||(typeof t=="function"?t(e):e):null,[t,e])}function fa(e,t){return Vr(e,t)}function pa(e){let{callback:t,disabled:n}=e;const r=Cn(t),i=c.useMemo(()=>{if(n||typeof window>"u"||typeof window.MutationObserver>"u")return;const{MutationObserver:o}=window;return new o(r)},[r,n]);return c.useEffect(()=>()=>i?.disconnect(),[i]),i}function qt(e){let{callback:t,disabled:n}=e;const r=Cn(t),i=c.useMemo(()=>{if(n||typeof window>"u"||typeof window.ResizeObserver>"u")return;const{ResizeObserver:o}=window;return new o(r)},[n]);return c.useEffect(()=>()=>i?.disconnect(),[i]),i}function ga(e){return new An(lt(e),e)}function rr(e,t,n){t===void 0&&(t=ga);const[r,i]=c.useState(null);function o(){i(d=>{if(!e)return null;if(e.isConnected===!1){var h;return(h=d??n)!=null?h:null}const u=t(e);return JSON.stringify(d)===JSON.stringify(u)?d:u})}const a=pa({callback(d){if(e)for(const h of d){const{type:u,target:f}=h;if(u==="childList"&&f instanceof HTMLElement&&f.contains(e)){o();break}}}}),l=qt({callback:o});return De(()=>{o(),e?(l?.observe(e),a?.observe(document.body,{childList:!0,subtree:!0})):(l?.disconnect(),a?.disconnect())},[e]),r}function ma(e){const t=Vr(e);return Or(e,t)}const ir=[];function ba(e){const t=c.useRef(e),n=Ct(r=>e?r&&r!==ir&&e&&t.current&&e.parentNode===t.current.parentNode?r:Rn(e):ir,[e]);return c.useEffect(()=>{t.current=e},[e]),n}function va(e){const[t,n]=c.useState(null),r=c.useRef(e),i=c.useCallback(o=>{const a=Jt(o.target);a&&n(l=>l?(l.set(a,pn(a)),new Map(l)):null)},[]);return c.useEffect(()=>{const o=r.current;if(e!==o){a(o);const l=e.map(d=>{const h=Jt(d);return h?(h.addEventListener("scroll",i,{passive:!0}),[h,pn(h)]):null}).filter(d=>d!=null);n(l.length?new Map(l):null),r.current=e}return()=>{a(e),a(o)};function a(l){l.forEach(d=>{const h=Jt(d);h?.removeEventListener("scroll",i)})}},[i,e]),c.useMemo(()=>e.length?t?Array.from(t.values()).reduce((o,a)=>rt(o,a),xe):Ur(e):xe,[e,t])}function or(e,t){t===void 0&&(t=[]);const n=c.useRef(null);return c.useEffect(()=>{n.current=null},t),c.useEffect(()=>{const r=e!==xe;r&&!n.current&&(n.current=e),!r&&n.current&&(n.current=null)},[e]),n.current?Bt(e,n.current):xe}function ya(e){c.useEffect(()=>{if(!jt)return;const t=e.map(n=>{let{sensor:r}=n;return r.setup==null?void 0:r.setup()});return()=>{for(const n of t)n?.()}},e.map(t=>{let{sensor:n}=t;return n}))}function wa(e,t){return c.useMemo(()=>e.reduce((n,r)=>{let{eventName:i,handler:o}=r;return n[i]=a=>{o(a,t)},n},{}),[e,t])}function Gr(e){return c.useMemo(()=>e?Vo(e):null,[e])}const ar=[];function xa(e,t){t===void 0&&(t=lt);const[n]=e,r=Gr(n?se(n):null),[i,o]=c.useState(ar);function a(){o(()=>e.length?e.map(d=>$r(d)?r:new An(t(d),d)):ar)}const l=qt({callback:a});return De(()=>{l?.disconnect(),a(),e.forEach(d=>l?.observe(d))},[e]),i}function Ea(e){if(!e)return null;if(e.children.length>1)return e;const t=e.children[0];return St(t)?t:e}function Ta(e){let{measure:t}=e;const[n,r]=c.useState(null),i=c.useCallback(h=>{for(const{target:u}of h)if(St(u)){r(f=>{const g=t(u);return f?{...f,width:g.width,height:g.height}:g});break}},[t]),o=qt({callback:i}),a=c.useCallback(h=>{const u=Ea(h);o?.disconnect(),u&&o?.observe(u),r(u?t(u):null)},[t,o]),[l,d]=Ot(a);return c.useMemo(()=>({nodeRef:l,rect:n,setRef:d}),[n,l,d])}const Sa=[{sensor:Wr,options:{}},{sensor:qr,options:{}}],Ca={current:{}},Mt={draggable:{measure:Jn},droppable:{measure:Jn,strategy:Et.WhileDragging,frequency:mn.Optimized},dragOverlay:{measure:lt}};class yt extends Map{get(t){var n;return t!=null&&(n=super.get(t))!=null?n:void 0}toArray(){return Array.from(this.values())}getEnabled(){return this.toArray().filter(t=>{let{disabled:n}=t;return!n})}getNodeFor(t){var n,r;return(n=(r=this.get(t))==null?void 0:r.node.current)!=null?n:void 0}}const Da={activatorEvent:null,active:null,activeNode:null,activeNodeRect:null,collisions:null,containerNodeRect:null,draggableNodes:new Map,droppableRects:new Map,droppableContainers:new yt,over:null,dragOverlay:{nodeRef:{current:null},rect:null,setRef:Pt},scrollableAncestors:[],scrollableAncestorRects:[],measuringConfiguration:Mt,measureDroppableContainers:Pt,windowRect:null,measuringScheduled:!1},Ra={activatorEvent:null,activators:[],active:null,activeNodeRect:null,ariaDescribedById:{draggable:""},dispatch:Pt,draggableNodes:new Map,over:null,measureDroppableContainers:Pt},Wt=c.createContext(Ra),Xr=c.createContext(Da);function Aa(){return{draggable:{active:null,initialCoordinates:{x:0,y:0},nodes:new Map,translate:{x:0,y:0}},droppable:{containers:new yt}}}function Ia(e,t){switch(t.type){case H.DragStart:return{...e,draggable:{...e.draggable,initialCoordinates:t.initialCoordinates,active:t.active}};case H.DragMove:return e.draggable.active==null?e:{...e,draggable:{...e.draggable,translate:{x:t.coordinates.x-e.draggable.initialCoordinates.x,y:t.coordinates.y-e.draggable.initialCoordinates.y}}};case H.DragEnd:case H.DragCancel:return{...e,draggable:{...e.draggable,active:null,initialCoordinates:{x:0,y:0},translate:{x:0,y:0}}};case H.RegisterDroppable:{const{element:n}=t,{id:r}=n,i=new yt(e.droppable.containers);return i.set(r,n),{...e,droppable:{...e.droppable,containers:i}}}case H.SetDroppableDisabled:{const{id:n,key:r,disabled:i}=t,o=e.droppable.containers.get(n);if(!o||r!==o.key)return e;const a=new yt(e.droppable.containers);return a.set(n,{...o,disabled:i}),{...e,droppable:{...e.droppable,containers:a}}}case H.UnregisterDroppable:{const{id:n,key:r}=t,i=e.droppable.containers.get(n);if(!i||r!==i.key)return e;const o=new yt(e.droppable.containers);return o.delete(n),{...e,droppable:{...e.droppable,containers:o}}}default:return e}}function Na(e){let{disabled:t}=e;const{active:n,activatorEvent:r,draggableNodes:i}=c.useContext(Wt),o=hn(r),a=hn(n?.id);return c.useEffect(()=>{if(!t&&!r&&o&&a!=null){if(!Dn(o)||document.activeElement===o.target)return;const l=i.get(a);if(!l)return;const{activatorNode:d,node:h}=l;if(!d.current&&!h.current)return;requestAnimationFrame(()=>{for(const u of[d.current,h.current]){if(!u)continue;const f=Eo(u);if(f){f.focus();break}}})}},[r,t,i,a,o]),null}function ka(e,t){let{transform:n,...r}=t;return e!=null&&e.length?e.reduce((i,o)=>o({transform:i,...r}),n):n}function La(e){return c.useMemo(()=>({draggable:{...Mt.draggable,...e?.draggable},droppable:{...Mt.droppable,...e?.droppable},dragOverlay:{...Mt.dragOverlay,...e?.dragOverlay}}),[e?.draggable,e?.droppable,e?.dragOverlay])}function Ma(e){let{activeNode:t,measure:n,initialRect:r,config:i=!0}=e;const o=c.useRef(!1),{x:a,y:l}=typeof i=="boolean"?{x:i,y:i}:i;De(()=>{if(!a&&!l||!t){o.current=!1;return}if(o.current||!r)return;const h=t?.node.current;if(!h||h.isConnected===!1)return;const u=n(h),f=Or(u,r);if(a||(f.x=0),l||(f.y=0),o.current=!0,Math.abs(f.x)>0||Math.abs(f.y)>0){const g=Br(h);g&&g.scrollBy({top:f.y,left:f.x})}},[t,a,l,r,n])}const Kr=c.createContext({...xe,scaleX:1,scaleY:1});var Ue;(function(e){e[e.Uninitialized=0]="Uninitialized",e[e.Initializing=1]="Initializing",e[e.Initialized=2]="Initialized"})(Ue||(Ue={}));const Oa=c.memo(function(t){var n,r,i,o;let{id:a,accessibility:l,autoScroll:d=!0,children:h,sensors:u=Sa,collisionDetection:f=Fo,measuring:g,modifiers:p,...C}=t;const b=c.useReducer(Ia,void 0,Aa),[m,v]=b,[x,R]=Ao(),[S,k]=c.useState(Ue.Uninitialized),A=S===Ue.Initialized,{draggable:{active:M,nodes:y,translate:D},droppable:{containers:L}}=m,B=M!=null?y.get(M):null,U=c.useRef({initial:null,translated:null}),q=c.useMemo(()=>{var ne;return M!=null?{id:M,data:(ne=B?.data)!=null?ne:Ca,rect:U}:null},[M,B]),te=c.useRef(null),[F,fe]=c.useState(null),[G,ie]=c.useState(null),le=xt(C,Object.values(C)),ye=Dt("DndDescribedBy",a),Ee=c.useMemo(()=>L.getEnabled(),[L]),X=La(g),{droppableRects:K,measureDroppableContainers:j,measuringScheduled:oe}=ha(Ee,{dragging:A,dependencies:[D.x,D.y],config:X.droppable}),_=da(y,M),Me=c.useMemo(()=>G?fn(G):null,[G]),ae=wi(),T=fa(_,X.draggable.measure);Ma({activeNode:M!=null?y.get(M):null,config:ae.layoutShiftCompensation,initialRect:T,measure:X.draggable.measure});const I=rr(_,X.draggable.measure,T),pe=rr(_?_.parentElement:null),W=c.useRef({activatorEvent:null,active:null,activeNode:_,collisionRect:null,collisions:null,droppableRects:K,draggableNodes:y,draggingNode:null,draggingNodeRect:null,droppableContainers:L,over:null,scrollableAncestors:[],scrollAdjustedTranslate:null}),re=L.getNodeFor((n=W.current.over)==null?void 0:n.id),ce=Ta({measure:X.dragOverlay.measure}),Ae=(r=ce.nodeRef.current)!=null?r:_,Oe=A?(i=ce.rect)!=null?i:I:null,On=!!(ce.nodeRef.current&&ce.rect),Bn=ma(On?null:I),Vt=Gr(Ae?se(Ae):null),Be=ba(A?re??_:null),Rt=xa(Be),At=ka(p,{transform:{x:D.x-Bn.x,y:D.y-Bn.y,scaleX:1,scaleY:1},activatorEvent:G,active:q,activeNodeRect:I,containerNodeRect:pe,draggingNodeRect:Oe,over:W.current.over,overlayNodeRect:ce.rect,scrollableAncestors:Be,scrollableAncestorRects:Rt,windowRect:Vt}),zn=Me?rt(Me,D):null,Pn=va(Be),fi=or(Pn),pi=or(Pn,[I]),Ve=rt(At,fi),Ge=Oe?qo(Oe,At):null,ct=q&&Ge?f({active:q,collisionRect:Ge,droppableRects:K,droppableContainers:Ee,pointerCoordinates:zn}):null,$n=zo(ct,"id"),[ze,Fn]=c.useState(null),gi=On?At:rt(At,pi),mi=Uo(gi,(o=ze?.rect)!=null?o:null,I),Gt=c.useRef(null),Un=c.useCallback((ne,de)=>{let{sensor:ue,options:Pe}=de;if(te.current==null)return;const ge=y.get(te.current);if(!ge)return;const he=ne.nativeEvent,Te=new ue({active:te.current,activeNode:ge,event:he,options:Pe,context:W,onAbort(Z){if(!y.get(Z))return;const{onDragAbort:Se}=le.current,Ie={id:Z};Se?.(Ie),x({type:"onDragAbort",event:Ie})},onPending(Z,$e,Se,Ie){if(!y.get(Z))return;const{onDragPending:ut}=le.current,Fe={id:Z,constraint:$e,initialCoordinates:Se,offset:Ie};ut?.(Fe),x({type:"onDragPending",event:Fe})},onStart(Z){const $e=te.current;if($e==null)return;const Se=y.get($e);if(!Se)return;const{onDragStart:Ie}=le.current,dt={activatorEvent:he,active:{id:$e,data:Se.data,rect:U}};gt.unstable_batchedUpdates(()=>{Ie?.(dt),k(Ue.Initializing),v({type:H.DragStart,initialCoordinates:Z,active:$e}),x({type:"onDragStart",event:dt}),fe(Gt.current),ie(he)})},onMove(Z){v({type:H.DragMove,coordinates:Z})},onEnd:Xe(H.DragEnd),onCancel:Xe(H.DragCancel)});Gt.current=Te;function Xe(Z){return async function(){const{active:Se,collisions:Ie,over:dt,scrollAdjustedTranslate:ut}=W.current;let Fe=null;if(Se&&ut){const{cancelDrop:ht}=le.current;Fe={activatorEvent:he,active:Se,collisions:Ie,delta:ut,over:dt},Z===H.DragEnd&&typeof ht=="function"&&await Promise.resolve(ht(Fe))&&(Z=H.DragCancel)}te.current=null,gt.unstable_batchedUpdates(()=>{v({type:Z}),k(Ue.Uninitialized),Fn(null),fe(null),ie(null),Gt.current=null;const ht=Z===H.DragEnd?"onDragEnd":"onDragCancel";if(Fe){const Xt=le.current[ht];Xt?.(Fe),x({type:ht,event:Fe})}})}}},[y]),bi=c.useCallback((ne,de)=>(ue,Pe)=>{const ge=ue.nativeEvent,he=y.get(Pe);if(te.current!==null||!he||ge.dndKit||ge.defaultPrevented)return;const Te={active:he};ne(ue,de.options,Te)===!0&&(ge.dndKit={capturedBy:de.sensor},te.current=Pe,Un(ue,de))},[y,Un]),jn=ua(u,bi);ya(u),De(()=>{I&&S===Ue.Initializing&&k(Ue.Initialized)},[I,S]),c.useEffect(()=>{const{onDragMove:ne}=le.current,{active:de,activatorEvent:ue,collisions:Pe,over:ge}=W.current;if(!de||!ue)return;const he={active:de,activatorEvent:ue,collisions:Pe,delta:{x:Ve.x,y:Ve.y},over:ge};gt.unstable_batchedUpdates(()=>{ne?.(he),x({type:"onDragMove",event:he})})},[Ve.x,Ve.y]),c.useEffect(()=>{const{active:ne,activatorEvent:de,collisions:ue,droppableContainers:Pe,scrollAdjustedTranslate:ge}=W.current;if(!ne||te.current==null||!de||!ge)return;const{onDragOver:he}=le.current,Te=Pe.get($n),Xe=Te&&Te.rect.current?{id:Te.id,rect:Te.rect.current,data:Te.data,disabled:Te.disabled}:null,Z={active:ne,activatorEvent:de,collisions:ue,delta:{x:ge.x,y:ge.y},over:Xe};gt.unstable_batchedUpdates(()=>{Fn(Xe),he?.(Z),x({type:"onDragOver",event:Z})})},[$n]),De(()=>{W.current={activatorEvent:G,active:q,activeNode:_,collisionRect:Ge,collisions:ct,droppableRects:K,draggableNodes:y,draggingNode:Ae,draggingNodeRect:Oe,droppableContainers:L,over:ze,scrollableAncestors:Be,scrollAdjustedTranslate:Ve},U.current={initial:Oe,translated:Ge}},[q,_,ct,Ge,y,Ae,Oe,K,L,ze,Be,Ve]),sa({...ae,delta:D,draggingRect:Ge,pointerCoordinates:zn,scrollableAncestors:Be,scrollableAncestorRects:Rt});const vi=c.useMemo(()=>({active:q,activeNode:_,activeNodeRect:I,activatorEvent:G,collisions:ct,containerNodeRect:pe,dragOverlay:ce,draggableNodes:y,droppableContainers:L,droppableRects:K,over:ze,measureDroppableContainers:j,scrollableAncestors:Be,scrollableAncestorRects:Rt,measuringConfiguration:X,measuringScheduled:oe,windowRect:Vt}),[q,_,I,G,ct,pe,ce,y,L,K,ze,j,Be,Rt,X,oe,Vt]),yi=c.useMemo(()=>({activatorEvent:G,activators:jn,active:q,activeNodeRect:I,ariaDescribedById:{draggable:ye},dispatch:v,draggableNodes:y,over:ze,measureDroppableContainers:j}),[G,jn,q,I,v,ye,y,ze,j]);return J.createElement(Mr.Provider,{value:R},J.createElement(Wt.Provider,{value:yi},J.createElement(Xr.Provider,{value:vi},J.createElement(Kr.Provider,{value:mi},h)),J.createElement(Na,{disabled:l?.restoreFocus===!1})),J.createElement(ko,{...l,hiddenTextDescribedById:ye}));function wi(){const ne=F?.autoScrollEnabled===!1,de=typeof d=="object"?d.enabled===!1:d===!1,ue=A&&!ne&&!de;return typeof d=="object"?{...d,enabled:ue}:{enabled:ue}}}),Ba=c.createContext(null),sr="button",za="Draggable";function Pa(e){let{id:t,data:n,disabled:r=!1,attributes:i}=e;const o=Dt(za),{activators:a,activatorEvent:l,active:d,activeNodeRect:h,ariaDescribedById:u,draggableNodes:f,over:g}=c.useContext(Wt),{role:p=sr,roleDescription:C="draggable",tabIndex:b=0}=i??{},m=d?.id===t,v=c.useContext(m?Kr:Ba),[x,R]=Ot(),[S,k]=Ot(),A=wa(a,t),M=xt(n);De(()=>(f.set(t,{id:t,key:o,node:x,activatorNode:S,data:M}),()=>{const D=f.get(t);D&&D.key===o&&f.delete(t)}),[f,t]);const y=c.useMemo(()=>({role:p,tabIndex:b,"aria-disabled":r,"aria-pressed":m&&p===sr?!0:void 0,"aria-roledescription":C,"aria-describedby":u.draggable}),[r,p,b,m,C,u.draggable]);return{active:d,activatorEvent:l,activeNodeRect:h,attributes:y,isDragging:m,listeners:r?void 0:A,node:x,over:g,setNodeRef:R,setActivatorNodeRef:k,transform:v}}function $a(){return c.useContext(Xr)}const Fa="Droppable",Ua={timeout:25};function ja(e){let{data:t,disabled:n=!1,id:r,resizeObserverConfig:i}=e;const o=Dt(Fa),{active:a,dispatch:l,over:d,measureDroppableContainers:h}=c.useContext(Wt),u=c.useRef({disabled:n}),f=c.useRef(!1),g=c.useRef(null),p=c.useRef(null),{disabled:C,updateMeasurementsFor:b,timeout:m}={...Ua,...i},v=xt(b??r),x=c.useCallback(()=>{if(!f.current){f.current=!0;return}p.current!=null&&clearTimeout(p.current),p.current=setTimeout(()=>{h(Array.isArray(v.current)?v.current:[v.current]),p.current=null},m)},[m]),R=qt({callback:x,disabled:C||!a}),S=c.useCallback((y,D)=>{R&&(D&&(R.unobserve(D),f.current=!1),y&&R.observe(y))},[R]),[k,A]=Ot(S),M=xt(t);return c.useEffect(()=>{!R||!k.current||(R.disconnect(),f.current=!1,R.observe(k.current))},[k,R]),c.useEffect(()=>(l({type:H.RegisterDroppable,element:{id:r,key:o,disabled:n,node:k,rect:g,data:M}}),()=>l({type:H.UnregisterDroppable,key:o,id:r})),[r]),c.useEffect(()=>{n!==u.current.disabled&&(l({type:H.SetDroppableDisabled,id:r,key:o,disabled:n}),u.current.disabled=n)},[r,o,n,l]),{active:a,rect:g,isOver:d?.id===r,node:k,over:d,setNodeRef:A}}const qa=e=>{let{transform:t}=e;return{...t,y:0}};function Wa(e,t,n){const r={...e};return t.top+e.y<=n.top?r.y=n.top-t.top:t.bottom+e.y>=n.top+n.height&&(r.y=n.top+n.height-t.bottom),t.left+e.x<=n.left?r.x=n.left-t.left:t.right+e.x>=n.left+n.width&&(r.x=n.left+n.width-t.right),r}const Ha=e=>{let{containerNodeRect:t,draggingNodeRect:n,transform:r}=e;return!n||!t?r:Wa(r,n,t)};function Nn(e,t,n){const r=e.slice();return r.splice(n<0?r.length+n:n,0,r.splice(t,1)[0]),r}function Ya(e,t){return e.reduce((n,r,i)=>{const o=t.get(r);return o&&(n[i]=o),n},Array(e.length))}function It(e){return e!==null&&e>=0}function Va(e,t){if(e===t)return!0;if(e.length!==t.length)return!1;for(let n=0;n<e.length;n++)if(e[n]!==t[n])return!1;return!0}function Ga(e){return typeof e=="boolean"?{draggable:e,droppable:e}:e}const Nt={scaleX:1,scaleY:1},Xa=e=>{var t;let{rects:n,activeNodeRect:r,activeIndex:i,overIndex:o,index:a}=e;const l=(t=n[i])!=null?t:r;if(!l)return null;const d=Ka(n,a,i);if(a===i){const h=n[o];return h?{x:i<o?h.left+h.width-(l.left+l.width):h.left-l.left,y:0,...Nt}:null}return a>i&&a<=o?{x:-l.width-d,y:0,...Nt}:a<i&&a>=o?{x:l.width+d,y:0,...Nt}:{x:0,y:0,...Nt}};function Ka(e,t,n){const r=e[t],i=e[t-1],o=e[t+1];return!r||!i&&!o?0:n<t?i?r.left-(i.left+i.width):o.left-(r.left+r.width):o?o.left-(r.left+r.width):r.left-(i.left+i.width)}const _r=e=>{let{rects:t,activeIndex:n,overIndex:r,index:i}=e;const o=Nn(t,r,n),a=t[i],l=o[i];return!l||!a?null:{x:l.left-a.left,y:l.top-a.top,scaleX:l.width/a.width,scaleY:l.height/a.height}},Qr="Sortable",Jr=J.createContext({activeIndex:-1,containerId:Qr,disableTransforms:!1,items:[],overIndex:-1,useDragOverlay:!1,sortedRects:[],strategy:_r,disabled:{draggable:!1,droppable:!1}});function _a(e){let{children:t,id:n,items:r,strategy:i=_r,disabled:o=!1}=e;const{active:a,dragOverlay:l,droppableRects:d,over:h,measureDroppableContainers:u}=$a(),f=Dt(Qr,n),g=l.rect!==null,p=c.useMemo(()=>r.map(A=>typeof A=="object"&&"id"in A?A.id:A),[r]),C=a!=null,b=a?p.indexOf(a.id):-1,m=h?p.indexOf(h.id):-1,v=c.useRef(p),x=!Va(p,v.current),R=m!==-1&&b===-1||x,S=Ga(o);De(()=>{x&&C&&u(p)},[x,p,C,u]),c.useEffect(()=>{v.current=p},[p]);const k=c.useMemo(()=>({activeIndex:b,containerId:f,disabled:S,disableTransforms:R,items:p,overIndex:m,useDragOverlay:g,sortedRects:Ya(p,d),strategy:i}),[b,f,S.draggable,S.droppable,R,p,m,d,g,i]);return J.createElement(Jr.Provider,{value:k},t)}const Qa=e=>{let{id:t,items:n,activeIndex:r,overIndex:i}=e;return Nn(n,r,i).indexOf(t)},Ja=e=>{let{containerId:t,isSorting:n,wasDragging:r,index:i,items:o,newIndex:a,previousItems:l,previousContainerId:d,transition:h}=e;return!h||!r||l!==o&&i===a?!1:n?!0:a!==i&&t===d},Za={duration:200,easing:"ease"},Zr="transform",es=zt.Transition.toString({property:Zr,duration:0,easing:"linear"}),ts={roleDescription:"sortable"};function ns(e){let{disabled:t,index:n,node:r,rect:i}=e;const[o,a]=c.useState(null),l=c.useRef(n);return De(()=>{if(!t&&n!==l.current&&r.current){const d=i.current;if(d){const h=lt(r.current,{ignoreTransform:!0}),u={x:d.left-h.left,y:d.top-h.top,scaleX:d.width/h.width,scaleY:d.height/h.height};(u.x||u.y)&&a(u)}}n!==l.current&&(l.current=n)},[t,n,r,i]),c.useEffect(()=>{o&&a(null)},[o]),o}function rs(e){let{animateLayoutChanges:t=Ja,attributes:n,disabled:r,data:i,getNewIndex:o=Qa,id:a,strategy:l,resizeObserverConfig:d,transition:h=Za}=e;const{items:u,containerId:f,activeIndex:g,disabled:p,disableTransforms:C,sortedRects:b,overIndex:m,useDragOverlay:v,strategy:x}=c.useContext(Jr),R=is(r,p),S=u.indexOf(a),k=c.useMemo(()=>({sortable:{containerId:f,index:S,items:u},...i}),[f,i,S,u]),A=c.useMemo(()=>u.slice(u.indexOf(a)),[u,a]),{rect:M,node:y,isOver:D,setNodeRef:L}=ja({id:a,data:k,disabled:R.droppable,resizeObserverConfig:{updateMeasurementsFor:A,...d}}),{active:B,activatorEvent:U,activeNodeRect:q,attributes:te,setNodeRef:F,listeners:fe,isDragging:G,over:ie,setActivatorNodeRef:le,transform:ye}=Pa({id:a,data:k,attributes:{...ts,...n},disabled:R.draggable}),Ee=vo(L,F),X=!!B,K=X&&!C&&It(g)&&It(m),j=!v&&G,oe=j&&K?ye:null,Me=K?oe??(l??x)({rects:b,activeNodeRect:q,activeIndex:g,overIndex:m,index:S}):null,ae=It(g)&&It(m)?o({id:a,items:u,activeIndex:g,overIndex:m}):S,T=B?.id,I=c.useRef({activeId:T,items:u,newIndex:ae,containerId:f}),pe=u!==I.current.items,W=t({active:B,containerId:f,isDragging:G,isSorting:X,id:a,index:S,items:u,newIndex:I.current.newIndex,previousItems:I.current.items,previousContainerId:I.current.containerId,transition:h,wasDragging:I.current.activeId!=null}),re=ns({disabled:!W,index:S,node:y,rect:M});return c.useEffect(()=>{X&&I.current.newIndex!==ae&&(I.current.newIndex=ae),f!==I.current.containerId&&(I.current.containerId=f),u!==I.current.items&&(I.current.items=u)},[X,ae,f,u]),c.useEffect(()=>{if(T===I.current.activeId)return;if(T!=null&&I.current.activeId==null){I.current.activeId=T;return}const Ae=setTimeout(()=>{I.current.activeId=T},50);return()=>clearTimeout(Ae)},[T]),{active:B,activeIndex:g,attributes:te,data:k,rect:M,index:S,newIndex:ae,items:u,isOver:D,isSorting:X,isDragging:G,listeners:fe,node:y,overIndex:m,over:ie,setNodeRef:Ee,setActivatorNodeRef:le,setDroppableNodeRef:L,setDraggableNodeRef:F,transform:re??Me,transition:ce()};function ce(){if(re||pe&&I.current.newIndex===S)return es;if(!(j&&!Dn(U)||!h)&&(X||W))return zt.Transition.toString({...h,property:Zr})}}function is(e,t){var n,r;return typeof e=="boolean"?{draggable:e,droppable:!1}:{draggable:(n=e?.draggable)!=null?n:t.draggable,droppable:(r=e?.droppable)!=null?r:t.droppable}}P.Down,P.Right,P.Up,P.Left;const os=E(N)`
    width: 150px;
    height: 32px;
    background-color: ${({theme:e})=>e.colors.Background.Section.default};
    border-radius: 6px;
    padding: 3px 10px;
    flex-shrink: 0;
`;function as({year:e,semester:t,setYear:n,setSemester:r,setCurrentTimetableId:i}){const o=qe(),{query:a}=Y("GET","/semesters");c.useEffect(()=>{const f=a.data?.semesters;if(f&&f.length>0){const g=f[f.length-1];g&&(n(g.year),r(g.semester))}},[a.data]);const{isFirstSemester:l,isLastSemester:d}=c.useMemo(()=>{if(!a.data)return{isFirstSemester:!1,isLastSemester:!1};const f=a.data.semesters,g=f[0],p=f[f.length-1];return!g||!p?{isFirstSemester:!0,isLastSemester:!0}:{isFirstSemester:e===g.year&&t===g.semester,isLastSemester:e===p.year&&t===p.semester}},[a.data,e,t]),h=()=>{l||(t===Ke.SPRING?(r(Ke.FALL),n(e-1)):r(Ke.SPRING),i(null))},u=()=>{d||(t===Ke.FALL?(r(Ke.SPRING),n(e+1)):r(Ke.FALL),i(null))};return w(os,{direction:"row",gap:0,justify:"space-between",align:"center",children:[s(it,{onClick:l?void 0:h,styles:{padding:2.5},children:s(V,{size:20,color:l?o.colors.Text.disable:o.colors.Highlight.default,onClick:l?void 0:()=>{},children:s(zi,{})})}),s(O,{color:"Highlight.default",children:e}),s(O,{color:"Highlight.default",children:dn(t)}),s(it,{onClick:d?void 0:u,styles:{padding:2.5},children:s(V,{size:20,color:d?o.colors.Text.disable:o.colors.Highlight.default,onClick:d?void 0:()=>{},children:s(Pi,{})})})]})}const ei=E.div`
    display: inline-flex;
    padding: 5px 12px;
    justify-content: center;
    align-items: center;
    border-top-right-radius: 12px;
    border-top-left-radius: 12px;
    font-size: 14px;
    line-height: 17.5px;
    font-weight: 400;
`,ss=E(ei)`
    color: ${({theme:e})=>e.colors.Text.lighter};
    background-color: ${({theme:e})=>e.colors.Background.Tab.dark};
    cursor: pointer;

    &:hover {
        background-color: ${({theme:e})=>e.colors.Background.Tab.darker};
    }
`,ls=E(ei)`
    color: ${({theme:e})=>e.colors.Highlight.default};
    background-color: ${({theme:e})=>e.colors.Background.Tab.default};
    cursor: pointer;
`,cs={default:ss,selected:ls},ds=E.div`
    width: 100%;
    height: 100%;
    justify-content: center;
    align-items: center;
    gap: 6px;
    display: inline-flex;
    white-space: nowrap;
`,us=e=>s(ds,{children:e}),bn=({type:e="default",children:t=void 0,buttonRef:n,...r})=>{const i=cs[e],o=()=>us(t);return s(i,{ref:n,...r,onClick:r.onClick,children:s(o,{})})},hs=E(N)`
    width: 100%;
    max-width: 897px;

    ${$.laptop} {
        max-width: 572px;
    }

    ${$.tablet} {
        max-width: 100%;
    }
`,fs=E(N)`
    overflow-x: auto;
    scrollbar-width: none;

    &::-webkit-scrollbar {
        display: none;
    }
`,ps=E(O)`
    outline: none;
    user-select: none;
`,gs=({timetable:e,isSelected:t,onClick:n,onCopy:r,onDelete:i,onNameChange:o,isDragging:a})=>{const l=qe(),{attributes:d,listeners:h,setNodeRef:u,transform:f,transition:g}=rs({id:e.id}),C={transform:(b=>{if(!b)return"";const{x:m,y:v}=b;return`translate3d(${m}px, ${v}px, 0)`})(f),transition:g,touchAction:"manipulation",opacity:a?.5:1};return s("div",{ref:u,style:C,...d,...h,children:w(bn,{type:t?"selected":"default",onClick:n,children:[s(ps,{onClick:b=>{t&&(b.stopPropagation(),b.currentTarget.contentEditable="true",b.currentTarget.focus())},onBlur:b=>{const m=b.currentTarget.textContent||"";b.currentTarget.contentEditable="false",o(e.id,m)},onKeyDown:b=>{b.key==="Enter"&&(b.preventDefault(),b.currentTarget.blur())},contentEditable:!1,suppressContentEditableWarning:!0,type:"Normal",color:t?"Highlight.default":"Text.lighter",style:{paddingTop:4,paddingBottom:3.5},children:e.name?e.name:"No Title"}),w(N,{direction:"row",gap:0,align:"center",children:[t&&s(it,{onClick:r,styles:{padding:5},children:s(V,{size:15,onClick:()=>{},color:t?l.colors.Highlight.default:l.colors.Text.lighter,children:s(En,{})})}),s(it,{onClick:i,styles:{padding:3.75},children:s(V,{size:17.5,onClick:()=>{},color:t?l.colors.Highlight.default:l.colors.Text.lighter,children:s(cn,{})})})]})]})})},lr=({timeTableLectures:e,currentTimetableId:t,setCurrentTimetableId:n,setCurrentTimetableName:r,year:i,semester:o,setYear:a,setSemester:l})=>{const{t:d}=Re(),{status:h}=ot(),u=qe(),{query:f,setParams:g}=Y("GET","/timetables"),{requestFunction:p}=Y("POST","/timetables",{onSuccess:y=>{f.refetch(),n(y.id)}}),{requestFunction:C}=Y("DELETE","/timetables",{onMutate:y=>{t===y.id&&n(null)},onSuccess:()=>{f.refetch()}}),{requestFunction:b}=Y("PATCH","/timetables",{onSuccess:()=>{f.refetch()}}),[m,v]=c.useState([]),[x,R]=c.useState(null),S=Lo(_n(Hr,{activationConstraint:{distance:8}}),_n(Yr,{activationConstraint:{delay:500,tolerance:5}}));c.useEffect(()=>{let y=f.data?.timetables??[];y=y.filter(D=>D.year===i&&D.semester===o),v(y.slice().sort((D,L)=>D.timeTableOrder-L.timeTableOrder)),t!=null&&f.data?.timetables.forEach(D=>{D.id===t&&r(D.name)})},[f.data,i,o]),c.useEffect(()=>{h==="success"&&i!==-1&&o>0&&g({year:i,semester:o})},[i,o,h]),c.useEffect(()=>{r(t==null?d("timetable.myTimetable"):m.find(y=>y.id===t)?.name||"")},[t]);const k=y=>{R(y.active.id)},A=y=>{const{active:D,over:L}=y;if(R(null),L&&D.id!==L.id){const B=m.findIndex(F=>F.id===D.id),U=m.findIndex(F=>F.id===L.id),q=Nn(m,B,U);v(q);const te=D.id;b({id:te,order:U})}},M=y=>{if(y.deltaY===0)return;const D=y.currentTarget;D.scrollLeft=D.scrollLeft+y.deltaY};return w(hs,{direction:"row",justify:"space-between",align:"stretch",flex:"0 1 auto",gap:4,style:{overflowX:"hidden"},children:[w(N,{direction:"row",gap:3,flex:"0 1 auto",style:{overflowX:"auto"},children:[w(bn,{type:t==null?"selected":"default",onClick:()=>{n(null)},children:[s(O,{type:"Normal",color:t===null?"Highlight.default":"Text.lighter",style:{paddingTop:4,paddingBottom:3.5},children:d("timetable.myTimetable")}),t===null&&h==="success"&&s(it,{onClick:y=>{y.stopPropagation(),p({year:i,semester:o,lectureIds:e.map(D=>D.id)})},styles:{padding:5},children:s(V,{size:15,color:u.colors.Highlight.default,onClick:()=>{},children:s(En,{})})})]},"my-timetable"),h==="success"&&w(fs,{direction:"row",gap:3,flex:"1 1 auto",onWheel:M,children:[s(Oa,{sensors:S,collisionDetection:Po,onDragStart:k,onDragEnd:A,modifiers:[qa,Ha],children:s(_a,{items:m.map(y=>y.id),strategy:Xa,children:m.map(y=>s(gs,{timetable:y,isSelected:t===y.id,isDragging:x===y.id,onClick:()=>{n(y.id)},onCopy:D=>{D.stopPropagation(),p({year:i,semester:o,lectureIds:e.map(L=>L.id)})},onDelete:D=>{D.stopPropagation(),C({id:y.id})},onNameChange:(D,L)=>{v(B=>B.map(U=>U.id===D?{...U,name:L}:U)),b({id:D,name:L})}},y.id))})}),s(bn,{onClick:()=>{p({year:i,semester:o,lectureIds:[]})},children:s(it,{onClick:y=>{},styles:{padding:3.75},children:s(V,{size:17.5,color:u.colors.Text.default,onClick:()=>{},children:s(wn,{})})})})]})]}),s(N,{direction:"row",gap:0,align:"center",children:s(as,{year:i,semester:o,setYear:a,setSemester:l,setCurrentTimetableId:n})})]})},ms=E.div`
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 4px 16px;

    ${$.tablet} {
        grid-template-columns: 1fr 1fr 1fr;
        gap: 4px 8px;
    }
`,Qe=E.div`
    display: flex;
    flex-direction: row;
    justify-content: flex-start;
    align-items: flex-start;
    padding-left: 16px;
    color: ${({theme:e})=>e.colors.Text.default};

    @media (hover: hover) {
        &:hover {
            color: ${({theme:e})=>e.colors.Highlight.default};
        }
    }

    ${$.tablet} {
        padding-left: 0;
    }
`,Je=E.span`
    font-size: 14px;
    font-weight: 700;
    white-space: nowrap;

    ${$.mobile} {
        font-size: 12px;
    }
`,Ze=E.span`
    font-size: 14px;
    font-weight: 400;
    padding-left: 8px;
    white-space: nowrap;

    ${$.mobile} {
        font-size: 12px;
    }
`,et=E.span`
    font-size: 14px;
    font-weight: 400;
    padding-left: 2px;
    color: ${({theme:e})=>e.colors.Highlight.default};

    ${$.mobile} {
        display: none;
    }
`;function bs({hover:e,setHover:t,timetableLectures:n}){const{t:r}=Re(),{lecturesByType:i,creditsByType:o}=c.useMemo(()=>{const d={basicRequired:0,basicElective:0,majorRequired:0,majorElective:0,humanitiesSocial:0,etc:0},h={basicRequired:[],basicElective:[],majorRequired:[],majorElective:[],humanitiesSocial:[],etc:[]};return n.forEach(u=>{u.type.includes("기초필수")?(d.basicRequired+=u.credit,h.basicRequired.push(u)):u.type.includes("기초선택")?(d.basicElective+=u.credit,h.basicElective.push(u)):u.type.includes("전공필수")?(d.majorRequired+=u.credit,h.majorRequired.push(u)):u.type.includes("전공선택")?(d.majorElective+=u.credit,h.majorElective.push(u)):u.type.includes("인문")?(d.humanitiesSocial+=u.credit,h.humanitiesSocial.push(u)):(d.etc+=u.credit,d.etc+=u.creditAU,h.etc.push(u))}),{lecturesByType:h,creditsByType:d}},[n]);function a(d){for(const h of["basicRequired","basicElective","majorRequired","majorElective","humanitiesSocial","etc"])if(d.type.includes(r(`common.type.${h}`)))return h;return"etc"}function l(d,h){if(!e||e.length==0||e?.length>1)return"";const u=e[0];return d.map(g=>g.id).includes(u.id)?`(${u.creditAU?u.creditAU:u.credit})`:h===a(u)?`(+${u.creditAU?u.creditAU:u.credit})`:""}return w(ms,{children:[w(Qe,{onMouseEnter:()=>t(i.basicRequired),onMouseLeave:()=>t([]),children:[s(Je,{children:r("common.type.basicRequiredShort")}),s(Ze,{children:o.basicRequired}),s(et,{children:l(i.basicRequired,"basicRequired")})]}),w(Qe,{onMouseEnter:()=>t(i.basicElective),onMouseLeave:()=>t([]),children:[s(Je,{children:r("common.type.basicElectiveShort")}),s(Ze,{children:o.basicElective}),s(et,{children:l(i.basicElective,"basicElective")})]}),w(Qe,{onMouseEnter:()=>t(i.majorRequired),onMouseLeave:()=>t([]),children:[s(Je,{children:r("common.type.majorRequiredShort")}),s(Ze,{children:o.majorRequired}),s(et,{children:l(i.majorRequired,"majorRequired")})]}),w(Qe,{onMouseEnter:()=>t(i.majorElective),onMouseLeave:()=>t([]),children:[s(Je,{children:r("common.type.majorElectiveShort")}),s(Ze,{children:o.majorElective}),s(et,{children:l(i.majorElective,"majorElective")})]}),w(Qe,{onMouseEnter:()=>t(i.humanitiesSocial),onMouseLeave:()=>t([]),children:[s(Je,{children:r("common.type.humanitiesSocialElectiveShort")}),s(Ze,{children:o.humanitiesSocial}),s(et,{children:l(i.humanitiesSocial,"humanitiesSocial")})]}),w(Qe,{onMouseEnter:()=>t(i.etc),onMouseLeave:()=>t([]),children:[s(Je,{children:r("common.type.etcShort")}),s(Ze,{children:o.etc}),s(et,{children:l(i.etc,"etc")})]})]})}const vs=E.div`
    display: flex;
    flex-direction: row;
    justify-content: center;
    align-items: center;
    gap: 48px;

    ${$.mobile} {
        gap: 20px;
    }
`,cr=E.div`
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 2px;
    color: ${({theme:e,highlighted:t})=>t?e.colors.Highlight.default:e.colors.Text.default};

    &:hover {
        color: ${({theme:e})=>e.colors.Highlight.default};
    }
`,dr=E.span`
    font-size: 20px;
    font-weight: 300;
`,ur=E.span`
    font-size: 10px;
    font-weight: 400;
`,ys=E.div`
    display: flex;
    flex-direction: row;
    justify-content: center;
    align-items: center;
    gap: 48px;

    ${$.mobile} {
        gap: 20px;
    }
`,tn=E.div`
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 2px;
`,nn=E.span`
    font-size: 20px;
    font-weight: 300;
    color: ${({theme:e})=>e.colors.Text.default};
`,rn=E.span`
    font-size: 10px;
    font-weight: 400;
    color: ${({theme:e})=>e.colors.Text.dark};
`;function ws({timetableLectures:e,hover:t,setHover:n}){const{t:r}=Re(),i=c.useMemo(()=>{let o=e.reduce((f,g)=>f+g.credit,0),a=e.reduce((f,g)=>f+g.creditAU,0);if(t&&t.length==1){const f=t[0];e.some(g=>g.id===f.id)||(o+=f.credit,a+=f.creditAU)}let l=0,d=0,h=0,u=e.length;return e.forEach(f=>{l+=f.averageGrade,d+=f.averageLoad,h+=f.averageSpeech,f.averageGrade===0&&f.averageLoad===0&&f.averageSpeech===0&&(u-=1)}),l=l/u,d=d/u,h=h/u,{totalCredits:o,totalAU:a,avgGrade:l,avgLoad:d,avgSpeech:h}},[e,t]);return w(We,{children:[w(vs,{children:[w(cr,{onMouseEnter:()=>n(e.filter(o=>o.credit>0)),onMouseLeave:()=>n([]),highlighted:t.length>0&&t.some(o=>o.credit>0),children:[s(dr,{children:i.totalCredits}),s(ur,{children:r("common.credit")})]}),w(cr,{onMouseEnter:()=>n(e.filter(o=>o.creditAU>0)),onMouseLeave:()=>n([]),highlighted:t.length>0&&t.some(o=>o.creditAU>0),children:[s(dr,{children:i.totalAU}),s(ur,{children:"AU"})]})]}),w(ys,{children:[w(tn,{children:[s(nn,{children:nt(i.avgGrade/3)}),s(rn,{children:r("common.grade")})]}),w(tn,{children:[s(nn,{children:nt(i.avgLoad/3)}),s(rn,{children:r("common.load")})]}),w(tn,{children:[s(nn,{children:nt(i.avgSpeech/3)}),s(rn,{children:r("common.speech")})]})]})]})}const xs=E(N)`
    overflow-y: auto;
    min-height: 0;
`,Es=E.div`
    display: flex;
    flex-direction: row;
    gap: 8px;
    align-items: flex-start;
`,Ts=E.span`
    font-size: 14px;
    font-weight: 400;
    color: ${({color:e,theme:t})=>e||t.colors.Text.default};
    min-width: 16px;
`,Ss=E(N)`
    color: ${({highlighted:e,theme:t})=>e?t.colors.Highlight.default:t.colors.Text.default};

    &:hover {
        color: ${({theme:e})=>e.colors.Highlight.default};
    }
`,Cs=[{day:ee.Mon,color:"#E54C65"},{day:ee.Tue,color:"#F5A623"},{day:ee.Wed,color:"#7ED321"},{day:ee.Thu,color:"#4A90D9"},{day:ee.Fri,color:"#9B59B6"}];function Ds({timetableLectures:e,hover:t,setHover:n}){const{t:r}=Re(),i=c.useMemo(()=>{const o={[ee.Mon]:[],[ee.Tue]:[],[ee.Wed]:[],[ee.Thu]:[],[ee.Fri]:[]};if(e.forEach(a=>{a.examTimes.forEach(l=>{if(l==null)return;const d=l.day;o[d]&&o[d].push({lectureName:a.name,lectureId:a.id,time:l.str.split(" ").slice(1).join(" ")})})}),t&&t.length==1){const a=t[0];e.some(l=>l.id===a.id)||a.examTimes.forEach(l=>{if(l==null)return;const d=l.day;o[d]&&o[d].push({lectureName:a.name,lectureId:a.id,time:l.str})})}return o},[e,t]);return w(xs,{direction:"column",gap:15,style:{width:"100%"},flex:"1 1 0",children:[s(O,{type:"NormalBold",color:"Text.default",children:r("timetable.examTimetable")}),Cs.map(({day:o,color:a})=>{const l=i[o];return!l||l.length===0?null:w(Es,{children:[s(Ts,{color:a,onMouseEnter:()=>{n(e.filter(d=>d.examTimes.some(h=>h?.day===o)))},onMouseLeave:()=>n([]),children:Si(o,!0)}),s(N,{direction:"column",gap:2,children:l.sort((d,h)=>d.time.localeCompare(h.time)).map((d,h)=>w(Ss,{direction:"column",gap:0,highlighted:t?.some(u=>u.id===d.lectureId),onMouseEnter:()=>n(e.filter(u=>u.id===d.lectureId)),onMouseLeave:()=>n([]),children:[s(O,{type:"NormalBold",children:d.lectureName}),s(O,{type:"Normal",children:d.time})]},h))})]},o)})]})}const Rs=e=>[e?.red?.[1],e?.red?.[2],e?.orange?.[1],e?.orange?.[2],e?.yellow?.[1],e?.yellow?.[2],e?.green?.[1],e?.green?.[2],e?.green?.[3],e?.blue?.[1],e?.blue?.[2],e?.purple?.[1],e?.purple?.[2],e?.pink?.[1],e?.pink?.[2]].map(t=>t??"#CCCCCC"),As=E.div`
    width: 100%;
    height: 220px;
    border-radius: 8px;
    display: flex;
    align-items: center;
    justify-content: center;
    position: relative;
    overflow: hidden;
`,Is=E.img`
    object-fit: cover;
    object-position: center;
    filter: ${({isDarkMode:e})=>e?"invert(100%) sepia(100%) grayscale(100%) brightness(0.7)":"none"};

    /* Performance Optimization: Force GPU layer to prevent repaints on hover */
    transform: translateZ(0);
    will-change: filter;
`,Ns=E.div`
    display: flex;
    gap: 4px;
    align-items: center;
    background-color: ${({theme:e})=>e.colors.Background.Section.default};
    left: ${({left:e})=>e}%;
    top: ${({top:e})=>e}%;
    position: absolute;
    font-size: 10px;
    color: ${({theme:e,highlighted:t})=>t?e.colors.Highlight.default:e.colors.Text.default};
    border-radius: 4px;
    padding: 2px 4px;
`,ks=E.div`
    width: 0;
    height: 0;
    border-left: 3px solid transparent;
    border-right: 3px solid transparent;
    border-top: 6px solid ${({theme:e})=>e.colors.Background.Section.default};
    position: absolute;
    top: 17px;
`,Ls=E.div`
    background-color: ${({theme:e,courseId:t,highlighted:n})=>n?e.colors.Highlight.default:(()=>{const r=Rs(e.colors?.Tile?.TimeTable?.default);return r[t%r.length]})()};
    width: 10px;
    height: 10px;
    border-radius: 100%;
`,Ms=new Map([["E2",{left:50,top:67}],["E3",{left:56,top:61}],["E6",{left:57,top:52}],["E7",{left:65,top:50}],["E11",{left:45,top:47}],["E16",{left:45,top:40}],["N1",{left:75,top:30}],["N3",{left:45,top:34}],["N4",{left:53,top:32}],["N5",{left:63,top:28}],["N7",{left:27,top:30}],["N22",{left:67,top:26}],["N24",{left:65,top:22}],["N25",{left:49,top:26}],["N27",{left:47,top:17}],["W1",{left:26,top:68}],["W8",{left:27,top:44}],["W16",{left:34,top:73}]]);function Os({timetableLectures:e,hover:t,setHover:n}){const{displayedTheme:r}=ki(),i=c.useMemo(()=>s(Is,{src:"/campus_map.svg",alt:"Campus Map",isDarkMode:r==="dark",decoding:"async"}),[r]);return w(As,{children:[i,Array.from(Ms).map(([o,{left:a,top:l}])=>{const d=e.filter(h=>h.classes.some(u=>u.buildingCode.includes(o)));return t?.forEach(h=>{e.includes(h)||h.classes.some(u=>u.buildingCode.includes(o))&&d.push(h)}),d.length===0?null:w(Ns,{left:a,top:l,onMouseEnter:()=>{n(d)},onMouseLeave:()=>{n([])},highlighted:t?.some(h=>d.includes(h))??!1,children:[s(ks,{}),o,d.map(h=>s(Ls,{courseId:h.courseId,highlighted:t?.includes(h)??!1},h.id))]},o)})]})}const Bs=E(N)`
    width: 100%;
    max-width: 400px;
`,ft=E(O)`
    margin-bottom: 8px;
`,on=E.select`
    width: 100%;
    padding: 10px;
    border-radius: 8px;
    border: 1px solid ${({theme:e})=>e.colors.Line.block};
    background-color: ${({theme:e})=>e.colors.Background.Block.default};
    color: ${({theme:e})=>e.colors.Text.default};
    font-size: 14px;
    outline: none;
`,ti=(e,t)=>{const n=[];for(let r=e;r<=t;r+=30){const i=Math.floor(r/60),o=r%60;n.push({value:r,label:`${i.toString().padStart(2,"0")}:${o.toString().padStart(2,"0")}`})}return n},zs=ti(480,1410),Ps=ti(510,1440);function $s({isOpen:e,onClose:t,timetableId:n}){const{t:r}=Re(),i=Ut(),[o,a]=c.useState(""),[l,d]=c.useState(""),[h,u]=c.useState(ee.Mon),[f,g]=c.useState(480),[p,C]=c.useState(540),{requestFunction:b,mutation:m}=Y("POST",`/timetables/${n}/custom-blocks`,{onSuccess:()=>{i.invalidateQueries({queryKey:[`/timetables/${n}/custom-blocks`]}),t(),a(""),d(""),u(ee.Mon),g(480),C(540)}}),v=async()=>{if(!o.trim()){alert(r("timetable.customBlock.errorNameRequired","일정 이름을 입력해주세요."));return}if(f>=p){alert(r("timetable.customBlock.errorTimeInvalid","종료 시간은 시작 시간보다 늦어야 합니다."));return}b({blockName:o.trim(),block_name:o.trim(),place:l,day:h,begin:f,end:p})};return s(Dr,{isOpen:e,onClose:t,title:r("timetable.customBlock.title","커스텀 블록 추가"),children:w(Bs,{direction:"column",gap:16,children:[w(N,{direction:"column",gap:0,align:"stretch",style:{width:"100%"},children:[s(ft,{type:"NormalBold",color:"Text.default",children:r("timetable.customBlock.name","일정 이름")}),s(Hn,{value:o,onChange:x=>a(x.target.value),placeholder:"예: 동아리 회의",maxLength:50})]}),w(N,{direction:"column",gap:0,align:"stretch",style:{width:"100%"},children:[s(ft,{type:"NormalBold",color:"Text.default",children:r("timetable.customBlock.place","장소")}),s(Hn,{value:l,onChange:x=>d(x.target.value),placeholder:"예: N1 101호",maxLength:50})]}),w(N,{direction:"column",gap:0,align:"stretch",style:{width:"100%"},children:[s(ft,{type:"NormalBold",color:"Text.default",children:r("timetable.customBlock.day","요일")}),w(on,{value:h,onChange:x=>u(Number(x.target.value)),children:[s("option",{value:ee.Mon,children:r("common.days.monday")}),s("option",{value:ee.Tue,children:r("common.days.tuesday")}),s("option",{value:ee.Wed,children:r("common.days.wednesday")}),s("option",{value:ee.Thu,children:r("common.days.thursday")}),s("option",{value:ee.Fri,children:r("common.days.friday")})]})]}),w(N,{direction:"row",gap:12,align:"stretch",style:{width:"100%"},children:[w(N,{direction:"column",gap:0,align:"stretch",style:{flex:1},children:[s(ft,{type:"NormalBold",color:"Text.default",children:r("timetable.customBlock.begin","시작 시간")}),s(on,{value:f,onChange:x=>g(Number(x.target.value)),children:zs.map(x=>s("option",{value:x.value,children:x.label},`begin-${x.value}`))})]}),w(N,{direction:"column",gap:0,align:"stretch",style:{flex:1},children:[s(ft,{type:"NormalBold",color:"Text.default",children:r("timetable.customBlock.end","종료 시간")}),s(on,{value:p,onChange:x=>C(Number(x.target.value)),children:Ps.map(x=>s("option",{value:x.value,disabled:x.value<=f,children:x.label},`end-${x.value}`))})]})]}),s(Lt,{onClick:v,type:"highlighted",style:{padding:"12px"},children:m.isPending?r("common.button.adding","추가 중..."):r("common.button.add","추가")})]})})}var pt={},hr;function Fs(){return hr||(hr=1,pt.createCanvas=function(e,t){return Object.assign(document.createElement("canvas"),{width:e,height:t})},pt.createImageData=function(e,t,n){switch(arguments.length){case 0:return new ImageData;case 1:return new ImageData(e);case 2:return new ImageData(e,t);default:return new ImageData(e,t,n)}},pt.loadImage=function(e,t){return new Promise(function(n,r){const i=Object.assign(document.createElement("img"),t);function o(){i.onload=null,i.onerror=null}i.onload=function(){o(),n(i)},i.onerror=function(){o(),r(new Error('Failed to load the image "'+e+'"'))},i.src=e})}),pt}var fr=Fs(),kn=(e=>(e.DAILY="DAILY",e.HOURLY="HOURLY",e.MINUTELY="MINUTELY",e.MONTHLY="MONTHLY",e.SECONDLY="SECONDLY",e.WEEKLY="WEEKLY",e.YEARLY="YEARLY",e))(kn||{}),vn=(e=>(e.FR="FR",e.MO="MO",e.SA="SA",e.SU="SU",e.TH="TH",e.TU="TU",e.WE="WE",e))(vn||{});function ve(e,t,n){if(Array.isArray(t))e.x=t.map(r=>{if(Array.isArray(r))return r;if(typeof r.key!="string"||typeof r.value!="string")throw new Error("Either key or value is not a string!");if(r.key.substr(0,2)!=="X-")throw new Error("Key has to start with `X-`!");return[r.key,r.value]});else if(typeof t=="object")e.x=Object.entries(t).map(([r,i])=>{if(typeof r!="string"||typeof i!="string")throw new Error("Either key or value is not a string!");if(r.substr(0,2)!=="X-")throw new Error("Key has to start with `X-`!");return[r,i]});else if(typeof t=="string"&&typeof n=="string"){if(t.substr(0,2)!=="X-")throw new Error("Key has to start with `X-`!");e.x.push([t,n])}else return e.x.map(r=>({key:r[0],value:r[1]}))}function Ne(e,t){if(e instanceof Date&&isNaN(e.getTime())||typeof e=="string"&&isNaN(new Date(e).getTime()))throw new Error(`\`${t}\` has to be a valid date!`);if(e instanceof Date||typeof e=="string"||Ht(e)&&e.isValid===!0||(Yt(e)||js(e))&&e.isValid())return e;throw new Error(`\`${t}\` has to be a valid date!`)}function be(e,t){let n=Object.values(e),r=String(t).toUpperCase();if(!r||!n.includes(r))throw new Error(`Input must be one of the following: ${n.join(", ")}`);return r}function Tt(e,t){let n=null;if(typeof t=="string"){let r=t.match(/^(.+) ?<([^>]+)>$/);r?n={email:r[2].trim(),name:r[1].trim()}:t.includes("@")&&(n={email:t.trim(),name:t.trim()})}else typeof t=="object"&&(n={email:t.email,mailto:t.mailto,name:t.name,sentBy:t.sentBy});if(!n&&typeof t=="string")throw new Error("`"+e+"` isn't formated correctly. See https://sebbo2002.github.io/ical-generator/develop/reference/interfaces/ICalOrganizer.html");if(!n)throw new Error("`"+e+"` needs to be a valid formed string or an object. See https://sebbo2002.github.io/ical-generator/develop/reference/interfaces/ICalOrganizer.html");if(!n.name)throw new Error("`"+e+".name` is empty!");if(!n.email)throw new Error("`"+e+".email` is empty!");return n}function z(e,t){return String(e).replace(t?/[\\"]/g:/[\\;,]/g,function(n){return"\\"+n}).replace(/(?:\r\n|\r|\n)/g,"\\n")}function Us(e){return e.split(`\r
`).map(function(t){let n="",r=0;for(let i=0;i<t.length;i++){let o=t.charAt(i);o>="\uD800"&&o<="\uDBFF"&&(o+=t.charAt(++i));let a=new TextEncoder().encode(o).length;r+=a,r>74&&(n+=`\r
 `,r=a),n+=o}return n}).join(`\r
`)}function we(e,t,n,r){if(e?.startsWith("/")&&(e=e.substr(1)),typeof t=="string"||t instanceof Date){let i=Ws(t)?t.withTimeZone(e):new Date(t),o=i.getUTCFullYear()+String(i.getUTCMonth()+1).padStart(2,"0")+i.getUTCDate().toString().padStart(2,"0");return e&&(o=i.getFullYear()+String(i.getMonth()+1).padStart(2,"0")+i.getDate().toString().padStart(2,"0")),n?o:e?(o+="T"+i.getHours().toString().padStart(2,"0")+i.getMinutes().toString().padStart(2,"0")+i.getSeconds().toString().padStart(2,"0"),o):(o+="T"+i.getUTCHours().toString().padStart(2,"0")+i.getUTCMinutes().toString().padStart(2,"0")+i.getUTCSeconds().toString().padStart(2,"0")+(r?"":"Z"),o)}else if(Yt(t)){let i=e?pr(t)&&!t.tz()?t.clone().tz(e):t:r||n&&pr(t)&&t.tz()?t:t.utc();return i.format("YYYYMMDD")+(n?"":"T"+i.format("HHmmss")+(r||e?"":"Z"))}else if(Ht(t)){let i=e?t.setZone(e):r||n&&t.zone.type!=="system"?t:t.setZone("utc");return i.toFormat("yyyyLLdd")+(n?"":"T"+i.toFormat("HHmmss")+(r||e?"":"Z"))}else{let i=t;if(e)i=typeof t.tz=="function"?t.tz(e):t;else if(!r)if(typeof t.utc=="function")i=t.utc();else throw new Error("Unable to convert dayjs object to UTC value: UTC plugin is not available!");return i.format("YYYYMMDD")+(n?"":"T"+i.format("HHmmss")+(r||e?"":"Z"))}}function an(e,t,n,r){let i="",o=r?.floating||!1;return r?.timezone&&(i=";TZID="+r.timezone,o=!0),t+i+":"+we(e,n,!1,o)}function Ln(e){let t=e.x.map(([n,r])=>n.toUpperCase()+":"+z(r,!1)).join(`\r
`);return t.length?t+`\r
`:""}function js(e){return typeof e=="object"&&e!==null&&!(e instanceof Date)&&!Yt(e)&&!Ht(e)}function Ht(e){return typeof e=="object"&&e!==null&&"toJSDate"in e&&typeof e.toJSDate=="function"}function Yt(e){return e!=null&&e._isAMomentObject!=null}function qs(e){return e!==null&&typeof e=="object"&&"asSeconds"in e&&typeof e.asSeconds=="function"}function pr(e){return Yt(e)&&"tz"in e&&typeof e.tz=="function"}function sn(e){return e!==null&&typeof e=="object"&&"between"in e&&typeof e.between=="function"&&typeof e.toString=="function"}function Ws(e){return e instanceof Date&&"internal"in e&&e.internal instanceof Date&&"withTimeZone"in e&&typeof e.withTimeZone=="function"&&"tzComponents"in e&&typeof e.tzComponents=="function"}function gr(e){return typeof e=="string"||e instanceof Date?new Date(e):Ht(e)?e.toJSDate():e.toDate()}function tt(e){let t="";return e<0&&(t="-",e*=-1),t+="P",e>=86400&&(t+=Math.floor(e/86400)+"D",e%=86400),!e&&t.length>1||(t+="T",e>=3600&&(t+=Math.floor(e/3600)+"H",e%=3600),e>=60&&(t+=Math.floor(e/60)+"M",e%=60),e>0?t+=e+"S":t.length<=2&&(t+="0S")),t}function ke(e){return e?typeof e=="string"?e:e.toJSON():null}var ni=(e=>(e.CHAIR="CHAIR",e.NON="NON-PARTICIPANT",e.OPT="OPT-PARTICIPANT",e.REQ="REQ-PARTICIPANT",e))(ni||{}),ri=(e=>(e.CLIENT="CLIENT",e.NONE="NONE",e.SERVER="SERVER",e))(ri||{}),ii=(e=>(e.ACCEPTED="ACCEPTED",e.DECLINED="DECLINED",e.DELEGATED="DELEGATED",e.NEEDSACTION="NEEDS-ACTION",e.TENTATIVE="TENTATIVE",e))(ii||{}),oi=(e=>(e.GROUP="GROUP",e.INDIVIDUAL="INDIVIDUAL",e.RESOURCE="RESOURCE",e.ROOM="ROOM",e.UNKNOWN="UNKNOWN",e))(oi||{}),Ft=class Le{data;parent;constructor(t,n){if(this.data={delegatedFrom:null,delegatedTo:null,email:"",mailto:null,name:null,role:"REQ-PARTICIPANT",rsvp:null,scheduleAgent:null,sentBy:null,status:null,type:null,x:[]},this.parent=n,!this.parent)throw new Error("`event` option required!");if(!t.email)throw new Error("No value for `email` in ICalAttendee given!");t.name!==void 0&&this.name(t.name),t.email!==void 0&&this.email(t.email),t.mailto!==void 0&&this.mailto(t.mailto),t.sentBy!==void 0&&this.sentBy(t.sentBy),t.status!==void 0&&this.status(t.status),t.role!==void 0&&this.role(t.role),t.rsvp!==void 0&&this.rsvp(t.rsvp),t.type!==void 0&&this.type(t.type),t.delegatedTo!==void 0&&this.delegatedTo(t.delegatedTo),t.delegatedFrom!==void 0&&this.delegatedFrom(t.delegatedFrom),t.delegatesTo&&this.delegatesTo(t.delegatesTo),t.delegatesFrom&&this.delegatesFrom(t.delegatesFrom),t.scheduleAgent!==void 0&&this.scheduleAgent(t.scheduleAgent),t.x!==void 0&&this.x(t.x)}delegatedFrom(t){return t===void 0?this.data.delegatedFrom:(t?typeof t=="string"?this.data.delegatedFrom=new Le(Tt("delegatedFrom",t),this.parent):t instanceof Le?this.data.delegatedFrom=t:this.data.delegatedFrom=new Le(t,this.parent):this.data.delegatedFrom=null,this)}delegatedTo(t){return t===void 0?this.data.delegatedTo:t?(typeof t=="string"?this.data.delegatedTo=new Le(Tt("delegatedTo",t),this.parent):t instanceof Le?this.data.delegatedTo=t:this.data.delegatedTo=new Le(t,this.parent),this.data.status="DELEGATED",this):(this.data.delegatedTo=null,this.data.status==="DELEGATED"&&(this.data.status=null),this)}delegatesFrom(t){let n=t instanceof Le?t:this.parent.createAttendee(t);return this.delegatedFrom(n),n.delegatedTo(this),n}delegatesTo(t){let n=t instanceof Le?t:this.parent.createAttendee(t);return this.delegatedTo(n),n.delegatedFrom(this),n}email(t){return t?(this.data.email=t,this):this.data.email}mailto(t){return t===void 0?this.data.mailto:(this.data.mailto=t||null,this)}name(t){return t===void 0?this.data.name:(this.data.name=t||null,this)}role(t){return t===void 0?this.data.role:(this.data.role=be(ni,t),this)}rsvp(t){return t===void 0?this.data.rsvp:t===null?(this.data.rsvp=null,this):(this.data.rsvp=!!t,this)}scheduleAgent(t){return t===void 0?this.data.scheduleAgent:t?typeof t=="string"&&t.toUpperCase().startsWith("X-")?(this.data.scheduleAgent=t,this):(this.data.scheduleAgent=be(ri,t),this):(this.data.scheduleAgent=null,this)}sentBy(t){return t?(this.data.sentBy=t,this):this.data.sentBy}status(t){return t===void 0?this.data.status:t?(this.data.status=be(ii,t),this):(this.data.status=null,this)}toJSON(){return Object.assign({},this.data,{delegatedFrom:this.data.delegatedFrom?.email()||null,delegatedTo:this.data.delegatedTo?.email()||null,x:this.x()})}toString(){let t="ATTENDEE";if(!this.data.email)throw new Error("No value for `email` in ICalAttendee given!");return t+=";ROLE="+this.data.role,this.data.type&&(t+=";CUTYPE="+this.data.type),this.data.status&&(t+=";PARTSTAT="+this.data.status),this.data.rsvp!==null&&(t+=";RSVP="+this.data.rsvp.toString().toUpperCase()),this.data.sentBy!==null&&(t+=';SENT-BY="mailto:'+this.data.sentBy+'"'),this.data.delegatedTo&&(t+=';DELEGATED-TO="'+this.data.delegatedTo.email()+'"'),this.data.delegatedFrom&&(t+=';DELEGATED-FROM="'+this.data.delegatedFrom.email()+'"'),this.data.name&&(t+=';CN="'+z(this.data.name,!0)+'"'),this.data.email&&this.data.mailto&&(t+=";EMAIL="+z(this.data.email,!1)),this.data.scheduleAgent&&(t+=";SCHEDULE-AGENT="+this.data.scheduleAgent),this.data.x.length&&(t+=";"+this.data.x.map(([n,r])=>n.toUpperCase()+"="+z(r,!1)).join(";")),t+=":MAILTO:"+z(this.data.mailto||this.data.email,!1)+`\r
`,t}type(t){return t===void 0?this.data.type:t?(this.data.type=be(oi,t),this):(this.data.type=null,this)}x(t,n){if(t===void 0)return ve(this.data);if(typeof t=="string"&&typeof n=="string")ve(this.data,t,n);else if(typeof t=="object")ve(this.data,t);else throw new Error("Either key or value is not a string!");return this}},Mn=(e=>(e.audio="audio",e.display="display",e.email="email",e))(Mn||{}),Hs={end:"END",start:"START"},mr=class{data;event;constructor(e,t){if(this.data={attach:null,attendees:[],description:null,interval:null,relatesTo:null,repeat:null,summary:null,trigger:-600,type:"display",x:[]},this.event=t,!t)throw new Error("`event` option required!");e.type!==void 0&&this.type(e.type),"trigger"in e&&e.trigger!==void 0&&this.trigger(e.trigger),"triggerBefore"in e&&e.triggerBefore!==void 0&&this.triggerBefore(e.triggerBefore),"triggerAfter"in e&&e.triggerAfter!==void 0&&this.triggerAfter(e.triggerAfter),e.repeat&&this.repeat(e.repeat),e.attach!==void 0&&this.attach(e.attach),e.description!==void 0&&this.description(e.description),e.summary!==void 0&&this.summary(e.summary),e.attendees!==void 0&&this.attendees(e.attendees),e.x!==void 0&&this.x(e.x)}attach(e){if(e===void 0)return this.data.attach;if(!e)return this.data.attach=null,this;let t=null;if(typeof e=="string")t={mime:null,uri:e};else if(typeof e=="object")t={mime:e.mime||null,uri:e.uri};else throw new Error("`attachment` needs to be a valid formed string or an object. See https://sebbo2002.github.io/ical-generator/develop/reference/classes/ICalAlarm.html#attach");if(!t.uri)throw new Error("`attach.uri` is empty!");return this.data.attach={mime:t.mime,uri:t.uri},this}attendees(e){return e?(e.forEach(t=>this.createAttendee(t)),this):this.data.attendees}createAttendee(e){if(e instanceof Ft)return this.data.attendees.push(e),e;typeof e=="string"&&(e=Tt("data",e));let t=new Ft(e,this);return this.data.attendees.push(t),t}description(e){return e===void 0?this.data.description:e?(this.data.description=e,this):(this.data.description=null,this)}relatesTo(e){if(e===void 0)return this.data.relatesTo;if(!e)return this.data.relatesTo=null,this;if(!Object.values(Hs).includes(e))throw new Error("`relatesTo` is not correct, must be either `START` or `END`!");return this.data.relatesTo=e,this}repeat(e){if(e===void 0)return this.data.repeat;if(!e)return this.data.repeat=null,this;if(typeof e!="object")throw new Error("`repeat` is not correct, must be an object!");if(typeof e.times!="number"||!isFinite(e.times))throw new Error("`repeat.times` is not correct, must be numeric!");if(typeof e.interval!="number"||!isFinite(e.interval))throw new Error("`repeat.interval` is not correct, must be numeric!");return this.data.repeat=e,this}summary(e){return e===void 0?this.data.summary:e?(this.data.summary=e,this):(this.data.summary=null,this)}toJSON(){let e=this.trigger();return Object.assign({},this.data,{trigger:typeof e=="number"?e:ke(e),x:this.x()})}toString(){let e=`BEGIN:VALARM\r
`;if(e+="ACTION:"+this.data.type.toUpperCase()+`\r
`,typeof this.data.trigger=="number"&&this.data.relatesTo===null?this.data.trigger>0?e+="TRIGGER;RELATED=END:"+tt(this.data.trigger)+`\r
`:e+="TRIGGER:"+tt(this.data.trigger)+`\r
`:typeof this.data.trigger=="number"?e+="TRIGGER;RELATED="+this.data.relatesTo?.toUpperCase()+":"+tt(this.data.trigger)+`\r
`:e+="TRIGGER;VALUE=DATE-TIME:"+we(this.event.timezone(),this.data.trigger)+`\r
`,this.data.repeat){if(!this.data.repeat.times)throw new Error("No value for `repeat.times` in ICalAlarm given, but required for `interval`!");if(!this.data.repeat.interval)throw new Error("No value for `repeat.interval` in ICalAlarm given, but required for `repeat`!");e+="REPEAT:"+this.data.repeat.times+`\r
`,e+="DURATION:"+tt(this.data.repeat.interval)+`\r
`}return this.data.type==="audio"&&this.data.attach&&this.data.attach.mime?e+="ATTACH;FMTTYPE="+z(this.data.attach.mime,!1)+":"+z(this.data.attach.uri,!1)+`\r
`:this.data.type==="audio"&&this.data.attach?e+="ATTACH;VALUE=URI:"+z(this.data.attach.uri,!1)+`\r
`:this.data.type==="audio"&&(e+=`ATTACH;VALUE=URI:Basso\r
`),this.data.type!=="audio"&&this.data.description?e+="DESCRIPTION:"+z(this.data.description,!1)+`\r
`:this.data.type!=="audio"&&(e+="DESCRIPTION:"+z(this.event.summary(),!1)+`\r
`),this.data.type==="email"&&this.data.summary?e+="SUMMARY:"+z(this.data.summary,!1)+`\r
`:this.data.type==="email"&&(e+="SUMMARY:"+z(this.event.summary(),!1)+`\r
`),this.data.type==="email"&&this.data.attendees.forEach(t=>{e+=t.toString()}),e+=Ln(this.data),e+=`END:VALARM\r
`,e}trigger(e){if(e===void 0&&typeof this.data.trigger=="number")return-1*this.data.trigger;if(e===void 0)return this.data.trigger;if(typeof e=="number"&&isFinite(e))this.data.trigger=-1*e;else{if(!e||typeof e=="number")throw new Error("`trigger` is not correct, must be a finite number or a supported date!");this.data.trigger=Ne(e,"trigger")}return this}triggerAfter(e){return e===void 0?this.data.trigger:this.trigger(typeof e=="number"?-1*e:e)}triggerBefore(e){return e===void 0?this.trigger():this.trigger(e)}type(e){if(e===void 0)return this.data.type;if(!e||!Object.keys(Mn).includes(e))throw new Error("`type` is not correct, must be either `display` or `audio`!");return this.data.type=e,this}x(e,t){if(e===void 0)return ve(this.data);if(typeof e=="string"&&typeof t=="string")ve(this.data,e,t);else if(typeof e=="object")ve(this.data,e);else throw new Error("Either key or value is not a string!");return this}},br=class{data;constructor(e){if(this.data={name:""},!e.name)throw new Error("No value for `name` in ICalCategory given!");this.name(e.name)}name(e){return e===void 0?this.data.name:(this.data.name=e,this)}toJSON(){return Object.assign({},this.data)}toString(){return z(this.data.name,!1)}},ai=(e=>(e.BUSY="BUSY",e.FREE="FREE",e.OOF="OOF",e.TENTATIVE="TENTATIVE",e))(ai||{}),si=(e=>(e.CONFIDENTIAL="CONFIDENTIAL",e.PRIVATE="PRIVATE",e.PUBLIC="PUBLIC",e))(si||{}),li=(e=>(e.CANCELLED="CANCELLED",e.CONFIRMED="CONFIRMED",e.TENTATIVE="TENTATIVE",e))(li||{}),ci=(e=>(e.OPAQUE="OPAQUE",e.TRANSPARENT="TRANSPARENT",e))(ci||{}),vr=class{calendar;data;constructor(e,t){if(this.data={alarms:[],allDay:!1,attachments:[],attendees:[],busystatus:null,categories:[],class:null,created:null,description:null,end:null,floating:!1,id:crypto.randomUUID(),lastModified:null,location:null,organizer:null,priority:null,recurrenceId:null,repeating:null,sequence:0,stamp:new Date,start:new Date,status:null,summary:"",timezone:null,transparency:null,url:null,x:[]},this.calendar=t,!t)throw new Error("`calendar` option required!");e.id&&this.id(e.id),e.sequence!==void 0&&this.sequence(e.sequence),e.start&&this.start(e.start),e.end!==void 0&&this.end(e.end),e.recurrenceId!==void 0&&this.recurrenceId(e.recurrenceId),e.timezone!==void 0&&this.timezone(e.timezone),e.stamp!==void 0&&this.stamp(e.stamp),e.allDay!==void 0&&this.allDay(e.allDay),e.floating!==void 0&&this.floating(e.floating),e.repeating!==void 0&&this.repeating(e.repeating),e.summary!==void 0&&this.summary(e.summary),e.location!==void 0&&this.location(e.location),e.description!==void 0&&this.description(e.description),e.organizer!==void 0&&this.organizer(e.organizer),e.attendees!==void 0&&this.attendees(e.attendees),e.alarms!==void 0&&this.alarms(e.alarms),e.categories!==void 0&&this.categories(e.categories),e.status!==void 0&&this.status(e.status),e.busystatus!==void 0&&this.busystatus(e.busystatus),e.priority!==void 0&&this.priority(e.priority),e.url!==void 0&&this.url(e.url),e.attachments!==void 0&&this.attachments(e.attachments),e.transparency!==void 0&&this.transparency(e.transparency),e.created!==void 0&&this.created(e.created),e.lastModified!==void 0&&this.lastModified(e.lastModified),e.class!==void 0&&this.class(e.class),e.x!==void 0&&this.x(e.x)}alarms(e){return e?(e.forEach(t=>this.createAlarm(t)),this):this.data.alarms}allDay(e){return e===void 0?this.data.allDay:(this.data.allDay=!!e,this)}attachments(e){return e?(e.forEach(t=>this.createAttachment(t)),this):this.data.attachments}attendees(e){return e?(e.forEach(t=>this.createAttendee(t)),this):this.data.attendees}busystatus(e){return e===void 0?this.data.busystatus:e===null?(this.data.busystatus=null,this):(this.data.busystatus=be(ai,e),this)}categories(e){return e?(e.forEach(t=>this.createCategory(t)),this):this.data.categories}class(e){return e===void 0?this.data.class:e===null?(this.data.class=null,this):(this.data.class=be(si,e),this)}createAlarm(e){let t=e instanceof mr?e:new mr(e,this);return this.data.alarms.push(t),t}createAttachment(e){return this.data.attachments.push(e),this}createAttendee(e){if(e instanceof Ft)return this.data.attendees.push(e),e;typeof e=="string"&&(e=Tt("data",e));let t=new Ft(e,this);return this.data.attendees.push(t),t}createCategory(e){let t=e instanceof br?e:new br(e);return this.data.categories.push(t),t}created(e){return e===void 0?this.data.created:e===null?(this.data.created=null,this):(this.data.created=Ne(e,"created"),this)}description(e){return e===void 0?this.data.description:e===null?(this.data.description=null,this):(typeof e=="string"?this.data.description={plain:e}:this.data.description=e,this)}end(e){return e===void 0?(this.swapStartAndEndIfRequired(),this.data.end):e===null?(this.data.end=null,this):(this.data.end=Ne(e,"end"),this)}floating(e){return e===void 0?this.data.floating:(this.data.floating=!!e,this.data.floating&&(this.data.timezone=null),this)}id(e){return e===void 0?this.data.id:(this.data.id=String(e),this)}lastModified(e){return e===void 0?this.data.lastModified:e===null?(this.data.lastModified=null,this):(this.data.lastModified=Ne(e,"lastModified"),this)}location(e){if(e===void 0)return this.data.location;if(typeof e=="string")return this.data.location={title:e},this;if(e&&("title"in e&&!e.title||e?.geo&&(typeof e.geo.lat!="number"||!isFinite(e.geo.lat)||typeof e.geo.lon!="number"||!isFinite(e.geo.lon))||!("title"in e)&&!e?.geo))throw new Error("`location` isn't formatted correctly. See https://sebbo2002.github.io/ical-generator/develop/reference/classes/ICalEvent.html#location");return this.data.location=e||null,this}organizer(e){return e===void 0?this.data.organizer:e===null?(this.data.organizer=null,this):(this.data.organizer=Tt("organizer",e),this)}priority(e){if(e===void 0)return this.data.priority;if(e===null)return this.data.priority=null,this;if(e<0||e>9)throw new Error("`priority` is invalid, musst be 0 ≤ priority ≤ 9.");return this.data.priority=Math.round(e),this}recurrenceId(e){return e===void 0?this.data.recurrenceId:e===null?(this.data.recurrenceId=null,this):(this.data.recurrenceId=Ne(e,"recurrenceId"),this)}repeating(e){if(e===void 0)return this.data.repeating;if(!e)return this.data.repeating=null,this;if(sn(e)||typeof e=="string")return this.data.repeating=e,this;if(this.data.repeating={freq:be(kn,e.freq)},e.count){if(!isFinite(e.count))throw new Error("`repeating.count` must be a finite number!");this.data.repeating.count=e.count}if(e.interval){if(!isFinite(e.interval))throw new Error("`repeating.interval` must be a finite number!");this.data.repeating.interval=e.interval}if(e.until!==void 0&&(this.data.repeating.until=Ne(e.until,"repeating.until")),e.byDay){let t=Array.isArray(e.byDay)?e.byDay:[e.byDay];this.data.repeating.byDay=t.map(n=>be(vn,n))}if(e.byMonth){let t=Array.isArray(e.byMonth)?e.byMonth:[e.byMonth];this.data.repeating.byMonth=t.map(n=>{if(typeof n!="number"||n<1||n>12)throw new Error("`repeating.byMonth` contains invalid value `"+n+"`!");return n})}if(e.byMonthDay){let t=Array.isArray(e.byMonthDay)?e.byMonthDay:[e.byMonthDay];this.data.repeating.byMonthDay=t.map(n=>{if(typeof n!="number"||n<-31||n>31||n===0)throw new Error("`repeating.byMonthDay` contains invalid value `"+n+"`!");return n})}if(e.bySetPos){if(!this.data.repeating.byDay)throw"`repeating.bySetPos` must be used along with `repeating.byDay`!";let t=Array.isArray(e.bySetPos)?e.bySetPos:[e.bySetPos];this.data.repeating.bySetPos=t.map(n=>{if(typeof n!="number"||n<-366||n>366||n===0)throw"`repeating.bySetPos` contains invalid value `"+n+"`!";return n})}if(e.exclude){let t=Array.isArray(e.exclude)?e.exclude:[e.exclude];this.data.repeating.exclude=t.map((n,r)=>Ne(n,`repeating.exclude[${r}]`))}return e.startOfWeek&&(this.data.repeating.startOfWeek=be(vn,e.startOfWeek)),this}sequence(e){if(e===void 0)return this.data.sequence;let t=parseInt(String(e),10);if(isNaN(t))throw new Error("`sequence` must be a number!");return this.data.sequence=e,this}stamp(e){return e===void 0?this.data.stamp:(this.data.stamp=Ne(e,"stamp"),this)}start(e){return e===void 0?(this.swapStartAndEndIfRequired(),this.data.start):(this.data.start=Ne(e,"start"),this)}status(e){return e===void 0?this.data.status:e===null?(this.data.status=null,this):(this.data.status=be(li,e),this)}summary(e){return e===void 0?this.data.summary:(this.data.summary=e?String(e):"",this)}timestamp(e){return e===void 0?this.stamp():this.stamp(e)}timezone(e){return e===void 0&&this.data.timezone!==null?this.data.timezone:e===void 0?this.calendar.timezone():(this.data.timezone=e&&e!=="UTC"?e.toString():null,this.data.timezone&&(this.data.floating=!1),this)}toJSON(){let e=null;return sn(this.data.repeating)||typeof this.data.repeating=="string"?e=this.data.repeating.toString():this.data.repeating&&(e=Object.assign({},this.data.repeating,{exclude:this.data.repeating.exclude?.map(t=>ke(t)),until:ke(this.data.repeating.until)||void 0})),this.swapStartAndEndIfRequired(),Object.assign({},this.data,{created:ke(this.data.created)||null,end:ke(this.data.end)||null,lastModified:ke(this.data.lastModified)||null,recurrenceId:ke(this.data.recurrenceId)||null,repeating:e,stamp:ke(this.data.stamp)||null,start:ke(this.data.start)||null,x:this.x()})}toString(){let e="";if(e+=`BEGIN:VEVENT\r
`,e+="UID:"+this.data.id+`\r
`,e+="SEQUENCE:"+this.data.sequence+`\r
`,this.swapStartAndEndIfRequired(),e+="DTSTAMP:"+we(this.calendar.timezone(),this.data.stamp)+`\r
`,this.data.allDay?(e+="DTSTART;VALUE=DATE:"+we(this.timezone(),this.data.start,!0)+`\r
`,this.data.end&&(e+="DTEND;VALUE=DATE:"+we(this.timezone(),this.data.end,!0)+`\r
`),e+=`X-MICROSOFT-CDO-ALLDAYEVENT:TRUE\r
`,e+=`X-MICROSOFT-MSNCALENDAR-ALLDAYEVENT:TRUE\r
`):(e+=an(this.timezone(),"DTSTART",this.data.start,this.data)+`\r
`,this.data.end&&(e+=an(this.timezone(),"DTEND",this.data.end,this.data)+`\r
`)),sn(this.data.repeating)||typeof this.data.repeating=="string"){let t=this.data.repeating.toString().replace(/\r\n/g,`
`).split(`
`).filter(n=>n&&!n.startsWith("DTSTART:")).join(`\r
`);!t.includes(`\r
`)&&!t.startsWith("RRULE:")&&(t="RRULE:"+t),e+=t.trim()+`\r
`}else this.data.repeating&&(e+="RRULE:FREQ="+this.data.repeating.freq,this.data.repeating.count&&(e+=";COUNT="+this.data.repeating.count),this.data.repeating.interval&&(e+=";INTERVAL="+this.data.repeating.interval),this.data.repeating.until&&(e+=";UNTIL="+we(this.calendar.timezone(),this.data.repeating.until,!1,this.floating())),this.data.repeating.byDay&&(e+=";BYDAY="+this.data.repeating.byDay.join(",")),this.data.repeating.byMonth&&(e+=";BYMONTH="+this.data.repeating.byMonth.join(",")),this.data.repeating.byMonthDay&&(e+=";BYMONTHDAY="+this.data.repeating.byMonthDay.join(",")),this.data.repeating.bySetPos&&(e+=";BYSETPOS="+this.data.repeating.bySetPos.join(",")),this.data.repeating.startOfWeek&&(e+=";WKST="+this.data.repeating.startOfWeek),e+=`\r
`,this.data.repeating.exclude&&(this.data.allDay?e+="EXDATE;VALUE=DATE:"+this.data.repeating.exclude.map(t=>we(this.calendar.timezone(),t,!0)).join(",")+`\r
`:(e+="EXDATE",this.timezone()?e+=";TZID="+this.timezone()+":"+this.data.repeating.exclude.map(t=>we(this.timezone(),t,!1,!0)).join(",")+`\r
`:e+=":"+this.data.repeating.exclude.map(t=>we(this.timezone(),t,!1,this.floating())).join(",")+`\r
`)));return this.data.recurrenceId&&(e+=an(this.timezone(),"RECURRENCE-ID",this.data.recurrenceId,this.data)+`\r
`),e+="SUMMARY:"+z(this.data.summary,!1)+`\r
`,this.data.transparency&&(e+="TRANSP:"+z(this.data.transparency,!1)+`\r
`),this.data.location&&"title"in this.data.location&&this.data.location.title&&(e+="LOCATION:"+z(this.data.location.title+(this.data.location.address?`
`+this.data.location.address:""),!1)+`\r
`,this.data.location.radius&&this.data.location.geo&&(e+="X-APPLE-STRUCTURED-LOCATION;VALUE=URI;"+(this.data.location.address?"X-ADDRESS="+z(this.data.location.address,!1)+";":"")+"X-APPLE-RADIUS="+z(this.data.location.radius,!1)+";X-TITLE="+z(this.data.location.title,!1)+":geo:"+z(this.data.location.geo?.lat,!1)+","+z(this.data.location.geo?.lon,!1)+`\r
`)),this.data.location?.geo?.lat&&this.data.location.geo.lon&&(e+="GEO:"+z(this.data.location.geo.lat,!1)+";"+z(this.data.location.geo.lon,!1)+`\r
`),this.data.description&&(e+="DESCRIPTION:"+z(this.data.description.plain,!1)+`\r
`,this.data.description.html&&(e+="X-ALT-DESC;FMTTYPE=text/html:"+z(this.data.description.html,!1)+`\r
`)),this.data.organizer&&(e+='ORGANIZER;CN="'+z(this.data.organizer.name,!0)+'"',this.data.organizer.sentBy&&(e+=';SENT-BY="mailto:'+z(this.data.organizer.sentBy,!0)+'"'),this.data.organizer.email&&this.data.organizer.mailto&&(e+=";EMAIL="+z(this.data.organizer.email,!1)),e+=":",this.data.organizer.email&&(e+="mailto:"+z(this.data.organizer.mailto||this.data.organizer.email,!1)),e+=`\r
`),this.data.attendees.forEach(function(t){e+=t.toString()}),this.data.alarms.forEach(function(t){e+=t.toString()}),this.data.categories.length>0&&(e+="CATEGORIES:"+this.data.categories.map(t=>t.toString()).join()+`\r
`),this.data.url&&(e+="URL;VALUE=URI:"+z(this.data.url,!1)+`\r
`),this.data.attachments.length>0&&this.data.attachments.forEach(t=>{e+="ATTACH:"+z(t,!1)+`\r
`}),this.data.status&&(e+="STATUS:"+this.data.status.toUpperCase()+`\r
`),this.data.busystatus&&(e+="X-MICROSOFT-CDO-BUSYSTATUS:"+this.data.busystatus.toUpperCase()+`\r
`),this.data.priority!==null&&(e+="PRIORITY:"+this.data.priority+`\r
`),e+=Ln(this.data),this.data.created&&(e+="CREATED:"+we(this.calendar.timezone(),this.data.created)+`\r
`),this.data.lastModified&&(e+="LAST-MODIFIED:"+we(this.calendar.timezone(),this.data.lastModified)+`\r
`),this.data.class&&(e+="CLASS:"+this.data.class.toUpperCase()+`\r
`),e+=`END:VEVENT\r
`,e}transparency(e){return e===void 0?this.data.transparency:e?(this.data.transparency=be(ci,e),this):(this.data.transparency=null,this)}uid(e){return e===void 0?this.id():this.id(e)}url(e){return e===void 0?this.data.url:(this.data.url=e?String(e):null,this)}x(e,t){return e===void 0?ve(this.data):(typeof e=="string"&&typeof t=="string"&&ve(this.data,e,t),typeof e=="object"&&ve(this.data,e),this)}swapStartAndEndIfRequired(){if(this.data.start&&this.data.end&&gr(this.data.start).getTime()>gr(this.data.end).getTime()){let e=this.data.start;this.data.start=this.data.end,this.data.end=e}}},di=(e=>(e.ADD="ADD",e.CANCEL="CANCEL",e.COUNTER="COUNTER",e.DECLINECOUNTER="DECLINECOUNTER",e.PUBLISH="PUBLISH",e.REFRESH="REFRESH",e.REPLY="REPLY",e.REQUEST="REQUEST",e))(di||{}),Ys=class{data;constructor(e={}){this.data={description:null,events:[],method:null,name:null,prodId:"//sebbo.net//ical-generator//EN",scale:null,source:null,timezone:null,ttl:null,url:null,x:[]},e.prodId!==void 0&&this.prodId(e.prodId),e.method!==void 0&&this.method(e.method),e.name!==void 0&&this.name(e.name),e.description!==void 0&&this.description(e.description),e.timezone!==void 0&&this.timezone(e.timezone),e.source!==void 0&&this.source(e.source),e.url!==void 0&&this.url(e.url),e.scale!==void 0&&this.scale(e.scale),e.ttl!==void 0&&this.ttl(e.ttl),e.events!==void 0&&this.events(e.events),e.x!==void 0&&this.x(e.x)}clear(){return this.data.events=[],this}createEvent(e){let t=e instanceof vr?e:new vr(e,this);return this.data.events.push(t),t}description(e){return e===void 0?this.data.description:(this.data.description=e?String(e):null,this)}events(e){return e?(e.forEach(t=>this.createEvent(t)),this):this.data.events}length(){return this.data.events.length}method(e){return e===void 0?this.data.method:e?(this.data.method=be(di,e),this):(this.data.method=null,this)}name(e){return e===void 0?this.data.name:(this.data.name=e?String(e):null,this)}prodId(e){if(!e)return this.data.prodId;if(typeof e=="string")return this.data.prodId=e,this;if(typeof e!="object")throw new Error("`prodid` needs to be a string or an object!");if(!e.company)throw new Error("`prodid.company` is a mandatory item!");if(!e.product)throw new Error("`prodid.product` is a mandatory item!");let t=(e.language||"EN").toUpperCase();return this.data.prodId="//"+e.company+"//"+e.product+"//"+t,this}scale(e){return e===void 0?this.data.scale:(e===null?this.data.scale=null:this.data.scale=e.toUpperCase(),this)}source(e){return e===void 0?this.data.source:(this.data.source=e||null,this)}timezone(e){return e===void 0?this.data.timezone?.name||null:(e==="UTC"?this.data.timezone=null:typeof e=="string"?this.data.timezone={name:e}:e===null?this.data.timezone=null:this.data.timezone=e,this)}toJSON(){return Object.assign({},this.data,{events:this.data.events.map(e=>e.toJSON()),timezone:this.timezone(),x:this.x()})}toString(){let e="";return e=`BEGIN:VCALENDAR\r
VERSION:2.0\r
`,e+="PRODID:-"+this.data.prodId+`\r
`,this.data.url&&(e+="URL:"+this.data.url+`\r
`),this.data.source&&(e+="SOURCE;VALUE=URI:"+this.data.source+`\r
`),this.data.scale&&(e+="CALSCALE:"+this.data.scale+`\r
`),this.data.method&&(e+="METHOD:"+this.data.method+`\r
`),this.data.name&&(e+="NAME:"+this.data.name+`\r
`,e+="X-WR-CALNAME:"+this.data.name+`\r
`),this.data.description&&(e+="X-WR-CALDESC:"+this.data.description+`\r
`),this.data.timezone?.generator&&[...new Set([this.timezone(),...this.data.events.map(t=>t.timezone())])].filter(t=>t!==null&&!t.startsWith("/")).forEach(t=>{if(!this.data.timezone?.generator)return;let n=this.data.timezone.generator(t);n&&(e+=n.replace(/\r\n/g,`
`).replace(/\n/g,`\r
`).trim()+`\r
`)}),this.data.timezone?.name&&(e+="TIMEZONE-ID:"+this.data.timezone.name+`\r
`,e+="X-WR-TIMEZONE:"+this.data.timezone.name+`\r
`),this.data.ttl&&(e+="REFRESH-INTERVAL;VALUE=DURATION:"+tt(this.data.ttl)+`\r
`,e+="X-PUBLISHED-TTL:"+tt(this.data.ttl)+`\r
`),this.data.events.forEach(t=>e+=t.toString()),e+=Ln(this.data),e+="END:VCALENDAR",Us(e)}ttl(e){return e===void 0?this.data.ttl:(qs(e)?this.data.ttl=e.asSeconds():e&&e>0?this.data.ttl=e:this.data.ttl=null,this)}url(e){return e===void 0?this.data.url:(this.data.url=e||null,this)}x(e,t){if(e===void 0)return ve(this.data);if(typeof e=="string"&&typeof t=="string")ve(this.data,e,t);else if(typeof e=="object")ve(this.data,e);else throw new Error("Either key or value is not a string!");return this}};function Vs(e){return new Ys(e)}var Gs=Vs;function Xs(e){const{ctx:t,x:n,y:r,width:i,height:o,radius:a,color:l}=e;t.fillStyle=l,t.beginPath(),t.moveTo(n+a,r),t.lineTo(n+i-a,r),t.quadraticCurveTo(n+i,r,n+i,r+a),t.lineTo(n+i,r+o-a),t.quadraticCurveTo(n+i,r+o,n+i-a,r+o),t.lineTo(n+a,r+o),t.quadraticCurveTo(n,r+o,n,r+o-a),t.lineTo(n,r+a),t.quadraticCurveTo(n,r,n+a,r),t.closePath(),t.fill()}function ln(e,t,n,r){const o=document.createElement("canvas").getContext("2d");if(!o)return[];o.font=`${r}px '${n}'`;let a="";const l=[];for(const d of e){const h=a+d;o.measureText(h).width>t&&a!==""?(l.push(a),a=d):a=h}return a&&l.push(a),l}function ui(e){const{ctx:t,x:n,y:r,text:i,font:o,fontSize:a,color:l,align:d="left"}=e;t.fillStyle=l,t.font=`${a}px '${o}'`,t.textAlign=d||"left",t.fillText(i,n,r)}function Ks(e){const{ctx:t,x:n,y:r,width:i,height:o,title:a,professor:l,location:d,font:h,fontSize:u}=e,f=ln(a,i,h,u),g=ln(l,i,h,u),p=ln(d,i,h,u),C=[...f,...p,...g].slice(0,3),b=C.reduce((x,R,S)=>R===""?x+2:x+u,0);let v=(o-b)/2+u-7;C.forEach((x,R)=>{x!==""?(ui({ctx:t,x:n,y:r+v,text:x,font:h,fontSize:u,color:`rgba(0, 0, 0, ${R<f.length?.8:.5})`}),v+=u+5):v+=2})}async function hi(e){const{timetableName:t,lectures:n,timetableType:r,semesterName:i,semesterFontSize:o,tileFontSize:a}=e,l=Object.values(Li.Tile.TimeTable.default).flatMap(p=>Object.values(p)),d=`Image_template_${r}.png`,h=new Image;h.src=d,await new Promise((p,C)=>{h.onload=p,h.onerror=C});const u=await fr.loadImage(d),f=fr.createCanvas(u.width,u.height),g=f.getContext("2d");g.drawImage(u,0,0),ui({ctx:g,x:r==="5days"?952:1302,y:78,text:i+" "+t,font:"NotoSansKR",fontSize:o,color:"#CCCCCC",align:"right"});for(const p of n){const C=l[p.courseId%l.length]||"#F2CECE";for(const b of p.classes){const{day:m,begin:v,end:x}=b,[R,S,k,A]=[178*m+76,v*4/3-486,171,(x-v)*4/3-7];Xs({ctx:g,x:R,y:S,width:k,height:A,radius:4,color:C}),Ks({ctx:g,x:R+12,y:S+8,width:k-24,height:A-16,title:p.name,professor:Ai(p.professors)||"",location:b.buildingCode+" "+b.roomName||"",font:"NotoSansKR",fontSize:a})}}return f}async function _s(e){const n=(await hi(e)).toDataURL("image/png"),r=document.createElement("a");r.href=n,r.download=`${e.timetableName}.png`,r.click(),URL.revokeObjectURL(n)}async function Qs(e){const n=(await hi(e)).toDataURL("image/png"),i=await(await fetch(n)).blob();if(!navigator.clipboard?.write)return;const o=new ClipboardItem({"image/png":i});await navigator.clipboard.write([o])}function Js(e){const{name:t,lectures:n,semesterObject:r}=e,i=Gs({name:t,prodId:"//SPARCS//OTL Plus",timezone:"Asia/Seoul"});for(const d of n)for(const h of d.classes){const u=h.buildingCode+" "+h.roomName,f=new Date(r.beginning),g=(h.day+1)%7,p=new Date(f),C=p.getDay(),b=(g+7-C)%7;p.setDate(p.getDate()+b);const m=Math.floor(h.begin/60),v=h.begin%60,x=Math.floor(h.end/60),R=h.end%60,S=new Date(p);S.setHours(m,v,0,0);const k=new Date(p);k.setHours(x,R,0,0),i.createEvent({start:S,end:k,summary:d.name,location:u,repeating:{freq:kn.WEEKLY,until:new Date(r.end)},timezone:"Asia/Seoul"}).alarms([{type:Mn.display,trigger:900}])}const o=new Blob([i.toString()],{type:"text/calendar;charset=utf-8"}),a=URL.createObjectURL(o),l=document.createElement("a");l.href=a,l.download=`${t}.ics`,l.click(),URL.revokeObjectURL(a)}const Zs=E(N)`
    width: 100%;

    ${$.laptop} {
        height: 56px;
        flex-wrap: wrap;
        align-items: center;
    }

    ${$.tablet} {
        height: auto;
        flex-wrap: nowrap;
        align-items: flex-start;
    }
`,kt=E.button`
    display: flex;
    flex-direction: row;
    align-items: center;
    gap: 8px;
    background: none;
    border: none;
    cursor: pointer;
    padding: 4px 0;
    color: ${({theme:e})=>e.colors.Highlight.default};
    font-size: 13px;

    &:hover {
        text-decoration: underline;
    }
`;function yn({timetableName:e,timetableLectures:t,year:n,semester:r}){const{t:i}=Re(),o=qe(),a=je("tablet"),{query:l}=Y("GET","/semesters"),[d,h]=c.useState("idle"),[u,f]=c.useState(!1),g=c.useMemo(()=>l?l.data?.semesters.find(p=>p.year===n&&p.semester===r):null,[l.data,n,r]);return c.useEffect(()=>{if(d.startsWith("success")){const p=setTimeout(()=>{h("idle")},500);return()=>clearTimeout(p)}},[d]),w(Zs,{direction:a?"row":"column",gap:8,children:[w(kt,{onClick:()=>{d==="idle"&&(Qs({timetableName:e,lectures:t,timetableType:"5days",semesterName:n+" "+dn(r),semesterFontSize:30,tileFontSize:20}),h("successCopyImage"))},children:[s(V,{size:16,color:o.colors.Highlight.default,onClick:()=>{},children:d=="successCopyImage"?s(Kt,{}):s(En,{})}),!a&&s("span",{children:i("timetable.copyImage")})]}),w(kt,{onClick:()=>{d==="idle"&&(_s({timetableName:e,lectures:t,timetableType:"5days",semesterName:n+" "+dn(r),semesterFontSize:30,tileFontSize:20}),h("successDownloadImage"))},children:[s(V,{size:16,color:o.colors.Highlight.default,onClick:()=>{},children:d=="successDownloadImage"?s(Kt,{}):s(Bi,{})}),!a&&s("span",{children:i("timetable.exportImage")})]}),w(kt,{onClick:()=>{if(d==="idle"){if(!g)return;Js({name:e,lectures:t,semesterObject:{beginning:new Date(g.beginning),end:new Date(g.end)}}),h("successDownloadCalendar")}},children:[s(V,{size:16,color:o.colors.Highlight.default,children:d=="successDownloadCalendar"?s(Kt,{}):s(Oi,{})}),!a&&s("span",{children:i("timetable.exportICal")})]}),w(kt,{onClick:()=>{f(!0)},children:[s(V,{size:16,color:o.colors.Highlight.default,children:s(Mi,{})}),!a&&s("span",{children:i("timetable.addCustomBlock","커스텀 블록 추가")})]}),s($s,{isOpen:u,onClose:()=>f(!1),timetableId:(t.length>=0&&t[0]?.id,0)})]})}const el=E.div`
    display: flex;
    flex-direction: column;
    width: 264px;
    height: 100%;
    gap: 12px;
    overflow-y: auto;

    scrollbar-width: none;
    &::-webkit-scrollbar {
        display: none;
    }

    ${$.laptop} {
        flex-direction: row;
        justify-content: space-around;
        align-items: center;
        width: 100%;
    }
`;function yr({timetableName:e,timetableLectures:t,hover:n,setHover:r,year:i,semester:o}){const a=je("laptop");return w(el,{children:[!a&&s(Os,{timetableLectures:t,hover:n,setHover:r}),s(bs,{hover:n,setHover:r,timetableLectures:t}),!a&&s(mt,{direction:"row"}),s(ws,{timetableLectures:t,hover:n,setHover:r}),!a&&s(mt,{direction:"row"}),!a&&s(Ds,{timetableLectures:t,hover:n,setHover:r}),!a&&s(mt,{direction:"row"}),!a&&s(yn,{timetableName:e,timetableLectures:t,year:i,semester:o})]})}const tl=E(N)`
    min-height: 0;
    padding: 0 20px 12px 20px;

    ${$.tablet} {
        padding: 8px;
    }

    ${$.mobile} {
        padding: 0 8px 8px 8px;
    }
`,wr=E(N)`
    background-color: ${({theme:e})=>e.colors.Background.Section.default};
    padding: 16px;
    border-radius: 12px;
    align-self: stretch; /* 부모 Flex의 align-items: stretch에 맞춰 세로 길이 맞춤 */
    box-shadow:
        0px 1px 3px rgba(0, 0, 0, 0.1),
        0px 1px 2px rgba(0, 0, 0, 0.06);

    ${$.desktop} {
        background-color: transparent;
        padding: 0;
        border-radius: 0;
        box-shadow: none;
    }

    ${$.tablet} {
        flex: 1 1 0;
        min-height: 0;
        height: 100%;
    }
`,xr=E(N)`
    border-radius: 12px;
    width: fit-content;
    align-self: stretch; /* 부모 Flex의 align-items: stretch에 맞춰 세로 길이 맞춤 */

    ${$.laptop} {
        max-width: none;
    }

    ${$.tablet} {
        width: 100%;
        max-width: none;
        flex: 1 0 0;
    }
`,Er=E(N)`
    background-color: ${({theme:e})=>e.colors.Background.Section.default};
    border-top-right-radius: 12px;
    border-bottom-left-radius: 12px;
    border-bottom-right-radius: 12px;
    padding: 16px;
    flex: 1;
    min-height: 0;
    box-shadow:
        0px 1px 3px rgba(0, 0, 0, 0.1),
        0px 1px 2px rgba(0, 0, 0, 0.06);

    ${$.laptop} {
        background-color: transparent;
        padding: 0;
        border-radius: 0;
        box-shadow: none;
    }
`,nl=E.div`
    width: 380px;
    height: 100%;
    display: flex;

    ${$.desktop} {
        background-color: ${({theme:e})=>e.colors.Background.Section.default};
        padding: 16px;
        border-radius: 12px;
        box-shadow:
            0px 1px 3px rgba(0, 0, 0, 0.1),
            0px 1px 2px rgba(0, 0, 0, 0.06);
    }

    ${$.laptop} {
        width: 300px;
    }
`,Tr=E.div`
    width: 300px;
    height: 100%;
    display: flex;

    scrollbar-width: none;
    &::-webkit-scrollbar {
        display: none;
    }

    ${$.desktop} {
        width: 380px;
        background-color: ${({theme:e})=>e.colors.Background.Section.default};
        padding: 16px;
        border-radius: 12px;
        box-shadow:
            0px 1px 3px rgba(0, 0, 0, 0.1),
            0px 1px 2px rgba(0, 0, 0, 0.06);
    }

    ${$.laptop} {
        width: 300px;
    }

    ${$.tablet} {
        width: 100%;
    }
`,rl=E.div`
    ${$.laptop} {
        height: 100px;
        background-color: ${({theme:e})=>e.colors.Background.Section.default};
        padding: 22px;
        border-radius: 12px;
        width: 100%;
        box-shadow:
            0px 1px 3px rgba(0, 0, 0, 0.1),
            0px 1px 2px rgba(0, 0, 0, 0.06);
    }
`,Sr=E(N)`
    flex: 1;
    min-height: 0;

    ${$.laptop} {
        background-color: ${({theme:e})=>e.colors.Background.Section.default};
        padding: 16px;
        border-radius: 0 12px 12px 12px;
        box-shadow:
            0px 1px 3px rgba(0, 0, 0, 0.1),
            0px 1px 2px rgba(0, 0, 0, 0.06);
    }
`,Cr=E.div`
    ${$.laptop} {
        height: 100px;
        background-color: ${({theme:e})=>e.colors.Background.Section.default};
        padding: 16px;
        border-radius: 12px;
        box-shadow:
            0px 1px 3px rgba(0, 0, 0, 0.1),
            0px 1px 2px rgba(0, 0, 0, 0.06);
    }

    ${$.tablet} {
        height: auto;
        padding: 8px;
    }
`,il=E(N)`
    background-color: ${({theme:e})=>e.colors.Background.Section.default};
    padding: 8px;
    border-radius: 12px;
    white-space: nowrap;
    box-shadow:
        0px 1px 3px rgba(0, 0, 0, 0.1),
        0px 1px 2px rgba(0, 0, 0, 0.06);
`,Il=Ei(function(){const{status:t}=ot(),n=Ut(),r=qe(),i=je("tablet"),o=je("laptop"),a=je("desktop");c.useEffect(()=>{Ce("Page View",{page:"Timetable"})},[]);const l=c.useRef(null),d=c.useRef(null),h=c.useRef(null),[u,f]=c.useState([]),[g,p]=c.useState(null),[C,b]=c.useState(null),[m,v]=c.useState(null),[x,R]=c.useState(""),[S,k]=c.useState(-1),[A,M]=c.useState(1),[y,D]=c.useState(!1),[L,B]=c.useState([]),{query:U}=Y("GET",`/timetables/${m}`,{enabled:m!==null&&t==="success"}),{query:q,setParams:te}=Y("GET","/timetables/my-timetable",{enabled:m===null&&t==="success"}),F=t!=="success"?L:m===null?q.data?.lectures??[]:U.data?.lectures??[],{query:fe}=Y("GET",`/timetables/${m}/custom-blocks`,{enabled:m!==null&&t==="success"}),G=t==="success"&&m!==null?fe.data?.custom_blocks??[]:[],{requestFunction:ie}=Y("PATCH",`/timetables/${m}`,{onSuccess:()=>{n.invalidateQueries({queryKey:[`/timetables/${m}`]}).then(()=>{p(null),f([])})}}),{requestFunction:le}=Y("DELETE",`/timetables/${m}/custom-blocks/:customblockId`,{onSuccess:()=>{n.invalidateQueries({queryKey:[`/timetables/${m}/custom-blocks`]})}}),ye=c.useCallback(j=>{B(oe=>oe.filter(_=>_.id!==j)),p(null),f([])},[]),Ee=c.useCallback(j=>{ie({action:"delete",lectureId:j}),Ce("Remove Lecture from Timetable",{lectureId:j,timetableId:m})},[ie,m]),{mutation:X}=Y("DELETE",`/timetables/${m}/custom-blocks/:customblockId`,{}),K=c.useCallback(async j=>{m!==null&&(await n.fetchQuery({queryKey:["deleteCustomBlock",j],queryFn:async()=>{const{default:oe}=await qn(async()=>{const{default:ae}=await import("./index-WIeaGq_p.js").then(T=>T.e);return{default:ae}},__vite__mapDeps([0,1,2])),{axiosClient:_}=await qn(async()=>{const{axiosClient:ae}=await import("./index-WIeaGq_p.js").then(T=>T.f);return{axiosClient:ae}},__vite__mapDeps([0,1,2])),{data:Me}=await _.request({method:"DELETE",url:`/api/v2/timetables/${m}/custom-blocks/${j}`});return Me}}),n.invalidateQueries({queryKey:[`/timetables/${m}/custom-blocks`]}),Ce("Remove Custom Block from Timetable",{blockId:j,timetableId:m}))},[m,n]);return c.useEffect(()=>{f([]),p(null)},[y]),c.useEffect(()=>{const j=oe=>{l.current&&!l.current.contains(oe.target)&&d.current&&!d.current.contains(oe.target)&&h.current&&h.current.contains(oe.target)&&p(null)};return document.addEventListener("mousedown",j),()=>document.removeEventListener("mousedown",j)},[]),c.useEffect(()=>{p(null),f([]),S!==-1&&te({year:S,semester:A}),B([])},[S,A]),c.useEffect(()=>{i||(p(null),f([]))},[m]),c.useEffect(()=>{C!==null&&i&&D(!0)},[C]),s(tl,{direction:i?"column":"row",align:"stretch",justify:"center",gap:i?8:12,flex:"1 0 0",ref:h,children:i?w(We,{children:[w(xr,{ref:d,direction:"column",gap:0,align:"stretch",justify:"stretch",style:y?{flex:"1 1 0",minHeight:0}:void 0,children:[s(lr,{timeTableLectures:F,currentTimetableId:m,setCurrentTimetableId:v,setCurrentTimetableName:R,year:S,semester:A,setYear:k,setSemester:M}),s(Er,{direction:"column",gap:12,align:"stretch",justify:"flex-start",flex:"1 0 0",children:s(Sr,{direction:"column",gap:0,align:"stretch",flex:"1 1 auto",children:s(Wn,{lectures:F,timeFilter:C,setTimeFilter:b,needLectureDeletable:m!==null,hoveredLectures:u,setHoveredLectures:f,selectedLecture:g,setSelectedLecture:p,deleteLecture:t==="success"?m===null?void 0:Ee:ye,customBlocks:G,deleteCustomBlock:t==="success"&&m!==null?K:void 0})})})]}),s(Cr,{children:s(yr,{timetableName:x,timetableLectures:F,hover:u,setHover:f,year:S,semester:A})}),w(il,{direction:"row",gap:0,children:[s(yn,{timetableName:x,timetableLectures:F,year:S,semester:A}),w(N,{direction:"row",gap:4,align:"center",style:{height:"100%"},onClick:()=>{D(!y)},children:[s(V,{size:16,color:r.colors.Highlight.default,children:s(Ti,{})}),s(O,{type:"Normal",color:"Highlight.default",children:y?"검색 닫기":"과목 검색하기"})]})]}),y&&s(wr,{direction:"row",align:"flex-start",gap:12,ref:l,children:s(Tr,{children:s(Xn,{timetableLectures:F,year:S,semester:A,setNonLoginTimetable:B,hoveredLecture:u,selectedLecture:g,setSelectedLecture:p,setHoveredLecture:f,timeFilter:C,setTimeFilter:b,currentTimetableId:m})})}),g&&s(Dr,{isOpen:!!g,onClose:()=>{},fullScreen:!0,header:!1,children:s(Vn,{setNonLoginTimetable:B,handleRemoveFromTimetable:t==="success"?m===null?void 0:Ee:ye,selectedLecture:g||(u?.length==1?u[0]:null),year:S,semester:A,onMobileModalClose:()=>{f([]),p(null)},currentTimetableId:m,timetableLectures:F})})]}):w(We,{children:[w(wr,{direction:a?"column-reverse":"row",align:"flex-start",gap:12,ref:l,children:[o&&s(rl,{children:s(yn,{timetableName:x,timetableLectures:F,year:S,semester:A})}),s(Tr,{style:{overflow:"auto"},children:s(Xn,{timetableLectures:F,year:S,semester:A,setNonLoginTimetable:B,hoveredLecture:u,selectedLecture:g,setSelectedLecture:p,setHoveredLecture:f,timeFilter:C,setTimeFilter:b,currentTimetableId:m})}),!a&&s(mt,{direction:"column"}),s(nl,{style:{overflow:"auto"},children:s(Vn,{selectedLecture:g||(u?.length==1?u[0]:null),year:S,semester:A})})]}),s(N,{direction:"column",gap:0,children:w(xr,{ref:d,direction:"column",gap:0,style:{overflowX:"hidden"},flex:"1 1 auto",children:[s(lr,{timeTableLectures:F,currentTimetableId:m,setCurrentTimetableId:v,setCurrentTimetableName:R,year:S,semester:A,setYear:k,setSemester:M}),w(Er,{direction:o?"column":"row",gap:o?12:30,align:"stretch",justify:"flex-start",flex:"1 0 0",children:[s(Sr,{direction:"column",gap:0,children:s(Wn,{cellWidth:"100px",lectures:F,timeFilter:C,setTimeFilter:b,needLectureDeletable:m!==null,hoveredLectures:u,setHoveredLectures:f,selectedLecture:g,setSelectedLecture:p,deleteLecture:t==="success"?m===null?void 0:Ee:ye,customBlocks:G,deleteCustomBlock:t==="success"&&m!==null?K:void 0})}),!o&&s(mt,{direction:"column"}),s(Cr,{children:s(yr,{timetableName:x,timetableLectures:F,hover:u,setHover:f,year:S,semester:A})})]})]})})]})})});export{Il as default};
//# sourceMappingURL=timetable-CuSoA8bd.js.map
