{"version":3,"file":"index-BkwrM04M.js","sources":["../../../app/features/main/sections/ReviewSection/index.tsx"],"sourcesContent":["import { type Dispatch, Fragment, type SetStateAction, use, useState } from \"react\"\n\nimport styled from \"@emotion/styled\"\nimport { useQueryClient } from \"@tanstack/react-query\"\nimport { Trans, useTranslation } from \"react-i18next\"\n\nimport Button from \"@/common/components/Button\"\nimport GradeWrap from \"@/common/components/GradeWrap\"\nimport { ScoreEnum } from \"@/common/enum/scoreEnum\"\nimport FlexWrapper from \"@/common/primitives/FlexWrapper\"\nimport TextInputArea from \"@/common/primitives/TextInputArea\"\nimport Typography from \"@/common/primitives/Typography\"\nimport { trackEvent } from \"@/libs/mixpanel\"\nimport { useAPI } from \"@/utils/api/useAPI\"\nimport useUserStore from \"@/utils/zustand/useUserStore\"\n\nimport Widget from \"../../../../common/primitives/Widget\"\n\nconst ReviewBoxWrapper = styled(FlexWrapper)`\n    height: 173px;\n    border-radius: 4px;\n    background-color: ${({ theme }) => theme.colors.Background.Block.default};\n`\n\nconst ScoreGrid = styled.div`\n    display: grid;\n    grid-template-columns: max-content auto;\n    column-gap: 12px;\n    row-gap: 8px;\n    align-items: end;\n`\n\nfunction ReviewSection() {\n    const { user, status } = useUserStore()\n    const queryClient = useQueryClient()\n\n    const { query } = useAPI(\"GET\", \"/users/writable-review\", {\n        enabled: status === \"success\",\n    })\n\n    const { requestFunction } = useAPI(\"POST\", \"/reviews\", {\n        onSuccess: resetReviewStates,\n    })\n\n    const [reviewText, setReviewText] = useState(\"\")\n    const [reviewGrade, setReviewGrade] = useState<ScoreEnum>(0)\n    const [reviewLoad, setReviewLoad] = useState<ScoreEnum>(0)\n    const [reviewSpeech, setReviewSpeech] = useState<ScoreEnum>(0)\n\n    const { t } = useTranslation()\n\n    function resetReviewStates() {\n        query.refetch()\n        setReviewText(\"\")\n        setReviewGrade(0)\n        setReviewLoad(0)\n        setReviewSpeech(0)\n    }\n\n    function submitReview() {\n        if (!query.data) return\n\n        requestFunction({\n            lectureId: query.data.lectureId,\n            content: reviewText,\n            grade: reviewGrade,\n            load: reviewLoad,\n            speech: reviewSpeech,\n        })\n        trackEvent(\"Submit Review\", {\n            lectureId: query.data.lectureId,\n            courseName: query.data.name,\n            grade: reviewGrade,\n            load: reviewLoad,\n            speech: reviewSpeech,\n            source: \"Home\",\n        })\n        queryClient.invalidateQueries({ queryKey: [`/users/written-reviews`] })\n        queryClient.invalidateQueries({ queryKey: [`/users/${user?.id}/lectures`] })\n    }\n\n    if (!query.data) {\n        return null\n    }\n\n    return (\n        <Widget direction=\"column\" gap={20} padding=\"23px 30px\" align=\"stretch\">\n            <Typography type=\"BiggerBold\" color=\"Text.default\">\n                <Trans\n                    i18nKey=\"main.reviewSection.title\"\n                    values={{ lectureName: query.data?.name }}\n                />\n            </Typography>\n            <ReviewBoxWrapper\n                direction=\"column\"\n                align=\"stretch\"\n                justify=\"stretch\"\n                gap={0}\n            >\n                <TextInputArea\n                    placeholder={t(\"main.reviewSection.placeholder\")}\n                    type=\"text\"\n                    readOnly={false}\n                    value={reviewText}\n                    handleChange={setReviewText}\n                    area\n                />\n            </ReviewBoxWrapper>\n            <FlexWrapper direction=\"column\" gap={20} align=\"stretch\">\n                <ScoreGrid>\n                    {(\n                        [\n                            [t(\"common.grade\"), reviewGrade, setReviewGrade],\n                            [t(\"common.load\"), reviewLoad, setReviewLoad],\n                            [t(\"common.speech\"), reviewSpeech, setReviewSpeech],\n                        ] as [string, ScoreEnum, Dispatch<SetStateAction<ScoreEnum>>][]\n                    ).map(([tag, currentState, DispatchFunction]) => (\n                        <Fragment key={tag}>\n                            <Typography type=\"Normal\" color=\"Text.light\">\n                                {tag}\n                            </Typography>\n                            <FlexWrapper\n                                key={tag}\n                                direction=\"row\"\n                                align=\"center\"\n                                gap={10}\n                            >\n                                <GradeWrap\n                                    score={currentState}\n                                    setScore={DispatchFunction}\n                                />\n                            </FlexWrapper>\n                        </Fragment>\n                    ))}\n                </ScoreGrid>\n                <FlexWrapper direction=\"row\" justify=\"flex-end\" gap={12}>\n                    <Button\n                        type=\"default\"\n                        $paddingLeft={8}\n                        $paddingTop={8}\n                        onClick={resetReviewStates}\n                    >\n                        <Typography type=\"Normal\">\n                            {t(\"main.reviewSection.writeAnother\")}\n                        </Typography>\n                    </Button>\n                    <Button\n                        type={\n                            reviewText && reviewGrade && reviewSpeech && reviewLoad\n                                ? \"default\"\n                                : \"disabled\"\n                        }\n                        $paddingLeft={8}\n                        $paddingTop={8}\n                        onClick={submitReview}\n                    >\n                        <Typography\n                            type=\"Normal\"\n                            color={\n                                reviewText && reviewGrade && reviewSpeech && reviewLoad\n                                    ? \"Highlight.default\"\n                                    : \"Text.disable\"\n                            }\n                        >\n                            {t(\"common.upload\")}\n                        </Typography>\n                    </Button>\n                </FlexWrapper>\n            </FlexWrapper>\n        </Widget>\n    )\n}\n\nexport default ReviewSection\n"],"names":["ReviewBoxWrapper","styled","FlexWrapper","theme","ScoreGrid","ReviewSection","user","status","useUserStore","queryClient","useQueryClient","query","useAPI","requestFunction","resetReviewStates","reviewText","setReviewText","useState","reviewGrade","setReviewGrade","reviewLoad","setReviewLoad","reviewSpeech","setReviewSpeech","t","useTranslation","submitReview","trackEvent","jsxs","Widget","jsx","Typography","Trans","TextInputArea","tag","currentState","DispatchFunction","Fragment","GradeWrap","Button"],"mappings":"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"}