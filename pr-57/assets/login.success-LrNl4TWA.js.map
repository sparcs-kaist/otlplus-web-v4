{"version":3,"file":"login.success-LrNl4TWA.js","sources":["../../../app/routes/login.success.tsx"],"sourcesContent":["import { useEffect } from \"react\"\n\nimport { useQueryClient } from \"@tanstack/react-query\"\nimport { useNavigate } from \"react-router-dom\"\n\nimport { axiosClient } from \"@/libs/axios\"\nimport { clearQueryCache } from \"@/libs/offline\"\n\nexport default function LoginSuccessPage() {\n    const navigate = useNavigate()\n    const qc = useQueryClient()\n\n    useEffect(() => {\n        const handleLoginSuccess = async () => {\n            const hash = window.location.hash.substring(1)\n            const params = new URLSearchParams(hash)\n            const accessToken = params.get(\"accessToken\")\n            const refreshToken = params.get(\"refreshToken\")\n\n            if (accessToken && refreshToken) {\n                if (navigator.userAgent.includes(\"otl-app\")) {\n                    window.location.href = `org.sparcs.otl://login?accessToken=${accessToken}&refreshToken=${refreshToken}`\n                    return\n                }\n\n                await clearQueryCache()\n\n                qc.removeQueries({ queryKey: [\"/users/info\"] })\n                qc.removeQueries({ queryKey: [\"/timetables\"] })\n\n                await qc.prefetchQuery({\n                    queryKey: [\"/users/info\", null, \"ko\"],\n                    queryFn: async () => {\n                        const { data } = await axiosClient.get(\"/api/v2/users/info\")\n                        return data\n                    },\n                })\n\n                try {\n                    const { data: semesterData } =\n                        await axiosClient.get(\"/api/v2/semesters\")\n                    if (semesterData?.semesters?.length > 0) {\n                        const latestSemester =\n                            semesterData.semesters[semesterData.semesters.length - 1]\n                        if (latestSemester) {\n                            await qc.prefetchQuery({\n                                queryKey: [\n                                    \"/timetables/my-timetable\",\n                                    {\n                                        year: latestSemester.year,\n                                        semester: latestSemester.semester,\n                                    },\n                                    \"ko\",\n                                ],\n                                queryFn: async () => {\n                                    const { data } = await axiosClient.get(\n                                        \"/api/v2/timetables/my-timetable\",\n                                        {\n                                            params: {\n                                                year: latestSemester.year,\n                                                semester: latestSemester.semester,\n                                            },\n                                        },\n                                    )\n                                    return data\n                                },\n                            })\n                        }\n                    }\n                } catch {}\n\n                navigate(\"/\", { replace: true })\n            } else {\n                navigate(\"/\", { replace: true })\n            }\n        }\n\n        handleLoginSuccess()\n    }, [navigate, qc])\n\n    return null\n}\n"],"names":["login_success","_UNSAFE_withComponentProps","navigate","useNavigate","qc","useQueryClient","useEffect","hash","window","location","substring","params","URLSearchParams","accessToken","get","refreshToken","navigator","userAgent","includes","href","clearQueryCache","removeQueries","queryKey","prefetchQuery","queryFn","data","axiosClient","semesterData","semesters","length","latestSemester","year","semester","replace"],"mappings":"yLAQA,MAAAA,EAAAC,EAAA,UAA2C,CACvC,MAAMC,EAAWC,EAAA,EACXC,EAAKC,EAAA,EAEXC,OAAAA,EAAAA,UAAU,IAAM,EACe,SAAY,CACnC,MAAMC,EAAOC,OAAOC,SAASF,KAAKG,UAAU,CAAC,EACvCC,EAAS,IAAIC,gBAAgBL,CAAI,EACjCM,EAAcF,EAAOG,IAAI,aAAa,EACtCC,EAAeJ,EAAOG,IAAI,cAAc,EAE9C,GAAID,GAAeE,EAAc,CAC7B,GAAIC,UAAUC,UAAUC,SAAS,SAAS,EAAG,CACzCV,OAAOC,SAASU,KAAO,sCAAsCN,CAAW,iBAAiBE,CAAY,GACrG,MACJ,CAEA,MAAMK,EAAA,EAENhB,EAAGiB,cAAc,CAAEC,SAAU,CAAC,aAAa,CAAE,CAAC,EAC9ClB,EAAGiB,cAAc,CAAEC,SAAU,CAAC,aAAa,CAAE,CAAC,EAE9C,MAAMlB,EAAGmB,cAAc,CACnBD,SAAU,CAAC,cAAe,KAAM,IAAI,EACpCE,QAAS,SAAY,CACjB,KAAM,CAAEC,KAAAA,CAAK,EAAI,MAAMC,EAAYZ,IAAI,oBAAoB,EAC3D,OAAOW,CACX,CACJ,CAAC,EAED,GAAI,CACA,KAAM,CAAEA,KAAME,CAAa,EACvB,MAAMD,EAAYZ,IAAI,mBAAmB,EAC7C,GAAIa,GAAcC,WAAWC,OAAS,EAAG,CACrC,MAAMC,EACFH,EAAaC,UAAUD,EAAaC,UAAUC,OAAS,CAAC,EACxDC,GACA,MAAM1B,EAAGmB,cAAc,CACnBD,SAAU,CACN,2BACA,CACIS,KAAMD,EAAeC,KACrBC,SAAUF,EAAeE,UAE7B,IAAA,EAEJR,QAAS,SAAY,CACjB,KAAM,CAAEC,KAAAA,CAAK,EAAI,MAAMC,EAAYZ,IAC/B,kCACA,CACIH,OAAQ,CACJoB,KAAMD,EAAeC,KACrBC,SAAUF,EAAeE,QAC7B,CACJ,CACJ,EACA,OAAOP,CACX,CACJ,CAAC,CAET,CACJ,MAAQ,CAAC,CAETvB,EAAS,IAAK,CAAE+B,QAAS,EAAK,CAAC,CACnC,MACI/B,EAAS,IAAK,CAAE+B,QAAS,EAAK,CAAC,CAEvC,GAEA,CACJ,EAAG,CAAC/B,EAAUE,CAAE,CAAC,EAEV,IACX,CAAA"}