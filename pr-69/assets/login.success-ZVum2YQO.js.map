{"version":3,"file":"login.success-ZVum2YQO.js","sources":["../../../app/routes/login.success.tsx"],"sourcesContent":["import { useEffect, useRef } from \"react\"\n\nimport { useQueryClient } from \"@tanstack/react-query\"\nimport { useTranslation } from \"react-i18next\"\nimport { useNavigate } from \"react-router-dom\"\n\nimport { axiosClient, axiosClientWithAuth } from \"@/libs/axios\"\nimport { clearQueryCache } from \"@/libs/offline\"\n\nexport default function LoginSuccessPage() {\n    const navigate = useNavigate()\n    const qc = useQueryClient()\n    const { i18n } = useTranslation()\n    const isMounted = useRef(true)\n\n    useEffect(() => {\n        isMounted.current = true\n\n        const handleLoginSuccess = async () => {\n            const hash = window.location.hash.substring(1)\n            const params = new URLSearchParams(hash)\n            const accessToken = params.get(\"accessToken\")\n            const refreshToken = params.get(\"refreshToken\")\n            const lang = i18n.resolvedLanguage || \"ko\"\n\n            if (accessToken && refreshToken) {\n                if (navigator.userAgent.includes(\"otl-app\")) {\n                    window.location.href = `org.sparcs.otl://login?accessToken=${accessToken}&refreshToken=${refreshToken}`\n                    return\n                }\n\n                localStorage.setItem(\"accessToken\", accessToken)\n                localStorage.setItem(\"refreshToken\", refreshToken)\n\n                await clearQueryCache()\n\n                qc.removeQueries({ queryKey: [\"/users/info\"] })\n                qc.removeQueries({ queryKey: [\"/timetables\"] })\n\n                await qc.prefetchQuery({\n                    queryKey: [\"/users/info\", null, lang],\n                    queryFn: async () => {\n                        const { data } =\n                            await axiosClientWithAuth.get(\"/api/v2/users/info\")\n                        return data\n                    },\n                })\n\n                try {\n                    const { data: semesterData } =\n                        await axiosClient.get(\"/api/v2/semesters\")\n                    if (semesterData?.semesters?.length > 0) {\n                        const latestSemester =\n                            semesterData.semesters[semesterData.semesters.length - 1]\n                        if (latestSemester) {\n                            await qc.prefetchQuery({\n                                queryKey: [\n                                    \"/timetables/my-timetable\",\n                                    {\n                                        year: latestSemester.year,\n                                        semester: latestSemester.semester,\n                                    },\n                                    lang,\n                                ],\n                                queryFn: async () => {\n                                    const { data } = await axiosClientWithAuth.get(\n                                        \"/api/v2/timetables/my-timetable\",\n                                        {\n                                            params: {\n                                                year: latestSemester.year,\n                                                semester: latestSemester.semester,\n                                            },\n                                        },\n                                    )\n                                    return data\n                                },\n                            })\n                        }\n                    }\n                } catch (error) {\n                    console.error(\"Failed to prefetch timetable:\", error)\n                }\n\n                if (isMounted.current) {\n                    navigate(\"/\", { replace: true })\n                }\n            } else if (isMounted.current) {\n                navigate(\"/\", { replace: true })\n            }\n        }\n\n        handleLoginSuccess()\n\n        return () => {\n            isMounted.current = false\n        }\n    }, [navigate, qc, i18n.resolvedLanguage])\n\n    return null\n}\n"],"names":["login_success","_UNSAFE_withComponentProps","navigate","useNavigate","qc","useQueryClient","i18n","useTranslation","isMounted","useRef","useEffect","current","hash","window","location","substring","params","URLSearchParams","accessToken","get","refreshToken","lang","resolvedLanguage","navigator","userAgent","includes","href","localStorage","setItem","clearQueryCache","removeQueries","queryKey","prefetchQuery","queryFn","data","axiosClientWithAuth","semesterData","axiosClient","semesters","length","latestSemester","year","semester","error","console","replace"],"mappings":"iPASA,MAAAA,EAAAC,EAAA,UAA2C,CACvC,MAAMC,EAAWC,EAAA,EACXC,EAAKC,EAAA,EACL,CAAEC,KAAAA,GAASC,EAAA,EACXC,EAAYC,EAAAA,OAAO,EAAI,EAE7BC,OAAAA,EAAAA,UAAU,KACNF,EAAUG,QAAU,IAEO,SAAY,CACnC,MAAMC,EAAOC,OAAOC,SAASF,KAAKG,UAAU,CAAC,EACvCC,EAAS,IAAIC,gBAAgBL,CAAI,EACjCM,EAAcF,EAAOG,IAAI,aAAa,EACtCC,EAAeJ,EAAOG,IAAI,cAAc,EACxCE,EAAOf,EAAKgB,kBAAoB,KAEtC,GAAIJ,GAAeE,EAAc,CAC7B,GAAIG,UAAUC,UAAUC,SAAS,SAAS,EAAG,CACzCZ,OAAOC,SAASY,KAAO,sCAAsCR,CAAW,iBAAiBE,CAAY,GACrG,MACJ,CAEAO,aAAaC,QAAQ,cAAeV,CAAW,EAC/CS,aAAaC,QAAQ,eAAgBR,CAAY,EAEjD,MAAMS,EAAA,EAENzB,EAAG0B,cAAc,CAAEC,SAAU,CAAC,aAAa,CAAE,CAAC,EAC9C3B,EAAG0B,cAAc,CAAEC,SAAU,CAAC,aAAa,CAAE,CAAC,EAE9C,MAAM3B,EAAG4B,cAAc,CACnBD,SAAU,CAAC,cAAe,KAAMV,CAAI,EACpCY,QAAS,SAAY,CACjB,KAAM,CAAEC,KAAAA,CAAK,EACT,MAAMC,EAAoBhB,IAAI,oBAAoB,EACtD,OAAOe,CACX,CACJ,CAAC,EAED,GAAI,CACA,KAAM,CAAEA,KAAME,CAAa,EACvB,MAAMC,EAAYlB,IAAI,mBAAmB,EAC7C,GAAIiB,GAAcE,WAAWC,OAAS,EAAG,CACrC,MAAMC,EACFJ,EAAaE,UAAUF,EAAaE,UAAUC,OAAS,CAAC,EACxDC,GACA,MAAMpC,EAAG4B,cAAc,CACnBD,SAAU,CACN,2BACA,CACIU,KAAMD,EAAeC,KACrBC,SAAUF,EAAeE,UAE7BrB,CAAA,EAEJY,QAAS,SAAY,CACjB,KAAM,CAAEC,KAAAA,CAAK,EAAI,MAAMC,EAAoBhB,IACvC,kCACA,CACIH,OAAQ,CACJyB,KAAMD,EAAeC,KACrBC,SAAUF,EAAeE,QAC7B,CACJ,CACJ,EACA,OAAOR,CACX,CACJ,CAAC,CAET,CACJ,OAASS,EAAO,CACZC,QAAQD,MAAM,gCAAiCA,CAAK,CACxD,CAEInC,EAAUG,SACVT,EAAS,IAAK,CAAE2C,QAAS,EAAK,CAAC,CAEvC,MAAWrC,EAAUG,SACjBT,EAAS,IAAK,CAAE2C,QAAS,EAAK,CAAC,CAEvC,GAEA,EAEO,IAAM,CACTrC,EAAUG,QAAU,EACxB,GACD,CAACT,EAAUE,EAAIE,EAAKgB,gBAAgB,CAAC,EAEjC,IACX,CAAA"}